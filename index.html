<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Guadazi">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Guadazi">
<meta property="og:locale">
<meta property="article:author" content="aaronzhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>Guadazi</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guadazi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/Flink-SQL-UDF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/Flink-SQL-UDF/" class="post-title-link" itemprop="url">Flink SQL UDF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-15 19:47:00" itemprop="dateCreated datePublished" datetime="2021-10-15T19:47:00+08:00">2021-10-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-06-01 19:57:43" itemprop="dateModified" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/README/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/README/" class="post-title-link" itemprop="url">Flink-outline</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-15 19:47:00" itemprop="dateCreated datePublished" datetime="2021-10-15T19:47:00+08:00">2021-10-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-06-01 19:57:43" itemprop="dateModified" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><ul>
<li><input checked="" disabled="" type="checkbox"> [runtime][flink-runtime]<ul>
<li>task chain</li>
<li>sharing slot group</li>
<li>task slot  </li>
<li>CoLocationGroup  </li>
<li>SlotSharingGroup</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> state backend</li>
<li><input disabled="" type="checkbox"> Restart Strategies(重启策略)</li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/Flink-checkpoint-savepoint-2pc/">2PC</a></li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/Flink-checkpoint-savepoint-2pc/">checkpoint与savepoint</a></li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/Flink-checkpoint%E8%AF%8A%E6%96%AD/">checkpoint诊断</a></li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/flink-cep/">backpress反压</a>、<a href="/bigdata/Flink/Flink-backpress-oppo">oppo分享</a></li>
<li><input disabled="" type="checkbox"> 状态管理与TTL</li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/Flink-time/">time</a></li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/flink-timer/">timer</a> 使用与原理</li>
<li><input disabled="" type="checkbox"> watermark</li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/Flink-on-yarn/">Flink-on-yarn</a></li>
<li><input disabled="" type="checkbox"> Flink内存管理</li>
<li><input disabled="" type="checkbox"> 分布式缓存</li>
</ul>
<h3 id="Flink-window"><a href="#Flink-window" class="headerlink" title="Flink window"></a><a href="/bigdata/Flink/Flink-window/">Flink window</a></h3><ul>
<li><input disabled="" type="checkbox"> window api</li>
<li><input disabled="" type="checkbox"> 自定义trigger、evictor</li>
<li><input disabled="" type="checkbox"> session-window</li>
</ul>
<h2 id="Flink-API"><a href="#Flink-API" class="headerlink" title="Flink API"></a>Flink API</h2><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="bigdata/Flink/Flink-sink/">Flink三种Sink模式: Append、Upsert和Retract</a></li>
<li><input disabled="" type="checkbox"> Flink join: broadcast join、interval join、window join、cogroup</li>
<li><input checked="" disabled="" type="checkbox"> <a href="bigdata/Flink/Flink-AsyncIO/">Flink AsyncIO</a></li>
</ul>
<h2 id="Flink-DataStream"><a href="#Flink-DataStream" class="headerlink" title="Flink DataStream"></a>Flink DataStream</h2><ul>
<li><input checked="" disabled="" type="checkbox"> <a href="bigdata/Flink/Flink-join/">Flink join</a></li>
</ul>
<h2 id="Flink-SQL"><a href="#Flink-SQL" class="headerlink" title="Flink SQL"></a>Flink SQL</h2><ul>
<li><input disabled="" type="checkbox"> <a href="bigdata/Flink/Flink-SQL-Join/">Flink SQL join</a></li>
<li><input disabled="" type="checkbox"> Flink interval join</li>
<li><input disabled="" type="checkbox"> Flink temporal join</li>
<li><input disabled="" type="checkbox"> Flink broadcast join</li>
<li><input disabled="" type="checkbox"> Flink SQL join的状态管理</li>
<li><input disabled="" type="checkbox"> <a href="bigdata/Flink/Flink-SQL-Window/">Flink window &amp; demo</a></li>
<li><input disabled="" type="checkbox"> Flink SQL-window aggregate与group aggregate</li>
<li><input disabled="" type="checkbox"> Flink over window与TopN</li>
<li><input disabled="" type="checkbox"> <a href="bigdata/Flink/Flink-SQL-TableFactory/">Flink SQL TableFactory</a></li>
</ul>
<p>Flink 原理:</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> <a href="bigdata/Flink/Flink-SQL-Calcite/">Calcite原理</a></li>
<li><input disabled="" type="checkbox"> Flink SQL原理与blink优化</li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/Flink-SQL-codeGen/">Flink SQL代码生成</a></li>
</ul>
<p>Blink:</p>
<ul>
<li><input disabled="" type="checkbox"> Blink SQL</li>
</ul>
<h2 id="Flink-metric"><a href="#Flink-metric" class="headerlink" title="Flink metric"></a>Flink metric</h2><ul>
<li><input disabled="" type="checkbox"> Flink累加器和计数器:Accumulators &amp; Counters</li>
</ul>
<h2 id="Flink-CEP"><a href="#Flink-CEP" class="headerlink" title="Flink CEP"></a>Flink CEP</h2><h2 id="Flink-Connectors"><a href="#Flink-Connectors" class="headerlink" title="Flink Connectors"></a>Flink Connectors</h2><ul>
<li><input disabled="" type="checkbox"> kudu connector</li>
</ul>
<h3 id="Flink-devops"><a href="#Flink-devops" class="headerlink" title="Flink devops"></a>Flink devops</h3><ul>
<li><input disabled="" type="checkbox"> [Flink UI][flink-ui]</li>
<li><input disabled="" type="checkbox"> Yarn、JM、TM配置与参数</li>
<li><input disabled="" type="checkbox"> 常见异常与解决方案</li>
</ul>
<h2 id="Flink最佳实践"><a href="#Flink最佳实践" class="headerlink" title="Flink最佳实践"></a>Flink最佳实践</h2><ul>
<li><input disabled="" type="checkbox"> interval join实现outjoin</li>
<li><input disabled="" type="checkbox"> 双流join，一条流延迟</li>
<li><input disabled="" type="checkbox"> keyedState扩容</li>
<li><input disabled="" type="checkbox"> Flink-bloomfilter近似去重</li>
<li><input disabled="" type="checkbox"> <a href="/bigdata/Flink/flink-config-dynamic/">Flink状态动态更新</a></li>
<li><input disabled="" type="checkbox"> [Flink数据倾斜][flink-data-skew]</li>
<li><input disabled="" type="checkbox"> 实时数据同步</li>
</ul>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><p>[flink-data-skew]: /bigdata/Flink/Flink-data-skew “数据倾斜”</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/crestofwave1/oneFlink">Flink官方文档翻译</a></p>
</li>
<li><p>[flink-ui]:/bigdata/Flink/Flink-Web-UI/</p>
</li>
<li><p>[flink-runtime]: /bigdata/Flink/Flink-runtime/</p>
</li>
</ol>
<h2 id="stateful-stream-processing"><a href="#stateful-stream-processing" class="headerlink" title="stateful stream processing"></a>stateful stream processing</h2><p>processFunction</p>
<p>低阶API<br>构建一些新的组件<br>比如 利用定时做一定情况下的匹配和缓存<br>灵活，开发比较复杂</p>
<p>凌晨更新  注册定时器 </p>
<h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p>状态托管<br>operator state 算子状态<br>keyed state<br>State Backend (rocksdb + hdfs)</p>
<h2 id="checkpoint"><a href="#checkpoint" class="headerlink" title="checkpoint"></a>checkpoint</h2><p>barrier</p>
<h3 id="如何自定义-Window？"><a href="#如何自定义-Window？" class="headerlink" title="如何自定义 Window？"></a>如何自定义 Window？</h3><p>1、Window Assigner</p>
<p>负责将元素分配到不同的 window。</p>
<p>Window API 提供了自定义的 WindowAssigner 接口，我们可以实现 WindowAssigner 的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Collection&lt;W&gt; <span class="title">assignWindows</span><span class="params">(T element, <span class="keyword">long</span> timestamp)</span></span></span><br></pre></td></tr></table></figure>
<p>方法。同时，对于基于 Count 的 window 而言，默认采用了 GlobalWindow 的 window assigner，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keyBy.window(GlobalWindows.create())</span><br></pre></td></tr></table></figure>
<p>2、Trigger</p>
<p>Trigger 即触发器，定义何时或什么情况下移除 window</p>
<p>我们可以指定触发器来覆盖 WindowAssigner 提供的默认触发器。 请注意，指定的触发器不会添加其他触发条件，但会替换当前触发器。</p>
<p>3、Evictor（可选）</p>
<p>驱逐者，即保留上一 window 留下的某些元素</p>
<p>4、通过 apply WindowFunction 来返回 DataStream 类型数据。</p>
<p>利用 Flink 的内部窗口机制和 DataStream API 可以实现自定义的窗口逻辑，例如 session window。</p>
<h3 id="EventTime-amp-ProcessTime-amp-IngestionTime"><a href="#EventTime-amp-ProcessTime-amp-IngestionTime" class="headerlink" title="EventTime &amp; ProcessTime &amp; IngestionTime"></a>EventTime &amp; ProcessTime &amp; IngestionTime</h3><p> Event time programs must specify how to generate <em>Event Time Watermarks</em>, which is the mechanism that signals progress in event time</p>
<p>Internally, <em>ingestion time</em> is treated much like <em>event time</em>, but with automatic timestamp assignment and automatic watermark generation.</p>
<h2 id="watermark"><a href="#watermark" class="headerlink" title="watermark"></a>watermark</h2><p>kafka的每个分区event-time到来的时间不一致</p>
<p>using Flink’s Kafka-partition-aware watermark generation. watermarks are generated inside the Kafka consumer, per Kafka partition, and the per-partition watermarks are merged in the same way as watermarks are merged on stream shuffles.</p>
<p>watermark在每个kafka分区的kafka消费者中产生，每个分区的watermark合并起来，如在stream shuffle中合并watermark一样</p>
<h2 id="HadoopOutputFormat"><a href="#HadoopOutputFormat" class="headerlink" title="HadoopOutputFormat"></a>HadoopOutputFormat</h2><p>flink hbase connector</p>
<h2 id="算子之间数据传递，是如何序列化的"><a href="#算子之间数据传递，是如何序列化的" class="headerlink" title="算子之间数据传递，是如何序列化的"></a>算子之间数据传递，是如何序列化的</h2><h2 id="flink-report"><a href="#flink-report" class="headerlink" title="flink report"></a>flink report</h2><h2 id="storm-trident"><a href="#storm-trident" class="headerlink" title="storm trident"></a>storm trident</h2><p>微批</p>
<p>barrier对齐</p>
<p><img src="_v_images/20190826164001201_1759200368.png" alt="flink-rm"></p>
<h2 id="算子"><a href="#算子" class="headerlink" title="算子"></a>算子</h2><h3 id="Reduce在流计算的应用"><a href="#Reduce在流计算的应用" class="headerlink" title="Reduce在流计算的应用"></a>Reduce在流计算的应用</h3><p>org.apache.flink.streaming.api.functions.timestamps.AscendingTimestampExtractor$LoggingHandler:140 -<br>Timestamp monotony violated: 1568772496000 &lt; 1568772500000</p>
<p>ToDo list</p>
<h1 id="avro-与-kryo-序列化的区别"><a href="#avro-与-kryo-序列化的区别" class="headerlink" title="avro 与 kryo 序列化的区别"></a>avro 与 kryo 序列化的区别</h1><p>使用场景</p>
<h2 id="storm-allGrouping-元素广播"><a href="#storm-allGrouping-元素广播" class="headerlink" title="storm allGrouping 元素广播"></a>storm allGrouping 元素广播</h2><p>flink broadcast how to use </p>
<p>broadcast vaiable value can not be modified</p>
<p>用法<br>1：初始化数据<br>DataSet<Integer> toBroadcast = env.fromElements(1, 2, 3)<br>2：广播数据<br>.withBroadcastSet(toBroadcast, “broadcastSetName”);<br>3：获取数据<br>Collection<Integer> broadcastSet = getRuntimeContext().getBroadcastVariable(“broadcastSetName”);</p>
<ul>
<li>广播变量不能太大</li>
<li>不能修改，保证数据一致性</li>
</ul>
<h2 id="spark-accumulate"><a href="#spark-accumulate" class="headerlink" title="spark accumulate"></a>spark accumulate</h2><p>用法<br>1：创建累加器<br>private IntCounter numLines = new IntCounter();<br>2：注册累加器<br>getRuntimeContext().addAccumulator(“num-lines”, this.numLines);<br>3：使用累加器<br>this.numLines.add(1);<br>4：获取累加器的结果<br>myJobExecutionResult.getAccumulatorResult(“num-lines”)</p>
<h1 id="Distributed-Cache"><a href="#Distributed-Cache" class="headerlink" title="Distributed Cache"></a>Distributed Cache</h1><blockquote>
<p>Spark 分布式缓存如何使用</p>
</blockquote>
<p>Flink提供了一个分布式缓存，类似于hadoop，可以使用户在并行函数中很方便的读取本地文件<br>此缓存的工作机制如下：程序注册一个文件或者目录(本地或者远程文件系统，例如hdfs或者s3)，通过ExecutionEnvironment注册缓存文件并为它起一个名称。当程序执行，Flink自动将文件或者目录复制到所有taskmanager节点的本地文件系统，用户可以通过这个指定的名称查找文件或者目录，然后从taskmanager节点的本地文件系统访问它<br>用法<br>1：注册一个文件<br>env.registerCachedFile(“hdfs:///path/to/your/file”, “hdfsFile”)<br>2：访问数据<br>File myFile = getRuntimeContext().getDistributedCache().getFile(“hdfsFile”);</p>
<h1 id="at-least-once-amp-exactly-once"><a href="#at-least-once-amp-exactly-once" class="headerlink" title="at least once &amp; exactly once"></a>at least once &amp; exactly once</h1><p>从容错和消息处理的语义上(at least once, exactly once)，Flink引入了state和checkpoint。</p>
<h1 id="state-1"><a href="#state-1" class="headerlink" title="state"></a>state</h1><p>默认保存在java堆中<br>checkpoint: 把state持久化存储，全局快照<br>blink做的优化</p>
<p>失败恢复机制 </p>
<p>状态分为原始状态和托管状态</p>
<p>托管状态是由Flink框架管理的状态<br>而原始状态，由用户自行管理状态具体的数据结构，框架在做checkpoint的时候，使用byte[]来读写状态内容，对其内部数据结构一无所知。<br>通常在DataStream上的状态推荐使用托管的状态，当实现一个用户自定义的operator时，会使用到原始状态。</p>
<blockquote>
<p>ReducingState 如何使用</p>
</blockquote>
<h1 id="checkpoint-1"><a href="#checkpoint-1" class="headerlink" title="checkpoint"></a>checkpoint</h1><p>Flink的checkpoint机制可以与(stream和state)的持久化存储交互的前提：<br>持久化的source，它需要支持在一定时间内重放事件。这种sources的典型例子是持久化的消息队列（比如Apache Kafka，RabbitMQ等）或文件系统（比如HDFS，S3，GFS等）<br>用于state的持久化存储，例如分布式文件系统（比如HDFS，S3，GFS等）</p>
<p>Checkpoint是Flink实现容错机制最核心的功能，它能够根据配置周期性地基于Stream中各个Operator/task的状态来生成快照，从而将这些状态数据定期持久化存储下来，当Flink程序一旦意外崩溃时，重新运行程序时可以有选择地从这些快照进行恢复，从而修正因为故障带来的程序数据异常</p>
<p>checkpoint开启之后，默认的checkPointMode是Exactly-once<br>checkpoint的checkPointMode有两种，Exactly-once和At-least-once<br>Exactly-once对于大多数应用来说是最合适的。At-least-once可能用在某些延迟超低的应用程序（始终延迟为几毫秒）</p>
<p>ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION:表示一旦Flink处理程序被cancel后，会保留Checkpoint数据，以便根据实际需要恢复到指定的Checkpoint<br>ExternalizedCheckpointCleanup.DELETE_ON_CANCELLATION: 表示一旦Flink处理程序被cancel后，会删除Checkpoint数据，只有job执行失败的时候才会保存checkpoint</p>
<h1 id="state-backend"><a href="#state-backend" class="headerlink" title="state backend"></a>state backend</h1><p>默认情况下，state会保存在taskmanager的内存中，checkpoint会存储在JobManager的内存中。<br>state 的store和checkpoint的位置取决于State Backend的配置<br>env.setStateBackend(…)<br>一共有三种State Backend<br>MemoryStateBackend<br>FsStateBackend<br>RocksDBStateBackend</p>
<p>MemoryStateBackend<br>state数据保存在java堆内存中，执行checkpoint的时候，会把state的快照数据保存到jobmanager的内存中<br>基于内存的state backend在生产环境下不建议使用<br>FsStateBackend<br>state数据保存在taskmanager的内存中，执行checkpoint的时候，会把state的快照数据保存到配置的文件系统中<br>可以使用hdfs等分布式文件系统<br>RocksDBStateBackend<br>RocksDB跟上面的都略有不同，它会在本地文件系统中维护状态，state会直接写入本地rocksdb中。同时它需要配置一个远端的filesystem uri（一般是HDFS），在做checkpoint的时候，会把本地的数据直接复制到filesystem中。fail over的时候从filesystem中恢复到本地<br>RocksDB克服了state受内存限制的缺点，同时又能够持久化到远端文件系统中，比较适合在生产中使用</p>
<p>修改State Backend的两种方式<br>第一种：单任务调整<br>修改当前任务代码<br>env.setStateBackend(new FsStateBackend(“hdfs://namenode:9000/flink/checkpoints”));<br>或者new MemoryStateBackend()<br>或者new RocksDBStateBackend(filebackend, true);【需要添加第三方依赖】<br>第二种：全局调整<br>修改flink-conf.yaml<br>state.backend: filesystem<br>state.checkpoints.dir: hdfs://namenode:9000/flink/checkpoints<br>注意：state.backend的值可以是下面几种：jobmanager(MemoryStateBackend), filesystem(FsStateBackend), rocksdb(RocksDBStateBackend)</p>
<h1 id="Restart-Strategies-重启策略"><a href="#Restart-Strategies-重启策略" class="headerlink" title="Restart Strategies(重启策略)"></a>Restart Strategies(重启策略)</h1><p>默认重启策略通过 flink-conf.yaml 指定</p>
<p>常用的重启策略<br>固定间隔 (Fixed delay)<br>失败率 (Failure rate)<br>无重启 (No restart)<br>如果没有启用 checkpointing，则使用无重启 (no restart) 策略。<br>如果启用了 checkpointing，但没有配置重启策略，则使用固定间隔 (fixed-delay) 策略，其中 Integer.MAX_VALUE 参数是尝试重启次数<br>重启策略可以在flink-conf.yaml中配置，表示全局的配置。也可以在应用代码中动态指定，会覆盖全局配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一种：全局配置 flink-conf.yaml</span><br><span class="line">restart-strategy: fixed-delay</span><br><span class="line">restart-strategy.fixed-delay.attempts: <span class="number">3</span></span><br><span class="line">restart-strategy.fixed-delay.delay: <span class="number">10</span> s</span><br><span class="line">第二种：应用代码设置</span><br><span class="line">env.setRestartStrategy(RestartStrategies.fixedDelayRestart(</span><br><span class="line">  <span class="number">3</span>, <span class="comment">// 尝试重启的次数</span></span><br><span class="line">  Time.of(<span class="number">10</span>, TimeUnit.SECONDS) <span class="comment">// 间隔</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure>






<h2 id="Flink-table"><a href="#Flink-table" class="headerlink" title="Flink table"></a>Flink table</h2><h3 id="over-window"><a href="#over-window" class="headerlink" title="over window"></a>over window</h3><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><ul>
<li><input disabled="" type="checkbox"> Flink Table API office</li>
<li><input disabled="" type="checkbox"> 自定义窗口</li>
<li><input disabled="" type="checkbox"> cogroup、connect与 join</li>
<li><input disabled="" type="checkbox"> CDC</li>
<li><input disabled="" type="checkbox"> flink流测试工具</li>
<li><input disabled="" type="checkbox"> 今日活动总申购次数：并发度为1，是否windowAll都会是并发度为1，是否可以先keyBy再合并？</li>
</ul>
<p>#【亿级流量 秒级统计】</p>
<p>AI、ML、DL、ANN、CNN 蛰伏数十年，就为这个大数据时代。</p>
<p>AI正以前所未有的速度改变世界，影响着我们生活的方方面面，AI走进人们的生活将成为未来的新常态。 而大数据和计算能力像水和氧气一样支撑着AI，我们的数据从手机端、服务器日志</p>
<h1 id="参考文献-1"><a href="#参考文献-1" class="headerlink" title="参考文献"></a>参考文献</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/crestofwave1/oneFlink">Flink官方文档翻译</a></li>
</ul>
<h1 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h1><h2 id="checkpoint与savepoint区别"><a href="#checkpoint与savepoint区别" class="headerlink" title="checkpoint与savepoint区别"></a>checkpoint与savepoint区别</h2><h2 id="flink-report-1"><a href="#flink-report-1" class="headerlink" title="flink report"></a>flink report</h2><h2 id="storm-trident-1"><a href="#storm-trident-1" class="headerlink" title="storm trident"></a>storm trident</h2><p>微批</p>
<p>barrier对齐</p>
<p>![flink-rm](_v_images/20190826164001201_1759200368.png =510x)</p>
<h2 id="算子-1"><a href="#算子-1" class="headerlink" title="算子"></a>算子</h2><h3 id="Reduce在流计算的应用-1"><a href="#Reduce在流计算的应用-1" class="headerlink" title="Reduce在流计算的应用"></a>Reduce在流计算的应用</h3><p>org.apache.flink.streaming.api.functions.timestamps.AscendingTimestampExtractor$LoggingHandler:140 -<br>Timestamp monotony violated: 1568772496000 &lt; 1568772500000</p>
<p>ToDo list</p>
<h1 id="avro-与-kryo-序列化的区别-1"><a href="#avro-与-kryo-序列化的区别-1" class="headerlink" title="avro 与 kryo 序列化的区别"></a>avro 与 kryo 序列化的区别</h1><p>使用场景</p>
<h1 id="broadcast"><a href="#broadcast" class="headerlink" title="broadcast"></a>broadcast</h1><h2 id="storm-allGrouping-元素广播-1"><a href="#storm-allGrouping-元素广播-1" class="headerlink" title="storm allGrouping 元素广播"></a>storm allGrouping 元素广播</h2><p>flink broadcast how to use </p>
<p>broadcast vaiable value can not be modified</p>
<p>用法<br>1：初始化数据<br>DataSet<Integer> toBroadcast = env.fromElements(1, 2, 3)<br>2：广播数据<br>.withBroadcastSet(toBroadcast, “broadcastSetName”);<br>3：获取数据<br>Collection<Integer> broadcastSet = getRuntimeContext().getBroadcastVariable(“broadcastSetName”);</p>
<ul>
<li>广播变量不能太大</li>
<li>不能修改，保证数据一致性</li>
</ul>
<h1 id="Accumulators-amp-Counters"><a href="#Accumulators-amp-Counters" class="headerlink" title="Accumulators &amp; Counters"></a>Accumulators &amp; Counters</h1><p>累加器与计数器</p>
<h2 id="spark-accumulate-1"><a href="#spark-accumulate-1" class="headerlink" title="spark accumulate"></a>spark accumulate</h2><p>用法<br>1：创建累加器<br>private IntCounter numLines = new IntCounter();<br>2：注册累加器<br>getRuntimeContext().addAccumulator(“num-lines”, this.numLines);<br>3：使用累加器<br>this.numLines.add(1);<br>4：获取累加器的结果<br>myJobExecutionResult.getAccumulatorResult(“num-lines”)</p>
<h1 id="Distributed-Cache-1"><a href="#Distributed-Cache-1" class="headerlink" title="Distributed Cache"></a>Distributed Cache</h1><blockquote>
<p>Spark 分布式缓存如何使用</p>
</blockquote>
<p>Flink提供了一个分布式缓存，类似于hadoop，可以使用户在并行函数中很方便的读取本地文件<br>此缓存的工作机制如下：程序注册一个文件或者目录(本地或者远程文件系统，例如hdfs或者s3)，通过ExecutionEnvironment注册缓存文件并为它起一个名称。当程序执行，Flink自动将文件或者目录复制到所有taskmanager节点的本地文件系统，用户可以通过这个指定的名称查找文件或者目录，然后从taskmanager节点的本地文件系统访问它<br>用法<br>1：注册一个文件<br>env.registerCachedFile(“hdfs:///path/to/your/file”, “hdfsFile”)<br>2：访问数据<br>File myFile = getRuntimeContext().getDistributedCache().getFile(“hdfsFile”);</p>
<h1 id="at-least-once-amp-exactly-once-1"><a href="#at-least-once-amp-exactly-once-1" class="headerlink" title="at least once &amp; exactly once"></a>at least once &amp; exactly once</h1><p>从容错和消息处理的语义上(at least once, exactly once)，Flink引入了state和checkpoint。</p>
<h1 id="state-2"><a href="#state-2" class="headerlink" title="state"></a>state</h1><p>默认保存在java堆中<br>checkpoint: 把state持久化存储，全局快照<br>blink做的优化</p>
<p>失败恢复机制 </p>
<p>状态分为原始状态和托管状态</p>
<p>托管状态是由Flink框架管理的状态<br>而原始状态，由用户自行管理状态具体的数据结构，框架在做checkpoint的时候，使用byte[]来读写状态内容，对其内部数据结构一无所知。<br>通常在DataStream上的状态推荐使用托管的状态，当实现一个用户自定义的operator时，会使用到原始状态。</p>
<blockquote>
<p>ReducingState 如何使用</p>
</blockquote>
<h1 id="checkpoint-2"><a href="#checkpoint-2" class="headerlink" title="checkpoint"></a>checkpoint</h1><p>Flink的checkpoint机制可以与(stream和state)的持久化存储交互的前提：<br>持久化的source，它需要支持在一定时间内重放事件。这种sources的典型例子是持久化的消息队列（比如Apache Kafka，RabbitMQ等）或文件系统（比如HDFS，S3，GFS等）<br>用于state的持久化存储，例如分布式文件系统（比如HDFS，S3，GFS等）</p>
<p>Checkpoint是Flink实现容错机制最核心的功能，它能够根据配置周期性地基于Stream中各个Operator/task的状态来生成快照，从而将这些状态数据定期持久化存储下来，当Flink程序一旦意外崩溃时，重新运行程序时可以有选择地从这些快照进行恢复，从而修正因为故障带来的程序数据异常</p>
<p>checkpoint开启之后，默认的checkPointMode是Exactly-once<br>checkpoint的checkPointMode有两种，Exactly-once和At-least-once<br>Exactly-once对于大多数应用来说是最合适的。At-least-once可能用在某些延迟超低的应用程序（始终延迟为几毫秒）</p>
<p>ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION:表示一旦Flink处理程序被cancel后，会保留Checkpoint数据，以便根据实际需要恢复到指定的Checkpoint<br>ExternalizedCheckpointCleanup.DELETE_ON_CANCELLATION: 表示一旦Flink处理程序被cancel后，会删除Checkpoint数据，只有job执行失败的时候才会保存checkpoint</p>
<h3 id="state-backend-1"><a href="#state-backend-1" class="headerlink" title="state backend"></a>state backend</h3><p>默认情况下，state会保存在taskmanager的内存中，checkpoint会存储在JobManager的内存中。<br>state 的store和checkpoint的位置取决于State Backend的配置<br>env.setStateBackend(…)<br>一共有三种State Backend<br>MemoryStateBackend<br>FsStateBackend<br>RocksDBStateBackend</p>
<p>MemoryStateBackend<br>state数据保存在java堆内存中，执行checkpoint的时候，会把state的快照数据保存到jobmanager的内存中<br>基于内存的state backend在生产环境下不建议使用<br>FsStateBackend<br>state数据保存在taskmanager的内存中，执行checkpoint的时候，会把state的快照数据保存到配置的文件系统中<br>可以使用hdfs等分布式文件系统<br>RocksDBStateBackend<br>RocksDB跟上面的都略有不同，它会在本地文件系统中维护状态，state会直接写入本地rocksdb中。同时它需要配置一个远端的filesystem uri（一般是HDFS），在做checkpoint的时候，会把本地的数据直接复制到filesystem中。fail over的时候从filesystem中恢复到本地<br>RocksDB克服了state受内存限制的缺点，同时又能够持久化到远端文件系统中，比较适合在生产中使用</p>
<p>修改State Backend的两种方式<br>第一种：单任务调整<br>修改当前任务代码<br>env.setStateBackend(new FsStateBackend(“hdfs://namenode:9000/flink/checkpoints”));<br>或者new MemoryStateBackend()<br>或者new RocksDBStateBackend(filebackend, true);【需要添加第三方依赖】<br>第二种：全局调整<br>修改flink-conf.yaml<br>state.backend: filesystem<br>state.checkpoints.dir: hdfs://namenode:9000/flink/checkpoints<br>注意：state.backend的值可以是下面几种：jobmanager(MemoryStateBackend), filesystem(FsStateBackend), rocksdb(RocksDBStateBackend)</p>
<h3 id="Restart-Strategies-重启策略-1"><a href="#Restart-Strategies-重启策略-1" class="headerlink" title="Restart Strategies(重启策略)"></a>Restart Strategies(重启策略)</h3><p>默认重启策略通过 flink-conf.yaml 指定</p>
<p>常用的重启策略<br>固定间隔 (Fixed delay)<br>失败率 (Failure rate)<br>无重启 (No restart)<br>如果没有启用 checkpointing，则使用无重启 (no restart) 策略。<br>如果启用了 checkpointing，但没有配置重启策略，则使用固定间隔 (fixed-delay) 策略，其中 Integer.MAX_VALUE 参数是尝试重启次数<br>重启策略可以在flink-conf.yaml中配置，表示全局的配置。也可以在应用代码中动态指定，会覆盖全局配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一种：全局配置 flink-conf.yaml</span><br><span class="line">restart-strategy: fixed-delay</span><br><span class="line">restart-strategy.fixed-delay.attempts: <span class="number">3</span></span><br><span class="line">restart-strategy.fixed-delay.delay: <span class="number">10</span> s</span><br><span class="line">第二种：应用代码设置</span><br><span class="line">env.setRestartStrategy(RestartStrategies.fixedDelayRestart(</span><br><span class="line">  <span class="number">3</span>, <span class="comment">// 尝试重启的次数</span></span><br><span class="line">  Time.of(<span class="number">10</span>, TimeUnit.SECONDS) <span class="comment">// 间隔</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure>


<h3 id="实时维表"><a href="#实时维表" class="headerlink" title="实时维表"></a>实时维表</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/01.%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/01.%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="实时数仓"><a href="#实时数仓" class="headerlink" title="实时数仓"></a>实时数仓</h1><h2 id="为什么构建实时数仓"><a href="#为什么构建实时数仓" class="headerlink" title="为什么构建实时数仓"></a>为什么构建实时数仓</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Hadoop/Yarn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Hadoop/Yarn/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">grep -A2 -B1 cg yarn-site.xml </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.linux-container-executor.cgroups.delete-timeout-ms<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>30000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">--</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.linux-container-executor.cgroups.memory-control.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">--</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.linux-container-executor.cgroups.oom.policy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">--</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.linux-container-executor.cgroups.hierarchy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/hadoop-yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">--</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.linux-container-executor.cgroups.mount<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">--</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.linux-container-executor.cgroups.mount-path<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/cgroup<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">--</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.linux-container-executor.cgroups.strict-resource-usage<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Kafka/kafka-schema-registry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Kafka/kafka-schema-registry/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Kafka-Schema-Registy"><a href="#Kafka-Schema-Registy" class="headerlink" title="Kafka Schema Registy"></a>Kafka Schema Registy</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>读写Kafka的数据时，需要维护数据的序列化方式和Schema，每个topic有独立的schema，如何管理schema信息呢？</p>
<p>Confluent创建了Kafka Schema Registy项目</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p><img src="https://gitee.com/averyzhang/pic-go/raw/master/img/20210527124021.svg" alt="img"></p>
<p>向 kafka 发送数据时，需要先向 Schema Registry 注册 schema，然后序列化发送到 kafka 里。当我们需要从 kafka 消费数据时，也需要先从 Schema Registry 获取 schema，然后才能解析数据。</p>
<h3 id="Schema的保存"><a href="#Schema的保存" class="headerlink" title="Schema的保存"></a>Schema的保存</h3><p>Registry 服务端将数据格式存储到 Kafka 中，对应的 topic 名称为 _schemas。存储消息的格式如下：</p>
<ul>
<li>Key 部分，包含数据格式名称，版本号，由 SchemaRegistryKey 类表示。</li>
<li>Value部分，包含数据格式名称，版本号， 数据格式 id 号，数据格式的内容，是否被删除， 由 SchemaRegistryValue 类表示。</li>
</ul>
<p>Registry 服务端在存储Kafka之前，还会将上述的 Key 和 Value 序列化，目前序列化由两种方式：</p>
<ul>
<li>json 序列化，由 ZkStringSerializer 类负责</li>
<li>将 SchemaRegistryKey 或 SchemaRegistryValue 强制转换为 String 类型保存起来</li>
</ul>
<h3 id="处理请求"><a href="#处理请求" class="headerlink" title="处理请求"></a>处理请求</h3><p>Registry 服务端主要负责两种请求，注册数据格式 schema 请求和 获取数据格式 schema 请求。</p>
<p>如果 Registry 服务端启动了高可用，说明有多个服务端在运行。如果注册 schema 请求发送给了 follower，那么 follower 会将请求转发给 leader。</p>
<p><strong>读写分离</strong></p>
<p>至于获取 schema 请求，follower 和 leader 都能处理，因为 schema 最后都存在了 kafka 中，它们直接从 kafka 里读取。</p>
<h3 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a>高可用</h3><p>如果要实现高可用，需要运行多个 Registry 服务，这些服务中必须选择出一个 leader，所有的请求都是最终 由 leader 来负责。当 leader 挂掉之后，就会触发选举操作，来选举出新的 leader。选举的实现有两种方式: 基于kafka 和 基于 zookeeper。</p>
<h4 id="基于-kafka"><a href="#基于-kafka" class="headerlink" title="基于 kafka"></a>基于 kafka</h4><p>原理是利用消费组，因为消费组的每个成员都需要和 kafka coordinator 服务端保持心跳，如果有成员挂了，那么就会触发组的重分配操作。重分配操作会从存活的成员中，选出 leader 角色。</p>
<p>KafkaGroupMasterElector 启动了一个心跳线程，定期发送心跳请求。它 实现了监听器的接口，当出发开始选举时会调用onRevoked方法，当选举完之后会调用onAssigned方法。</p>
<h4 id="基于-zookeeper"><a href="#基于-zookeeper" class="headerlink" title="基于 zookeeper"></a>基于 zookeeper</h4><p>更加简单，效率也更高。因为只有 leader 挂掉，zookeeper 才会触发重新选举。而基于 kafka 的方式，只要是有一个成员挂掉，不管它是不是 leader，都会触发重新选举。如果这个成员不是 leader，则会造成不必要的选举。</p>
<p>使用zookeeper方式的原理是，所有 Registry 服务都会监听一个临时节点，而只有 leader 才会占有这个节点。当 leader 挂掉之后，临时节点会消失。其余的服务发现临时节点不存在，就会立即尝试重新创建，而只有一个服务能够创建成功，成为 leader。</p>
<p>[参考文献]</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://zhmin.github.io/2019/04/23/kafka-schema-registry/">https://zhmin.github.io/2019/04/23/kafka-schema-registry/</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/distributed/02.%E9%99%90%E6%B5%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/distributed/02.%E9%99%90%E6%B5%81/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="02-限流"><a href="#02-限流" class="headerlink" title="02.限流"></a>02.限流</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/Flink-SQL-Join/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/Flink-SQL-Join/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flink-SQL-Join"><a href="#Flink-SQL-Join" class="headerlink" title="Flink SQL Join"></a>Flink SQL Join</h1><h2 id="双流Join"><a href="#双流Join" class="headerlink" title="双流Join"></a>双流Join</h2><h3 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a>TTL</h3><p>从 Flink 1.6 版本开始，社区引入了状态 TTL（Time-To-Live）特性。在通过Flink SQL 实现流处理时，开发者可以为作业 SQL 设置TTL，实现过期状态的自动清理，从而防止作业状态无限膨胀</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    t_date,</span><br><span class="line">    <span class="built_in">COUNT</span> ( <span class="keyword">DISTINCT</span> user_id ) <span class="keyword">AS</span> cnt_login, <span class="comment">-- 今日登录用户数</span></span><br><span class="line">    <span class="built_in">COUNT</span> ( <span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> t_date <span class="operator">=</span> t_debut <span class="keyword">THEN</span> user_id <span class="keyword">END</span> ) <span class="keyword">AS</span> cnt_new <span class="comment">-- 今日新用户数</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  (</span><br><span class="line">    <span class="comment">-- 计算每个用户有史以来的最小登录时间</span></span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">       t_date,</span><br><span class="line">       user_id,</span><br><span class="line">       <span class="built_in">MIN</span> (t_date) <span class="keyword">OVER</span> (</span><br><span class="line">             <span class="keyword">PARTITION</span> <span class="keyword">BY</span> user_id</span><br><span class="line">             <span class="keyword">ORDER</span> <span class="keyword">BY</span> proctime</span><br><span class="line">             <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">1</span> PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span></span><br><span class="line">       ) <span class="keyword">AS</span> t_debut</span><br><span class="line">    <span class="keyword">FROM</span> Login</span><br><span class="line">) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> t_date</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Query-Configuration-查询配置"><a href="#Query-Configuration-查询配置" class="headerlink" title="Query Configuration 查询配置"></a>Query Configuration 查询配置</h3><p><a target="_blank" rel="noopener" href="https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/query_configuration.html">https://ci.apache.org/projects/flink/flink-docs-stable/dev/table/streaming/query_configuration.html</a></p>
<p>Flink Table API 和SQL接口提供参数来调整连续查询的准确性和资源消耗。参数通过 <code>QueryConfig</code> 对象指定。<code>QueryConfig</code> 可以从 <code>TableEnvironment</code> 获得。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> env = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"><span class="keyword">val</span> tableEnv = <span class="type">TableEnvironment</span>.getTableEnvironment(env)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 query configuration</span></span><br><span class="line"><span class="keyword">val</span> qConfig: <span class="type">StreamQueryConfig</span> = tableEnv.queryConfig</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置查询参数</span></span><br><span class="line">qConfig.withIdleStateRetentionTime(<span class="type">Time</span>.hours(<span class="number">12</span>), <span class="type">Time</span>.hours(<span class="number">24</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义查询和 TableSink</span></span><br><span class="line"><span class="keyword">val</span> result: <span class="type">Table</span> = ???</span><br><span class="line"><span class="keyword">val</span> sink: <span class="type">TableSink</span>[<span class="type">Row</span>] = ???</span><br><span class="line"></span><br><span class="line"><span class="comment">// TableSink 发送结果表时传递查询参数</span></span><br><span class="line">result.writeToSink(sink, qConfig)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为 DataStream 时传递查询参数</span></span><br><span class="line"><span class="keyword">val</span> stream: <span class="type">DataStream</span>[<span class="type">Row</span>] = result.toAppendStream[<span class="type">Row</span>](qConfig)</span><br></pre></td></tr></table></figure>
<p>空闲状态保持时间（Idle State Retention Time）参数定义一个键的状态在一次更新之后保存多久后删除。</p>
<p>通过删除键的状态，连续查询会完全忘记它之前已经看过这个键。如果删除的键再次出现，则被视为具有相应键的第一个记录。对于前面的查询示例，这意味着 sessionId 的计数从0开始。</p>
<p>配置空闲状态保存时间有两个参数：</p>
<pre><code>minimum idle state retention time，定义非活动键的状态在删除前至少保持多少时间。
maximum idle state retention time，定义非活动键的状态在删除前最多保持多少时间。</code></pre>
<p>对于前面的查询示例：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> qConfig: <span class="type">StreamQueryConfig</span> = ???</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 idle state retention time: min = 12 hours, max = 24 hours</span></span><br><span class="line">qConfig.withIdleStateRetentionTime(<span class="type">Time</span>.hours(<span class="number">12</span>), <span class="type">Time</span>.hours(<span class="number">24</span>))</span><br></pre></td></tr></table></figure>
<p>清理状态需要额外的记录，对于 minTime 和 maxTime 较大差异的情况成本更低，因此 minTime 和 maxTime 直接必须至少相差5分钟。</p>
<h2 id="维表Join"><a href="#维表Join" class="headerlink" title="维表Join"></a>维表Join</h2><h3 id="启用AsyncIO"><a href="#启用AsyncIO" class="headerlink" title="启用AsyncIO"></a>启用AsyncIO</h3><h3 id="时间表Join-Temporal-Table-Join"><a href="#时间表Join-Temporal-Table-Join" class="headerlink" title="时间表Join: Temporal Table Join"></a>时间表Join: Temporal Table Join</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">o.amout, o.currency, r.rate, o.amount <span class="operator">*</span> r.rate</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">Orders <span class="keyword">AS</span> o</span><br><span class="line"><span class="keyword">JOIN</span> LatestRates <span class="keyword">FOR</span> <span class="built_in">SYSTEM_TIME</span> <span class="keyword">AS</span> <span class="keyword">OF</span> o.proctime <span class="keyword">AS</span> r</span><br><span class="line"><span class="keyword">ON</span> r.currency <span class="operator">=</span> o.currency</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/blink/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/blink/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/Flink-SQL-process/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/Flink-SQL-process/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flink-SQL原理之SQL执行流程"><a href="#Flink-SQL原理之SQL执行流程" class="headerlink" title="Flink SQL原理之SQL执行流程"></a>Flink SQL原理之SQL执行流程</h1><blockquote>
<p>Flink使用Calcite实现了SQL的解析、转换、执行计划优化和转换，那么，Flink SQL是如何执行的呢？</p>
</blockquote>
<h2 id="Calcite处理SQL的流程"><a href="#Calcite处理SQL的流程" class="headerlink" title="Calcite处理SQL的流程"></a>Calcite处理SQL的流程</h2><ol>
<li>SQL解析（SQL -&gt; SqlNode）: 将SQL解析为AST(抽象语法树, Calcite中用SqlNode表示)</li>
<li>SqlNode验证(SqlNode -&gt; SqlNode) : 根据元数据信息(表名、字段名、函数名和数据类型等)进行语法验证</li>
<li>语义分析(SqlNode -&gt; RelNode/RexNode: relational expression): 根据SqlNode与元数据信息构建RelNode树，也就是逻辑计划(Logical Plan)</li>
<li>逻辑计划优化(RelNode-&gt;RelNode): 优化器的核心，Calcite提供了两种Planner(HepPlanner和VolcanoPlanner),按照相应的规则(Rule)进行优化<ul>
<li>HepPlanner: 启发式优化器，RBO, 按照规则匹配，直到最大次数或遍历后不再match rule</li>
<li>VolcanoPlanner: CBO，一直迭代，直到找到cost最小的plan</li>
</ul>
</li>
<li>生成物理执行计划: 将Plan映射为Flink Graph</li>
</ol>
<h2 id="Flink-SQL的执行流程"><a href="#Flink-SQL的执行流程" class="headerlink" title="Flink SQL的执行流程"></a>Flink SQL的执行流程</h2><h3 id="测试样例"><a href="#测试样例" class="headerlink" title="测试样例"></a>测试样例</h3><p>MySQL实体表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> t_rt_agg_result(</span><br><span class="line">  ks <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> <span class="keyword">key</span> auto_increment ,</span><br><span class="line">  biz <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;biz code&#x27;</span>,</span><br><span class="line">  ei <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;first level event name&#x27;</span>,</span><br><span class="line">  sei <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;second level event name&#x27;</span>,</span><br><span class="line">  uv long <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;user count&#x27;</span>,</span><br><span class="line">  pv long <span class="keyword">NULL</span>,</span><br><span class="line">  time_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  update_time <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>数据源</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orders (</span><br><span class="line">  biz <span class="type">int</span>,</span><br><span class="line">  ei STRING,</span><br><span class="line">  sei STRING,</span><br><span class="line">  ui STRing,</span><br><span class="line">  etime <span class="type">timestamp</span>(<span class="number">3</span>),</span><br><span class="line">  watermark <span class="keyword">for</span> etime <span class="keyword">as</span> etime <span class="operator">-</span> <span class="type">interval</span> <span class="string">&#x27;5&#x27;</span> <span class="keyword">second</span> </span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">   <span class="string">&#x27;connector.type&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;filesystem&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.path&#x27;</span><span class="operator">=</span><span class="string">&#x27;/Users/zhangzuofeng1/orders.csv&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;format.type&#x27;</span><span class="operator">=</span><span class="string">&#x27;csv&#x27;</span></span><br><span class="line">) </span><br></pre></td></tr></table></figure>
<p>假设选用Blink planner运行两个SQL: </p>
<ul>
<li>创建MySQL表的DDL语句</li>
<li>从Source消费数据写入MySQL的DML语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> agg_result (</span><br><span class="line">  biz <span class="type">int</span>,</span><br><span class="line">  ei STRING,</span><br><span class="line">  sei STRING,</span><br><span class="line">  uv <span class="type">bigint</span>,</span><br><span class="line">  pv <span class="type">bigint</span>,</span><br><span class="line">  time_id STRING</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">   <span class="string">&#x27;connector.type&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.driver&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;com.mysql.cj.jdbc.Driver&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/fdata&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.table&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;t_agg_result&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;abc.ABC.123&#x27;</span></span><br><span class="line">)  </span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> MyUserTable</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">       biz,</span><br><span class="line">       ei,</span><br><span class="line">       sei,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> ui) <span class="keyword">AS</span> uv,</span><br><span class="line">       <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">AS</span> pv,</span><br><span class="line">       DATE_FORMAT(TUMBLE_START(etime, <span class="type">INTERVAL</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">MINUTE</span>), <span class="string">&#x27;yyyyMMddHHmm&#x27;</span>) <span class="keyword">AS</span> timeId</span><br><span class="line"><span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> ui <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> biz,</span><br><span class="line">         ei,</span><br><span class="line">         sei,</span><br><span class="line">         TUMBLE(etime, <span class="type">INTERVAL</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">MINUTE</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> agg_result </span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">       biz,</span><br><span class="line">       ei,</span><br><span class="line">       sei,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> ui) <span class="keyword">AS</span> uv,</span><br><span class="line">       <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">AS</span> pv,</span><br><span class="line">       DATE_FORMAT(TUMBLE_START(etime, <span class="type">INTERVAL</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">MINUTE</span>), <span class="string">&#x27;yyyyMMddHHmm&#x27;</span>) <span class="keyword">AS</span> timeId</span><br><span class="line"><span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> ui <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> biz,</span><br><span class="line">         ei,</span><br><span class="line">         sei,</span><br><span class="line">         TUMBLE(etime, <span class="type">INTERVAL</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">MINUTE</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行下面MySQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tEnv.sqlUpdate(ddlSql);</span><br><span class="line">tEnv.sqlUpdate(dmlSql);</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D; Abstract Syntax Tree &#x3D;&#x3D;</span><br><span class="line">LogicalProject(ei&#x3D;[$0], sei&#x3D;[$1], ui&#x3D;[$2], etime&#x3D;[$3])</span><br><span class="line">+- LogicalFilter(condition&#x3D;[&lt;&gt;($0, _UTF-16LE&#39;a&#39;)])</span><br><span class="line">   +- LogicalTableScan(table&#x3D;[[default_catalog, default_database, Unregistered_TableSource_1298380324, source: [CsvTableSource(read fields: ei, sei, ui, etime)]]])</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D; Optimized Logical Plan &#x3D;&#x3D;</span><br><span class="line">Calc(select&#x3D;[ei, sei, ui, etime], where&#x3D;[&lt;&gt;(ei, _UTF-16LE&#39;a&#39;:VARCHAR(10) CHARACTER SET &quot;UTF-16LE&quot;)])</span><br><span class="line">+- TableSourceScan(table&#x3D;[[default_catalog, default_database, Unregistered_TableSource_1298380324, source: [CsvTableSource(read fields: ei, sei, ui, etime)]]], fields&#x3D;[ei, sei, ui, etime])</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D; Physical Execution Plan &#x3D;&#x3D;</span><br><span class="line">Stage 1 : Data Source</span><br><span class="line">	content : Source: Custom File source</span><br><span class="line"></span><br><span class="line">	Stage 2 : Operator</span><br><span class="line">		content : CsvTableSource(read fields: ei, sei, ui, etime)</span><br><span class="line">		ship_strategy : REBALANCE</span><br><span class="line"></span><br><span class="line">		Stage 3 : Operator</span><br><span class="line">			content : SourceConversion(table&#x3D;[default_catalog.default_database.Unregistered_TableSource_1298380324, source: [CsvTableSource(read fields: ei, sei, ui, etime)]], fields&#x3D;[ei, sei, ui, etime])</span><br><span class="line">			ship_strategy : FORWARD</span><br><span class="line"></span><br><span class="line">			Stage 4 : Operator</span><br><span class="line">				content : Calc(select&#x3D;[ei, sei, ui, etime], where&#x3D;[(ei &lt;&gt; _UTF-16LE&#39;a&#39;:VARCHAR(10) CHARACTER SET &quot;UTF-16LE&quot;)])</span><br><span class="line">				ship_strategy : FORWARD</span><br></pre></td></tr></table></figure>




<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;nodes&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;Source: Custom File source&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Data Source&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;Source: Custom File source&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">1</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">11</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;CsvTableSource(read fields: biz, ei, sei, ui, etime)&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Operator&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;CsvTableSource(read fields: biz, ei, sei, ui, etime)&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;REBALANCE&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;SourceConversion(table=[default_catalog.default_database.orders, source: [CsvTableSource(read fields: biz, ei, sei, ui, etime)]], fields=[biz, ei, sei, ui, etime])&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Operator&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;SourceConversion(table=[default_catalog.default_database.orders, source: [CsvTableSource(read fields: biz, ei, sei, ui, etime)]], fields=[biz, ei, sei, ui, etime])&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">11</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;FORWARD&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">13</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;WatermarkAssigner(rowtime=[etime], watermark=[(etime - 5000:INTERVAL SECOND)])&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Operator&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;WatermarkAssigner(rowtime=[etime], watermark=[(etime - 5000:INTERVAL SECOND)])&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;FORWARD&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">14</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;Calc(select=[biz, ei, sei, ui, etime], where=[ui IS NOT NULL])&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Operator&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;Calc(select=[biz, ei, sei, ui, etime], where=[ui IS NOT NULL])&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">13</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;FORWARD&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">16</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;GroupWindowAggregate(groupBy=[biz, ei, sei], window=[TumblingGroupWindow(&#x27;w$, etime, 60000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[biz, ei, sei, COUNT(DISTINCT ui) AS uv, COUNT(*) AS pv, start(&#x27;w$) AS w$start, end(&#x27;w$) AS w$end, rowtime(&#x27;w$) AS w$rowtime, proctime(&#x27;w$) AS w$proctime])&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Operator&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;GroupWindowAggregate(groupBy=[biz, ei, sei], window=[TumblingGroupWindow(&#x27;w$, etime, 60000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[biz, ei, sei, COUNT(DISTINCT ui) AS uv, COUNT(*) AS pv, start(&#x27;w$) AS w$start, end(&#x27;w$) AS w$end, rowtime(&#x27;w$) AS w$rowtime, proctime(&#x27;w$) AS w$proctime])&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">14</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;HASH&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">17</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;Calc(select=[biz, ei, sei, uv, pv, (w$start DATE_FORMAT _UTF-16LE&#x27;yyyyMMddHHmm&#x27;) AS timeId])&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Operator&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;Calc(select=[biz, ei, sei, uv, pv, (w$start DATE_FORMAT _UTF-16LE&#x27;yyyyMMddHHmm&#x27;) AS timeId])&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">16</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;FORWARD&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">18</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;SinkConversionToTuple2&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Operator&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;SinkConversionToTuple2&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">17</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;FORWARD&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">19</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;Sink: JDBCUpsertTableSink(biz, ei, sei, uv, pv, time_id)&quot;</span>,<span class="attr">&quot;pact&quot;</span>:<span class="string">&quot;Data Sink&quot;</span>,<span class="attr">&quot;contents&quot;</span>:<span class="string">&quot;Sink: JDBCUpsertTableSink(biz, ei, sei, uv, pv, time_id)&quot;</span>,<span class="attr">&quot;parallelism&quot;</span>:<span class="number">12</span>,<span class="attr">&quot;predecessors&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">18</span>,<span class="attr">&quot;ship_strategy&quot;</span>:<span class="string">&quot;FORWARD&quot;</span>,<span class="attr">&quot;side&quot;</span>:<span class="string">&quot;second&quot;</span>&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>Parser: Provides methods for parsing SQL objects from a SQL string.</p>
<p>org.apache.flink.table.planner.delegation.PlannerBase</p>
<p>org.apache.flink.table.planner.operations.SqlToOperationConverter#convert</p>
<p>SqlNode 转换为 Operation</p>
<ol>
<li>结合元数据验证</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1803116">https://cloud.tencent.com/developer/article/1803116</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1697401">https://cloud.tencent.com/developer/article/1697401</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/case/%E6%AC%BA%E8%AF%88%E6%A3%80%E6%B5%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/case/%E6%AC%BA%E8%AF%88%E6%A3%80%E6%B5%8B/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-01 19:57:43" itemprop="dateCreated datePublished" datetime="2021-06-01T19:57:43+08:00">2021-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">aaronzhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">242</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">128</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aaronzhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
