<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Android 网络开发 网络功能是 Android 的最基本的功能之一, 本文将详细介绍 Android 网络开发.  Android网络编程专题之二:搭建测试服务器 目的是为了测试 Android 网络代码 Android网络编程专题之三:模拟简单的网络应用   下载并显示图片 HttpURLConnection GET和POST请求 HttpClient: apache-commons-ht">
<meta property="og:type" content="article">
<meta property="og:title" content="Android网络编程">
<meta property="og:url" content="http://example.com/Java/android-network/index.html">
<meta property="og:site_name" content="Guadazi">
<meta property="og:description" content="Android 网络开发 网络功能是 Android 的最基本的功能之一, 本文将详细介绍 Android 网络开发.  Android网络编程专题之二:搭建测试服务器 目的是为了测试 Android 网络代码 Android网络编程专题之三:模拟简单的网络应用   下载并显示图片 HttpURLConnection GET和POST请求 HttpClient: apache-commons-ht">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/images/android/network/android-network-SimpleServer-index.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-SimpleServer-loginSuccess.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-SimpleServer-loginFailure.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-SimpleServer-image.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-SimpleServer-uploadServer1.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-SimpleServer-project.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-multidownload-dispatcher.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-multidownload-breakpointmanager-uml.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-multidownload-uml.png">
<meta property="og:image" content="http://example.com/images/android/network/android-network-multidownload-itheima.png">
<meta property="article:published_time" content="2015-09-22T16:00:00.000Z">
<meta property="article:modified_time" content="2021-04-04T00:28:29.474Z">
<meta property="article:author" content="aaronzhang">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/android/network/android-network-SimpleServer-index.png">

<link rel="canonical" href="http://example.com/Java/android-network/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>Android网络编程 | Guadazi</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guadazi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/android-network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android网络编程
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-09-23 00:00:00" itemprop="dateCreated datePublished" datetime="2015-09-23T00:00:00+08:00">2015-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-04 08:28:29" itemprop="dateModified" datetime="2021-04-04T08:28:29+08:00">2021-04-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Android 网络开发</p>
<p>网络功能是 Android 的最基本的功能之一, 本文将详细介绍 Android 网络开发.</p>
<ol>
<li>Android网络编程专题之二:搭建测试服务器 目的是为了测试 Android 网络代码</li>
<li>Android网络编程专题之三:模拟简单的网络应用</li>
</ol>
<ul>
<li>下载并显示图片</li>
<li>HttpURLConnection GET和POST请求</li>
<li>HttpClient: apache-commons-httpclient GET和POST请求</li>
<li>WebView</li>
</ul>
<ol start="3">
<li>Android网络编程专题之四:第三方框架</li>
</ol>
<ul>
<li>AsyncHttpClient<ul>
<li>post</li>
<li>get</li>
<li>文件上传</li>
</ul>
</li>
<li>SmartImage</li>
</ul>
<ol start="4">
<li>Android网络编程专题之五:多线程断点下载</li>
</ol>
<h1 id="Android配置"><a href="#Android配置" class="headerlink" title="Android配置"></a>Android配置</h1><p>网络连接需要声明网络服务权限:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="简单的服务器端"><a href="#简单的服务器端" class="headerlink" title="简单的服务器端"></a>简单的服务器端</h2><h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p>为了支持Android的网络测试，搭建一个服务器端工程，满足如下几个要求：</p>
<ol>
<li>并支持Session和Cookie</li>
<li>支持文件上传</li>
<li>图片查看</li>
</ol>
<p>访问<code>/SimpleServer</code>进入登陆界面</p>
<p><img src="/images/android/network/android-network-SimpleServer-index.png"></p>
<p>登陆成功，显示相关的信息</p>
<p><img src="/images/android/network/android-network-SimpleServer-loginSuccess.png"></p>
<p>登陆失败，显示失败信息</p>
<p><img src="/images/android/network/android-network-SimpleServer-loginFailure.png"></p>
<p>下载图片地址</p>
<p><code>/SimpleServer/gyy.jpg</code></p>
<p><img src="/images/android/network/android-network-SimpleServer-image.png"></p>
<p>文件上传</p>
<p><code>/SimpleServer/uploadFile.jsp</code></p>
<p><img src="/images/android/network/android-network-SimpleServer-uploadServer1.png"></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>Eclipse工程目录如下</p>
<p><img src="/images/android/network/android-network-SimpleServer-project.png"></p>
<ol>
<li>创建打开<code>/SimpleServer/</code>的默认页面<code>login.jsp</code></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">	pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>登陆<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">		姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;get 提交&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">		姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;post 提交&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面有两个表单，分别用于使用<code>get</code>方法和<code>post</code>方法请求，发送请求到action–<code>login</code></p>
<ol start="2">
<li>在<code>web.xml</code>中注册</li>
</ol>
<p>在<code>web-app</code>节点下创建<code>welcome-file-list</code>子节点<br>添加页面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>login.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>welcome-file</code>是默认的欢迎页面，在不指定子页面的情况下，按照<code>welcome-file-list</code>的顺序寻找页面，直到找到页面。<br>如果所有的页面都找不到，则只能显示404了</p>
<ol start="3">
<li>在<code>web.xml</code>中注册login action</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>club.guadazi.ss.LoginAction<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>LoginAction</li>
</ol>
<p>页面登陆，登陆成功后将用户名记录到Session中，如果Session中用户名不为null则代表已经登陆。<br>如果登陆失败，输出错误信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guadazi.ss;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LoginAction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">   <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		HttpSession session = req.getSession();</span><br><span class="line">		Object pwdAttribute = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">		Object nameAttribute = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (pwdAttribute != <span class="keyword">null</span> &amp;&amp; <span class="string">&quot;abc.123&quot;</span>.equals((String) pwdAttribute)</span><br><span class="line">    &amp;&amp; nameAttribute != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String name = (String) nameAttribute;</span><br><span class="line">			session.setAttribute(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">			resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">			resp.sendRedirect(<span class="string">&quot;info.jsp&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">			PrintWriter writer = resp.getWriter();</span><br><span class="line">			writer.print(<span class="string">&quot;&lt;html&gt;&lt;head&gt;&quot;</span>);</span><br><span class="line">			writer.print(<span class="string">&quot;&lt;title&gt;&quot;</span> + <span class="string">&quot;欢迎 post&quot;</span> + <span class="string">&quot;&lt;/title&gt;&quot;</span>);</span><br><span class="line">			writer.print(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">			writer.print(<span class="string">&quot;&lt;center&gt;登陆失败!&lt;/center&gt;&quot;</span>);</span><br><span class="line">			writer.flush();</span><br><span class="line">			writer.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">   <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doPost(req, resp);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Servlet实现的过程，继承HttpServlet，HttpServlet类含有处理post和get请求的方法，重写相应的方法即可。<br>Session用于保存一次会话的所有信息，Session以键值对的形式保存信息。常常用于记录登陆信息，当登陆成功后记录用户信息到Session，<br>在其他的页面上可以判断是否登陆，如果未登陆，则显示登陆页面。<br><code>HttpServletRequest.getParameter</code>可以获取页面表单在发请求时携带的参数。<br><code>resp.sendRedirect(&quot;info.jsp&quot;);</code>页面重定向</p>
<ol start="5">
<li>info.jsp 登陆成功后显示的页面</li>
</ol>
<p>需要在头部增加Session中用户名判断信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	HttpSession session2 = request.getSession();</span><br><span class="line">	Object nameObject = session2.getAttribute(&quot;name&quot;);</span><br><span class="line">	if (nameObject == null) &#123;</span><br><span class="line">		/* 		response.sendRedirect(&quot;/SimpleServer&quot;); */</span><br><span class="line">%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">	未登录 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/SimpleServer&quot;</span>&gt;</span>点击登陆<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">&lt;%</span><br><span class="line">	return;</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<p>当为登陆时不再显示下面的信息直接return</p>
<ol start="6">
<li>上传文件页面</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;uploadFileAction&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;filename&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">value</span>=<span class="string">&quot;Press&quot;</span>&gt;</span> to upload the file!</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>enctype</code>必须指定为<code>multipart/form-data</code></p>
<ol start="7">
<li>上传文件Action</li>
</ol>
<p>使用Apache的commons-fileupload工具包在doPost方法中实现上传文件<br>commons-fileupload依赖commons-io包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line"><span class="keyword">if</span> (!ServletFileUpload.isMultipartContent(req)) &#123;</span><br><span class="line">  PrintWriter writer = resp.getWriter();</span><br><span class="line">  writer.println(<span class="string">&quot;is not multipart content!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  List&lt;FileItem&gt; list = fileUpload.parseRequest(req);</span><br><span class="line">  <span class="keyword">for</span> (FileItem fileItem : list) &#123;</span><br><span class="line">    <span class="keyword">if</span> (fileItem.isFormField()) &#123;</span><br><span class="line">      String name = fileItem.getName();</span><br><span class="line">      String value = fileItem.getString();</span><br><span class="line">      ServletOutputStream outputStream = resp.getOutputStream();</span><br><span class="line">      outputStream.write((name + <span class="string">&quot;:&quot;</span> + value).getBytes());</span><br><span class="line">      outputStream.close();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      String fileName = fileItem.getName();</span><br><span class="line">      String realPath = <span class="comment">/* this.getServletContext().getRealPath */</span>(<span class="string">&quot;/Users/Mariaaron/upload/&quot;</span>);</span><br><span class="line">      System.out.println(realPath);</span><br><span class="line">      FileOutputStream out = <span class="keyword">new</span> FileOutputStream(realPath + fileName);</span><br><span class="line">      InputStream in = fileItem.getInputStream();</span><br><span class="line">      <span class="keyword">byte</span> buffer[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">      <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> ((len = in.read(buffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        out.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">      &#125;</span><br><span class="line">      out.close();</span><br><span class="line">      in.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileUploadException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>源文件与war包的<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1qW89zyc" title="SimpleServer源码与war包下载">下载地址</a></p>
<h1 id="简单网络操作"><a href="#简单网络操作" class="headerlink" title="简单网络操作"></a>简单网络操作</h1><p>Android 网络</p>
<h2 id="Android-网络连接线程"><a href="#Android-网络连接线程" class="headerlink" title="Android 网络连接线程"></a>Android 网络连接线程</h2><ol>
<li>在 Android 中, 主线程负责更新 UI, 因此,主线程也称为 UI 线程.</li>
<li>除了ProcessBar等几个少数的控件外, 几乎所有的 UI 控件必须在主线程更新.</li>
<li>为了防止 UI 载入和更新出现卡顿, 网络连接/大图片载入以及一些大型的计算必须在子线程进行.</li>
<li>网络操作必须放在子线程, 在子线程使用 Handler 更新 UI.<br>异步框架<code>AsyncHttpClient</code>就是基于这个原理实现的.</li>
</ol>
<p>Android提供了在子线程更新 UI 的 API:<br><code>Activity.runOnUiThread(Thread thread)</code> 方法,将 Runnable 中的任务放到UI 线程执行:<br/><br>// 如果当前线程就是UI 线程立即执行,否者将把 Runnable 线程 join 到UI 线程中执行.</p>
<h2 id="Java-Socket"><a href="#Java-Socket" class="headerlink" title="Java Socket"></a>Java Socket</h2><blockquote>
<p>android简单聊天工具</p>
</blockquote>
<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>类 URL 代表一个统一资源定位符，它是指向互联网“资源”的指针。</p>
<p>创建一个到 URL 的连接需要几个步骤：</p>
<p>  openConnection() ———— 时间 —————-&gt;    connect()<br>对影响到远程资源连接的参数进行操作 ———— 时间 —————-&gt; 与资源交互；查询头字段和内容。</p>
<ol>
<li>通过在 URL 上调用 openConnection 方法创建连接对象。</li>
<li>处理设置参数和一般请求属性。</li>
<li>使用 connect 方法建立到远程对象的实际连接。</li>
<li>远程对象变为可用。远程对象的头字段和内容变为可访问。</li>
</ol>
<p>使用以下方法修改设置参数：</p>
<p>   setAllowUserInteraction<br>   setDoInput<br>   setDoOutput<br>   setIfModifiedSince<br>   setUseCaches</p>
<p>使用以下方法修改一般请求属性：</p>
<p>   setRequestProperty</p>
<p>使用 setDefaultAllowUserInteraction 和 setDefaultUseCaches 可设置 AllowUserInteraction 和 UseCaches 参数的默认值。</p>
<p>上面每个 set 方法都有一个用于获取参数值或一般请求属性值的对应 get 方法。适用的具体参数和一般请求属性取决于协议。</p>
<p>在建立到远程对象的连接后，以下方法用于访问头字段和内容：</p>
<p>   getContent<br>   getHeaderField<br>   getInputStream<br>   getOutputStream</p>
<p>某些头字段需要经常访问。以下方法：</p>
<p>   getContentEncoding<br>   getContentLength<br>   getContentType<br>   getDate<br>   getExpiration<br>   getLastModifed</p>
<p>提供对这些字段的便捷访问。getContent 方法使用 getContentType 方法以确定远程对象类型；子类重写 getContentType 方法很容易。</p>
<p>一般情况下，所有的预连接参数和一般请求属性都可忽略：预连接参数和一般请求属性默认为敏感值。对于此接口的大多数客户端而言，只有两个需要的方法：getInputStream 和 getContent，它们通过便捷方法镜像到 URL 类中。</p>
<h2 id="URLConnection"><a href="#URLConnection" class="headerlink" title="URLConnection"></a>URLConnection</h2><p>例子: 布局文件中的Button被调用时，调用loadImage方法</p>
<p>在loadImage方法中</p>
<ol>
<li>判断收入的图片地址是否为空</li>
<li>启动新的子线程，在子线程中</li>
</ol>
<p>`URLConnection urlConnection = url.openConnection();’<br>返回一个 URLConnection 对象，它表示到 URL 所引用的远程对象的连接。<br>每次调用此 URL 的协议处理程序的 openConnection 方法都打开一个新的连接。</p>
<p>如果 URL 的协议（例如，HTTP 或 JAR）存在属于以下包或其子包之一的公共、专用 URLConnection 子类：java.lang、java.io、java.util、java.net，<br>返回的连接将为该子类的类型。例如，对于 HTTP，将返回 HttpURLConnection，对于 JAR，将返回 JarURLConnection。</p>
<p>‘InputStream inputStream = urlConnection.getInputStream();’<br>从打开的连接读取输入流</p>
<blockquote>
<p>‘InputStream inputStream = urlConnection.openStream();’<br>是<code>openConnection().getInputStream()</code>的缩写形式。</p>
</blockquote>
<p>‘Bitmap bitmap = BitmapFactory.decodeStream(inputStream);`<br>把输入流解码成位图对象</p>
<ol start="3">
<li><p>创建Message，将位图对象作为<code>Message.obj</code>, 向Handler发送消息</p>
</li>
<li><p>Handler执行，更新UI</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ImageView imageView;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadImage</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> String imageUrl = imageUrlEdit.getText().toString().trim();</span><br><span class="line">   <span class="keyword">if</span> (TextUtils.isEmpty(imageUrl)) &#123;</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               URL url = <span class="keyword">new</span> URL(imageUrl);</span><br><span class="line">               HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();</span><br><span class="line">               urlConnection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">               <span class="keyword">if</span> (urlConnection.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                   InputStream inputStream = urlConnection.getInputStream();</span><br><span class="line">                   Bitmap bitmap;</span><br><span class="line">                   bitmap = BitmapFactory.decodeStream(inputStream);</span><br><span class="line">                   Message message = <span class="keyword">new</span> Message();</span><br><span class="line">                   message.what = SHOW_IMAGE_BY_URL;</span><br><span class="line">                   message.obj = bitmap;</span><br><span class="line">                   handler.sendMessage(message);</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;请求失败!&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadImage2</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> String imageUrl = imageUrlEdit.getText().toString().trim();</span><br><span class="line">   <span class="keyword">if</span> (TextUtils.isEmpty(imageUrl)) &#123;</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               URL url = <span class="keyword">new</span> URL(imageUrl);</span><br><span class="line">               HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();</span><br><span class="line">               urlConnection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">               <span class="keyword">if</span> (urlConnection.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                   InputStream inputStream = urlConnection.getInputStream();</span><br><span class="line">                   <span class="keyword">final</span> Bitmap bitmap = BitmapFactory.decodeStream(inputStream);</span><br><span class="line">                   <span class="comment">/**</span></span><br><span class="line"><span class="comment">                    * runOnUiThread 方法,将 Runnable 中的任务放到UI 线程执行:&lt;br/&gt;</span></span><br><span class="line"><span class="comment">                    * 如果当前线程就是UI 线程立即执行,否者将把 Runnable 线程 join 到UI 线程中执行.</span></span><br><span class="line"><span class="comment">                    */</span></span><br><span class="line">                   runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                       <span class="meta">@Override</span></span><br><span class="line">                       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                           imageView.setImageBitmap(bitmap);</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;.start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">            <span class="keyword">case</span> showImageByUrl:</span><br><span class="line">                Bitmap bitmap = (Bitmap) msg.obj;</span><br><span class="line">                imageView.setImageBitmap(bitmap);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    imageView = (ImageView) findViewById(R.id.iv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="HttpURLConnection"><a href="#HttpURLConnection" class="headerlink" title="HttpURLConnection"></a>HttpURLConnection</h2><p>对于上面的例子，URL的scheme是HTTP类型的，<code>URL.openConnection</code>返回的对象就是<code>HttpURLConnection</code>对象。</p>
<p>get和post方式发送登录请求的代码和纯Java环境是一模一样的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loginUrlGet</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String path = loginPath + <span class="string">&quot;?name=&quot;</span> + name + <span class="string">&quot;&amp;password=&quot;</span> + password;</span><br><span class="line">        URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">        HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();</span><br><span class="line">        urlConnection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (urlConnection.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">            InputStream inputStream = urlConnection.getInputStream();</span><br><span class="line">            String content = readAsString(inputStream);</span><br><span class="line">            showResponseOnWebView(content);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;请求失败!&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loginUrlPost</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; requestParams = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        requestParams.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        requestParams.put(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line">        StringBuilder params = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : requestParams.entrySet()) &#123;</span><br><span class="line">            params.append(entry.getKey());</span><br><span class="line">            params.append(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">            params.append(URLEncoder.encode(entry.getValue(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            params.append(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (params.length() &gt; <span class="number">0</span>) params.deleteCharAt(params.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] data = params.toString().getBytes();</span><br><span class="line">        URL url = <span class="keyword">new</span> URL(loginPath);</span><br><span class="line">        HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">        conn.setRequestMethod(<span class="string">&quot;POST&quot;</span>);<span class="comment">//必须大写</span></span><br><span class="line">        conn.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;Keep-Alive&quot;</span>);<span class="comment">//维持长连接</span></span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;Charset&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;Content-Length&quot;</span>, String.valueOf(data.length));</span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">        DataOutputStream outStream = <span class="keyword">new</span> DataOutputStream(conn.getOutputStream());</span><br><span class="line">        outStream.write(data);</span><br><span class="line">        outStream.flush();</span><br><span class="line">        <span class="keyword">if</span> (conn.getResponseCode() == <span class="number">200</span>) &#123;</span><br><span class="line">            String result = readAsString(conn.getInputStream());</span><br><span class="line">            outStream.close();</span><br><span class="line">            showResponseOnWebView(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子只是实现了登录，如果当服务器端使用了Session时，再访问其他页面登录信息是无法联系起来的。<br>而HttpClient可以</p>
<h3 id="多线程下载"><a href="#多线程下载" class="headerlink" title="多线程下载"></a>多线程下载</h3><p>见 <a href="#nulti_download">下文</a></p>
<h2 id="HttpClient-apache-commons-httpclient"><a href="#HttpClient-apache-commons-httpclient" class="headerlink" title="HttpClient: apache-commons-httpclient"></a>HttpClient: apache-commons-httpclient</h2><p>HttpClient类似于Http的客户端，也就是浏览器。<br>它会保存会话，记录登录信息，Cookie等</p>
<p>看登录并访问的例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loginHttpClientPost</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">    HttpClient httpClient = <span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">    HashMap&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    map.put(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line">    String path = loginPath;</span><br><span class="line">    path += <span class="string">&quot;?&quot;</span>;</span><br><span class="line">    Set&lt;Map.Entry&lt;String, String&gt;&gt; entries = map.entrySet();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : entries) &#123;</span><br><span class="line">        String key = entry.getKey();</span><br><span class="line">        String value = entry.getValue();</span><br><span class="line">        path += key + <span class="string">&quot;=&quot;</span> + value;</span><br><span class="line">        path += <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    path = path.substring(<span class="number">0</span>, path.length() - <span class="number">1</span>);</span><br><span class="line">    HttpPost httpPost = <span class="keyword">new</span> HttpPost(path);</span><br><span class="line">    String responseString = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        HttpResponse response = httpClient.execute(httpPost);</span><br><span class="line">        <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">            responseString = EntityUtils.toString(response.getEntity());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            responseString = <span class="string">&quot;Error Response: &quot;</span></span><br><span class="line">                    + response.getStatusLine().toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    showResponseOnWebView(responseString);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loginHttpClientGet</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建 HttpParams 以用来设置 HTTP 参数（这一部分不是必需的）</span></span><br><span class="line">    BasicHttpParams httpParams = <span class="keyword">new</span> BasicHttpParams();</span><br><span class="line">    <span class="comment">// 设置连接超时和 Socket 超时，以及 Socket 缓存大小</span></span><br><span class="line">    HttpConnectionParams.setConnectionTimeout(httpParams, <span class="number">20</span> * <span class="number">1000</span>);</span><br><span class="line">    HttpConnectionParams.setSoTimeout(httpParams, <span class="number">20</span> * <span class="number">1000</span>);</span><br><span class="line">    HttpConnectionParams.setSocketBufferSize(httpParams, <span class="number">8192</span>);</span><br><span class="line">    <span class="comment">// 设置重定向，缺省为 true</span></span><br><span class="line">    HttpClientParams.setRedirecting(httpParams, <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// 设置 user agent</span></span><br><span class="line">    String userAgent = <span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.2) Gecko/20100115 Firefox/3.6&quot;</span>;</span><br><span class="line">    HttpProtocolParams.setUserAgent(httpParams, userAgent);</span><br><span class="line">    <span class="comment">// 创建一个 HttpClient 实例</span></span><br><span class="line">    <span class="comment">// 注意 HttpClient httpClient = new HttpClient(); 是Commons HttpClient</span></span><br><span class="line">    <span class="comment">// 中的用法，在 Android 1.5 中我们需要使用 Apache 的缺省实现 DefaultHttpClient</span></span><br><span class="line">    HttpClient httpClient = <span class="keyword">new</span> DefaultHttpClient(httpParams);</span><br><span class="line">    Map params2 = <span class="keyword">new</span> HashMap();</span><br><span class="line">    params2.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    params2.put(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line">    String url = loginPath;</span><br><span class="line">     <span class="comment">/* 建立HTTPGet对象 */</span></span><br><span class="line">    String paramStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    Iterator iter = params2.entrySet().iterator();</span><br><span class="line">    <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">        Map.Entry entry = (Map.Entry) iter.next();</span><br><span class="line">        Object key = entry.getKey();</span><br><span class="line">        Object val = entry.getValue();</span><br><span class="line">        paramStr += paramStr = <span class="string">&quot;&amp;&quot;</span> + key + <span class="string">&quot;=&quot;</span> + val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!paramStr.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        paramStr = paramStr.replaceFirst(<span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;?&quot;</span>);</span><br><span class="line">        url += paramStr;</span><br><span class="line">    &#125;</span><br><span class="line">    HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">    String strResult = <span class="string">&quot;doGetError&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/* 发送请求并等待响应 */</span></span><br><span class="line">        HttpResponse httpResponse = httpClient.execute(httpGet);</span><br><span class="line">        <span class="comment">/* 若状态码为200 ok */</span></span><br><span class="line">        <span class="keyword">if</span> (httpResponse.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">/* 读返回数据 */</span></span><br><span class="line">            strResult = EntityUtils.toString(httpResponse.getEntity());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            strResult = <span class="string">&quot;Error Response: &quot;</span></span><br><span class="line">                    + httpResponse.getStatusLine().toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClientProtocolException e) &#123;</span><br><span class="line">        strResult = e.getMessage().toString();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        strResult = e.getMessage().toString();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        strResult = e.getMessage().toString();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    showResponseOnWebView(strResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<a href="3">示例工程</a>中, 服务器端在登录成功后会跳转到info.jsp页面，详见第一节</p>
<p>使用URLConnection是无法实现的。而HttpClient可以实现跳转并显示登录信息。</p>
<h2 id="WebView"><a href="#WebView" class="headerlink" title="WebView"></a>WebView</h2><p>WebView是Android内置的WebKit内核网页显示控件，使用WebView可以显示本地和网站页面。so powerful!<br>默认使用UTF-8编码</p>
<h3 id="显示本地页面中文乱码"><a href="#显示本地页面中文乱码" class="headerlink" title="显示本地页面中文乱码"></a>显示本地页面中文乱码</h3><p>显示本地页面可以使用的API有：loadData 和loadDataWithBaseURL</p>
<p>WebView.loadData(content, “text/html”, “UTF-8”);出现中文乱码了，<br>改成 loadData(data, “text/html; charset=UTF-8”, null);就不会乱码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebView.loadDataWithBaseURL(basePath, content, <span class="string">&quot;text/html&quot;</span>, <span class="string">&quot;utf-8&quot;</span>, <span class="keyword">null</span>);<span class="comment">// 可以正常显示</span></span><br><span class="line">WebView.loadDataWithBaseURL(<span class="keyword">null</span>, content, <span class="string">&quot;text/html&quot;</span>, <span class="string">&quot;utf-8&quot;</span>, <span class="keyword">null</span>);<span class="comment">// 无乱码 但无法显示图片</span></span><br></pre></td></tr></table></figure>
<p>使用loadDataWithBaseURL时,如果不传入URL时,刷新会造成白屏,因为刷新时调用的的是reload方法,<br>reload是根据传入的URL进行一次重新加载即再次loadUrl(url),不传入URL时,默认的的URL是about:blank</p>
<p>使用loadData,刷新只是从缓存里面取，但是在4.0以上的,如果按照API里所写的loadData(data, “UTF-8”, null);时会乱码,<br>如果写成<code>loadData(data, &quot;text/html; charset=UTF-8&quot;, null);</code><br>loadData最终的机制是会把传入的三个参数拼接在一起,<br>然后再进行loadUrl操作,参数就是data, “text/html; charset=UTF-8”, null这三个进行拼装,加入text/html; charset=UTF-8就相当于限定了页面的字符</p>
<p>loadData(detail,”text/html;charset=UTF-8”, null); 在小米 One S上仍然存在中文乱码的情况，<br>改成 WebView.loadDataWithBaseURL(null, detail, “text/html”, “UTF-8”, null); 就没问题。<br>在小米手机上设置<code>settings.setDefaultTextEncodingName(&quot;utf-8&quot;)</code><br>在 webview 的 settings 属性里指定 utf-8 就可以了</p>
<h1 id="第三方框架"><a href="#第三方框架" class="headerlink" title="第三方框架"></a>第三方框架</h1><h2 id="AsyncHttpClient"><a href="#AsyncHttpClient" class="headerlink" title="AsyncHttpClient"></a>AsyncHttpClient</h2><p><a target="_blank" rel="noopener" href="https://github.com/loopj/android-async-http">Github的地址</a></p>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">loginASyncHttpGet</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">    AsyncHttpClient asyncHttpClient = <span class="keyword">new</span> AsyncHttpClient();</span><br><span class="line">    RequestParams requestParams = <span class="keyword">new</span> RequestParams();</span><br><span class="line">    requestParams.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    requestParams.put(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line">    asyncHttpClient.get(loginPath, requestParams, <span class="keyword">new</span> AsyncHttpResponseHandler() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="post"><a href="#post" class="headerlink" title="post"></a>post</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">loginASyncHttpPost</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">    AsyncHttpClient asyncHttpClient = <span class="keyword">new</span> AsyncHttpClient();</span><br><span class="line">    RequestParams requestParams = <span class="keyword">new</span> RequestParams();</span><br><span class="line">    requestParams.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    requestParams.put(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line">    asyncHttpClient.post(loginPath, requestParams, <span class="keyword">new</span> AsyncHttpResponseHandler() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uploadFileAsyncHttpClient</span><span class="params">(String  selectFilePath)</span> </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(selectFilePath);</span><br><span class="line">    <span class="keyword">if</span> (file.exists() &amp;&amp; file.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        AsyncHttpClient client = <span class="keyword">new</span> AsyncHttpClient();</span><br><span class="line">        RequestParams params = <span class="keyword">new</span> RequestParams();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            params.put(<span class="string">&quot;profile_picture&quot;</span>, file);</span><br><span class="line"></span><br><span class="line">            client.post(uploadUrlEditTex.getText().toString(), params, <span class="keyword">new</span> AsyncHttpResponseHandler() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;文件上传成功!&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable throwable, String s)</span> </span>&#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;文件上传失败!&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;文件不存在&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SmartImage"><a href="#SmartImage" class="headerlink" title="SmartImage"></a>SmartImage</h2><p><a target="_blank" rel="noopener" href="https://github.com/loopj/android-smart-image-view">Github地址</a></p>
<p><a target="_blank" rel="noopener" href="http://loopj.com/android-smart-image-view/">官网</a></p>
<h1 id="多线程断点下载"><a href="#多线程断点下载" class="headerlink" title="多线程断点下载"></a>多线程断点下载</h1><p><a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1pJDvG6Z" title="多线程下载">示例代码下载地址</a></p>
<h2 id="多线程下载-1"><a href="#多线程下载-1" class="headerlink" title="多线程下载"></a>多线程下载</h2><p><a name="nulti_download">多线程下载</a>即将一个文件分割成若干部分，交给多个线程同时去下载，每个线程下载文件的一部分。以达到提速的目的。</p>
<p>为了实现多线程下载，需要如下几个步骤：</p>
<ol>
<li>为每个线程分配要下载的文件的位置</li>
<li>在本地创建同等大小的文件区域</li>
<li>从服务器下载文件的某一段数据</li>
<li>每个线程下载指定位置的数据并写入文件对应的位置</li>
</ol>
<h3 id="为每个线程分配要下载的文件的位置"><a href="#为每个线程分配要下载的文件的位置" class="headerlink" title="为每个线程分配要下载的文件的位置"></a>为每个线程分配要下载的文件的位置</h3><p><img src="/images/android/network/android-network-multidownload-dispatcher.png"></p>
<h3 id="在本地创建同等大小的文件区域"><a href="#在本地创建同等大小的文件区域" class="headerlink" title="在本地创建同等大小的文件区域"></a>在本地创建同等大小的文件区域</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 创建文件，大小与待下载的文件大小一致</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> objPath 创建文件文件名，包含完整路径</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> fileLength 文件的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createFile</span><span class="params">(String  objPath,<span class="keyword">long</span> fileLength)</span> </span>&#123;</span><br><span class="line">	RandomAccessFile raf = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		raf = <span class="keyword">new</span> RandomAccessFile(objPath, <span class="string">&quot;rwd&quot;</span>);</span><br><span class="line">		raf.setLength(fileLength);</span><br><span class="line">		raf.close();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="从服务器下载文件的某一段数据"><a href="#从服务器下载文件的某一段数据" class="headerlink" title="从服务器下载文件的某一段数据"></a>从服务器下载文件的某一段数据</h3><p>在HTTP协议中， RequestProperty <code>Range</code>用于指定下载文件片段的范围<br>格式为<code>&quot;bytes=&lt;开始位置&gt;-&lt;结束位置&gt;&quot;</code><br>一旦设定了Range属性，服务器会返回 206，表示支持部分下载。<br>不设定Range属性，服务器返回 200，表示连接正常, 可以下载。</p>
<p>因此发送请求的格式为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//downloadUrl为下载文件的网址</span></span><br><span class="line">URL url = <span class="keyword">new</span> URL(downloadUrl);</span><br><span class="line"><span class="comment">//打开远程连接</span></span><br><span class="line">HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">conn.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line"><span class="comment">//设置下载的位置</span></span><br><span class="line">conn.setRequestProperty(<span class="string">&quot;Range&quot;</span>, <span class="string">&quot;bytes=&quot;</span> + startPosition + <span class="string">&quot;-&quot;</span> + endPosition);</span><br><span class="line"><span class="keyword">if</span> (<span class="number">206</span> == conn.getResponseCode())</span><br><span class="line"><span class="comment">// DO SOMETHING</span></span><br></pre></td></tr></table></figure>
<h3 id="每个线程下载指定位置的数据并写入文件对应的位置"><a href="#每个线程下载指定位置的数据并写入文件对应的位置" class="headerlink" title="每个线程下载指定位置的数据并写入文件对应的位置"></a>每个线程下载指定位置的数据并写入文件对应的位置</h3><p>衔接上一段程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从打开的连接读入输入流</span></span><br><span class="line">InputStream inputStream = conn.getInputStream();</span><br><span class="line"><span class="comment">// 创建写入文件的RandomAccessFile对象</span></span><br><span class="line">RandomAccessFile raf = <span class="keyword">new</span> RandomAccessFile(objPath, <span class="string">&quot;rwd&quot;</span>);</span><br><span class="line"><span class="comment">//随机写文件，跳到相应的位置</span></span><br><span class="line">raf.seek(startPosition);</span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> lenCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">while</span> ((len = inputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">	lenCount += len;</span><br><span class="line">	raf.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最后记得关闭掉输入流</span></span><br><span class="line">raf.close();</span><br><span class="line">inputStream.close();</span><br></pre></td></tr></table></figure>


<h3 id="RandomAccessFile"><a href="#RandomAccessFile" class="headerlink" title="RandomAccessFile"></a>RandomAccessFile</h3><p>RandomAccessFile是一个强大的随机文件读写API，创建该对象时的参数设置为<code>&quot;rwd&quot;</code>表示立即写入硬盘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">RandomAccessFile</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">RandomAccessFile</span><span class="params">(File file,</span></span></span><br><span class="line"><span class="function"><span class="params">                        String mode)</span></span></span><br><span class="line"><span class="function">                 <span class="keyword">throws</span> FileNotFoundException</span></span><br><span class="line"><span class="function">创建从中读取和向其中写入（可选）的随机访问文件流，该文件由 File 参数指定。将创建一个新的 FileDescriptor 对象来表示此文件的连接。</span></span><br><span class="line"><span class="function">mode 参数指定用以打开文件的访问模式。允许的值及其含意为：</span></span><br><span class="line"><span class="function">值含意</span></span><br><span class="line"><span class="function">&quot;r&quot;	以只读方式打开。调用结果对象的任何 write 方法都将导致抛出 IOException。</span></span><br><span class="line"><span class="function">&quot;rw&quot;	打开以便读取和写入。如果该文件尚不存在，则尝试创建该文件。</span></span><br><span class="line"><span class="function">&quot;rws&quot;	打开以便读取和写入，对于 &quot;rw&quot;，还要求对文件的内容或元数据的每个更新都同步写入到底层存储设备。</span></span><br><span class="line"><span class="function">&quot;rwd&quot;  	打开以便读取和写入，对于 &quot;rw&quot;，还要求对文件内容的每个更新都同步写入到底层存储设备。 &quot;rws&quot; 和 &quot;rwd&quot; 模式的工作方式极其类似 FileChannel 类的 <span class="title">force</span><span class="params">(<span class="keyword">boolean</span>)</span> 方法，分别传递 <span class="keyword">true</span> 和 <span class="keyword">false</span> 参数，除非它们始终应用于每个 I/O 操作，并因此通常更为高效。如果该文件位于本地存储设备上，那么当返回此类的一个方法的调用时，可以保证由该调用对此文件所做的所有更改均被写入该设备。这对确保在系统崩溃时不会丢失重要信息特别有用。如果该文件不在本地设备上，则无法提供这样的保证。</span></span><br><span class="line"><span class="function">&quot;rwd&quot; 模式可用于减少执行的 I/O 操作数量。使用 &quot;rwd&quot; 仅要求更新要写入存储的文件的内容；使用 &quot;rws&quot; 要求更新要写入的文件内容及其元数据，这通常要求至少一个以上的低级别 I/O 操作。</span></span><br><span class="line"><span class="function">如果存在安全管理器，则使用 file 参数的路径名作为其参数调用它的 checkRead 方法，以查看是否允许对该文件进行读取访问。如果该模式允许写入，那么还使用该路径参数调用该安全管理器的 checkWrite 方法，以查看是否允许对该文件进行写入访问。</span></span><br><span class="line"><span class="function">参数：</span></span><br><span class="line"><span class="function">file - 该文件对象</span></span><br><span class="line"><span class="function">mode - 访问模式，如 上所述</span></span><br><span class="line"><span class="function">抛出：</span></span><br><span class="line"><span class="function">IllegalArgumentException - 如果此模式参数与 &quot;r&quot;、 &quot;rw&quot;、 &quot;rws&quot; 或 &quot;rwd&quot; 的其中一个不相等</span></span><br><span class="line"><span class="function">FileNotFoundException - 如果该模式为 &quot;r&quot;，但给定的文件对象不表示一个现有的常规文件，或者该模式以 &quot;rw&quot; 开头，但给定的文件对象不表示一个现有的可写常规文件，而且无法创建具有该名称的新常规文件，或者在打开或创建该文件时发生一些其他错误</span></span><br><span class="line"><span class="function">SecurityException - 如果存在安全管理器，并且其 checkRead 方法拒绝对该文件的读取访问，或者该模式为 &quot;rw&quot;，并且该安全管理器的 checkWrite 方法拒绝对该文件的写入访问</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">seek</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">seek</span><span class="params">(<span class="keyword">long</span> pos)</span></span></span><br><span class="line"><span class="function">          <span class="keyword">throws</span> IOException</span></span><br></pre></td></tr></table></figure>
<p>seek是个牛逼的，像一个游标，跳到指定的位置写数据</p>
<h2 id="断点下载"><a href="#断点下载" class="headerlink" title="断点下载"></a>断点下载</h2><p>当下载大文件时，异常下载中断或暂停下载， 为了防止造成下载资源浪费，为每一个线程提供一个记录，用于记住已经下载文件的位置。当再次启动下载时，读取记录，从中断位置继续下载。</p>
<p>为了兼容不同设备(PC和Android)存储记录文件，本文定义一个接口为不同的存储提供不同的对象，类似于适配器模式.</p>
<ul>
<li>SameDirFileBreakPointManager： 在目标文件同目录下建立记录文件(PC和Android)</li>
<li>SqliteBreakPointManager： 使用Sqlite记录(Android)</li>
<li>PropertyFileBreakPointManager：使用SharedPerferences记录(Android)</li>
</ul>
<p><img src="/images/android/network/android-network-multidownload-breakpointmanager-uml.png"></p>
<p>工程的调用关系</p>
<p><img src="/images/android/network/android-network-multidownload-uml.png"></p>
<pre><code>参考文献</code></pre>
<ol>
<li><a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1sjOMIgl" title="Android network 项目工程">itheima的教程</a> (密码: yfqk)</li>
</ol>
<p><img src="/images/android/network/android-network-multidownload-itheima.png"></p>
<ol start="2">
<li><a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1qW89zyc">SimpleServer源码</a></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Java/multithread/02.Lock-Semaphore-Atomic/" rel="prev" title="Java多线程2: Lock、信号量、原子量与队列">
      <i class="fa fa-chevron-left"></i> Java多线程2: Lock、信号量、原子量与队列
    </a></div>
      <div class="post-nav-item">
    <a href="/Java/reflection/" rel="next" title="Java 反射">
      Java 反射 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Android%E9%85%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">Android配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF"><span class="nav-number">1.1.</span> <span class="nav-text">简单的服务器端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A6%81%E6%B1%82"><span class="nav-number">1.1.1.</span> <span class="nav-text">要求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.1.2.</span> <span class="nav-text">实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">简单网络操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.1.</span> <span class="nav-text">Android 网络连接线程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-Socket"><span class="nav-number">2.2.</span> <span class="nav-text">Java Socket</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#URL"><span class="nav-number">2.3.</span> <span class="nav-text">URL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#URLConnection"><span class="nav-number">2.4.</span> <span class="nav-text">URLConnection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpURLConnection"><span class="nav-number">2.5.</span> <span class="nav-text">HttpURLConnection</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8B%E8%BD%BD"><span class="nav-number">2.5.1.</span> <span class="nav-text">多线程下载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpClient-apache-commons-httpclient"><span class="nav-number">2.6.</span> <span class="nav-text">HttpClient: apache-commons-httpclient</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebView"><span class="nav-number">2.7.</span> <span class="nav-text">WebView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E6%9C%AC%E5%9C%B0%E9%A1%B5%E9%9D%A2%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81"><span class="nav-number">2.7.1.</span> <span class="nav-text">显示本地页面中文乱码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6"><span class="nav-number">3.</span> <span class="nav-text">第三方框架</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AsyncHttpClient"><span class="nav-number">3.1.</span> <span class="nav-text">AsyncHttpClient</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#get"><span class="nav-number">3.1.1.</span> <span class="nav-text">get</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#post"><span class="nav-number">3.1.2.</span> <span class="nav-text">post</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">3.1.3.</span> <span class="nav-text">文件上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SmartImage"><span class="nav-number">3.2.</span> <span class="nav-text">SmartImage</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%96%AD%E7%82%B9%E4%B8%8B%E8%BD%BD"><span class="nav-number">4.</span> <span class="nav-text">多线程断点下载</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8B%E8%BD%BD-1"><span class="nav-number">4.1.</span> <span class="nav-text">多线程下载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E6%AF%8F%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%88%86%E9%85%8D%E8%A6%81%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">4.1.1.</span> <span class="nav-text">为每个线程分配要下载的文件的位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E6%9C%AC%E5%9C%B0%E5%88%9B%E5%BB%BA%E5%90%8C%E7%AD%89%E5%A4%A7%E5%B0%8F%E7%9A%84%E6%96%87%E4%BB%B6%E5%8C%BA%E5%9F%9F"><span class="nav-number">4.1.2.</span> <span class="nav-text">在本地创建同等大小的文件区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E7%9A%84%E6%9F%90%E4%B8%80%E6%AE%B5%E6%95%B0%E6%8D%AE"><span class="nav-number">4.1.3.</span> <span class="nav-text">从服务器下载文件的某一段数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%8F%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%B8%8B%E8%BD%BD%E6%8C%87%E5%AE%9A%E4%BD%8D%E7%BD%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B9%B6%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E5%AF%B9%E5%BA%94%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">4.1.4.</span> <span class="nav-text">每个线程下载指定位置的数据并写入文件对应的位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RandomAccessFile"><span class="nav-number">4.1.5.</span> <span class="nav-text">RandomAccessFile</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%AD%E7%82%B9%E4%B8%8B%E8%BD%BD"><span class="nav-number">4.2.</span> <span class="nav-text">断点下载</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">aaronzhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">268</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">118</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aaronzhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
