<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Guadazi">
<meta property="og:url" content="http://example.com/page/17/index.html">
<meta property="og:site_name" content="Guadazi">
<meta property="og:locale">
<meta property="article:author" content="aaronzhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>Guadazi</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guadazi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/database/MySQL/syntax_3_multitable_join/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/database/MySQL/syntax_3_multitable_join/" class="post-title-link" itemprop="url">MySQL多表关联与笛卡尔积</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-10-13 00:00:00" itemprop="dateCreated datePublished" datetime="2016-10-13T00:00:00+08:00">2016-10-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:35" itemprop="dateModified" datetime="2021-01-19T09:18:35+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DataBase/" itemprop="url" rel="index"><span itemprop="name">DataBase</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="多表关联"><a href="#多表关联" class="headerlink" title="多表关联"></a>多表关联</h1><p>内联接 外联接 左外联接 右外连接 全外连接 自然联接</p>
<h1 id="笛卡尔"><a href="#笛卡尔" class="headerlink" title="笛卡尔"></a>笛卡尔</h1><p>笛卡尔（Descartes）乘积又叫直积。假设集合A={a,b}，集合B={0,1,2}，则两个集合的笛卡尔积为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">(a,0),</span><br><span class="line">(a,1),</span><br><span class="line">(a,2),</span><br><span class="line">(b,0),</span><br><span class="line">(b,1),</span><br><span class="line">(b,2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以扩展到多个集合的情况。</p>
<h2 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a,b <span class="keyword">where</span> a.x <span class="operator">=</span> b.x; <span class="operator">/</span><span class="operator">/</span>内连接</span><br></pre></td></tr></table></figure>
<p>与</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a <span class="keyword">inner</span> <span class="keyword">join</span> b <span class="keyword">on</span> a.x<span class="operator">=</span>b.x; <span class="operator">/</span><span class="operator">/</span>内连接</span><br></pre></td></tr></table></figure>
<p>效果是一样的，都是计算笛卡尔积，对上面笛卡尔积的每一条记录看它是否满足限制条件，如果满足，则它在结果集中。</p>
<h2 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h2><p>当外连接，不加任何条件时，也会计算笛卡尔积。如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a <span class="keyword">left</span> <span class="keyword">join</span> b <span class="keyword">on</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="交叉连接-CROSS-JOIN"><a href="#交叉连接-CROSS-JOIN" class="headerlink" title="交叉连接(CROSS JOIN)"></a>交叉连接(CROSS JOIN)</h2><p>没有WHERE 子句，它返回<code>连接表</code>中所有数据行的笛卡尔积<br>先返回 左表所有行，左表行在与右表行一一组合，等于两个表相乘.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a <span class="keyword">cross</span> <span class="keyword">join</span> b <span class="keyword">where</span> a.x<span class="operator">=</span>b.x;</span><br></pre></td></tr></table></figure>
<p>等同于</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a <span class="keyword">inner</span> <span class="keyword">join</span> b <span class="keyword">on</span> a.x<span class="operator">=</span>b.x;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MySQL中不存在交叉连接</p>
</blockquote>
<h2 id="避免笛卡尔积的方法"><a href="#避免笛卡尔积的方法" class="headerlink" title="避免笛卡尔积的方法"></a>避免笛卡尔积的方法</h2><p>由于笛卡尔积的结果集是各个查询表规模之积，往往是数量级的差别。</p>
<h3 id="转换为子查询"><a href="#转换为子查询" class="headerlink" title="转换为子查询"></a>转换为子查询</h3><p>假设存在如下三个表:</p>
<p>查询方式一:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">	u.user_id <span class="keyword">AS</span> recommendUserId</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	user_info u</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> u.user_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		a.entity_id</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		address_info a</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		a.city_code <span class="operator">=</span> <span class="number">10010</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>查询方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span></span><br><span class="line">	u.user_id <span class="keyword">AS</span> recommendUserId</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	user_info u,</span><br><span class="line">	address_info a</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> a.city_code <span class="operator">=</span> <span class="string">&#x27;10010&#x27;</span></span><br></pre></td></tr></table></figure>
<p>对比发现： ‘查询方式一’使用了子查询，查询是分两步进行的，第一步先从<code>address_info</code>选出一个结果，然后在<code>user_info</code>中查询，规模为<code>user_info</code>的大小。<br>而<code>查询方式二</code>查询规模是笛卡尔积，即<code>user_info</code>与<code>address_info</code>规模之积。</p>
<h1 id="内连接-1"><a href="#内连接-1" class="headerlink" title="内连接"></a>内连接</h1><p>内连 接只保留交叉积中满足连接条件的那些行。如果某行在一个表中存在，但在另一个表中不存在，则结果表中不包括该信息。</p>
<h1 id="外连接-1"><a href="#外连接-1" class="headerlink" title="外连接"></a>外连接</h1><p>左外连 接包括内连 接和左表中未包括在内连 接中的那些行。</p>
<p>右外连 接包括内连 接和右表中未包括在内连 接中的那些行。</p>
<p>全外连 接包括内连 接以及左表和右表中未包括在内连 接中的行。<br>内连 接一般是检索两个表里连接字段都存在的数据。<br>左连接的意思是，查询左（语句前面）表里的所有内容，无论右边表里有没有。右边表里没有的内容用NULL代替。<br>右连接和左连接相反。</p>
<h2 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h2><h2 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h2><h2 id="全外连接"><a href="#全外连接" class="headerlink" title="全外连接"></a>全外连接</h2><h1 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h1><hr>
<p>[参考文献]：</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_8250c39a0101k74c.html">SQL中—-SELECT语句中内连接,左连接,右连接,自连接和全连接 </a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/Quartz/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/Quartz/" class="post-title-link" itemprop="url">Quartz应用与原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-29 14:58:00" itemprop="dateCreated datePublished" datetime="2016-08-29T14:58:00+08:00">2016-08-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:35" itemprop="dateModified" datetime="2021-01-19T09:18:35+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用</p>
<p>配置</p>
<p>集群</p>
<p>原理</p>
<p>Quartz是一个大名鼎鼎的Java版开源定时调度器，功能强悍，使用方便。</p>
<h1 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h1><p>Quartz的原理不是很复杂，只要搞明白几个概念，然后知道如何去启动和关闭一个调度程序即可。</p>
<ol>
<li><p>Job</p>
<p>表示一个工作，要执行的具体内容。此接口中只有一个方法<br>void execute(JobExecutionContext context)</p>
</li>
<li><p>JobDetail</p>
<p>JobDetail表示一个具体的可执行的调度程序，Job是这个可执行程调度程序所要执行的内容，另外JobDetail还包含了这个任务调度的方案和策略。</p>
</li>
<li><p>Trigger代表一个调度参数的配置，什么时候去调。</p>
</li>
<li><p>Scheduler代表一个调度容器，一个调度容器中可以注册多个JobDetail和Trigger。当Trigger与JobDetail组合，就可以被Scheduler容器调度了。</p>
</li>
</ol>
<h1 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleQuartzJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleQuartzJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;In SimpleQuartzJob - executing its JOB at &quot;</span></span><br><span class="line">                + <span class="keyword">new</span> Date() + <span class="string">&quot; by &quot;</span> + context.getTrigger().getDescription());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="普通"><a href="#普通" class="headerlink" title="普通"></a>普通</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="keyword">import</span> org.quartz.impl.StdSchedulerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* quartz定时器测试</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext jobExecutionContext)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> Date() + <span class="string">&quot;: doing something...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、创建JobDetial对象</span></span><br><span class="line">JobDetail jobDetail = <span class="keyword">new</span> JobDetail();</span><br><span class="line"><span class="comment">//设置工作项</span></span><br><span class="line">jobDetail.setJobClass(MyJob.class);</span><br><span class="line">jobDetail.setName(<span class="string">&quot;MyJob_1&quot;</span>);</span><br><span class="line">jobDetail.setGroup(<span class="string">&quot;JobGroup_1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、创建Trigger对象</span></span><br><span class="line">SimpleTrigger strigger = <span class="keyword">new</span> SimpleTrigger();</span><br><span class="line">strigger.setName(<span class="string">&quot;Trigger_1&quot;</span>);</span><br><span class="line">strigger.setGroup(<span class="string">&quot;Trigger_Group_1&quot;</span>);</span><br><span class="line">strigger.setStartTime(<span class="keyword">new</span> Date());</span><br><span class="line"><span class="comment">//设置重复停止时间，并销毁该Trigger对象</span></span><br><span class="line">java.util.Calendar c = java.util.Calendar.getInstance();</span><br><span class="line">c.setTimeInMillis(System.currentTimeMillis() + <span class="number">1000</span> * <span class="number">1L</span>);</span><br><span class="line">strigger.setEndTime(c.getTime());</span><br><span class="line">strigger.setFireInstanceId(<span class="string">&quot;Trigger_1_id_001&quot;</span>);</span><br><span class="line"><span class="comment">//设置重复间隔时间</span></span><br><span class="line">strigger.setRepeatInterval(<span class="number">1000</span> * <span class="number">1L</span>);</span><br><span class="line"><span class="comment">//设置重复执行次数</span></span><br><span class="line">strigger.setRepeatCount(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3、创建Scheduler对象，并配置JobDetail和Trigger对象</span></span><br><span class="line">SchedulerFactory sf = <span class="keyword">new</span> StdSchedulerFactory();</span><br><span class="line">Scheduler scheduler = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">        scheduler = sf.getScheduler();</span><br><span class="line">        scheduler.scheduleJob(jobDetail, strigger);</span><br><span class="line">        <span class="comment">//4、并执行启动、关闭等操作</span></span><br><span class="line">        scheduler.start();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SchedulerException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// try &#123;</span></span><br><span class="line"><span class="comment">//   //关闭调度器</span></span><br><span class="line"><span class="comment">//   scheduler.shutdown(true);</span></span><br><span class="line"><span class="comment">// &#125; catch (SchedulerException e) &#123;</span></span><br><span class="line"><span class="comment">//    e.printStackTrace();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p>另外一种创建的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 创建调度器</span></span><br><span class="line">  Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">  <span class="comment">// Create a JobDetail for the Job</span></span><br><span class="line">  JobDetail jobDetail = newJob(SimpleQuartzJob.class).withIdentity(<span class="string">&quot;myJob&quot;</span>, <span class="string">&quot;group1&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Date runTime = evenMinuteDate(new Date());</span></span><br><span class="line"></span><br><span class="line">  Trigger trigger = newTrigger().withIdentity(<span class="string">&quot;myTrigger&quot;</span>, <span class="string">&quot;group1&quot;</span>).startNow()</span><br><span class="line">    .withSchedule(SimpleScheduleBuilder.simpleSchedule().withIntervalInSeconds(<span class="number">5</span>).withRepeatCount(<span class="number">10</span>)).build();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Trigger trigger = newTrigger().withIdentity(&quot;myTrigger&quot;,&quot;group1&quot;).startAt(RunTime).build();</span></span><br><span class="line"></span><br><span class="line">  scheduler.scheduleJob(jobDetail, trigger);</span><br><span class="line"></span><br><span class="line">  scheduler.start();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//            Thread.sleep(60000);</span></span><br><span class="line">  System.out.println(<span class="string">&quot;goto shutdown&quot;</span>);</span><br><span class="line">  scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SchedulerException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">  <span class="comment">//        &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Crontab"><a href="#Crontab" class="headerlink" title="Crontab"></a>Crontab</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建调度器</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">  JobDetail jobDetail = newJob(SimpleQuartzJob.class).withIdentity(<span class="string">&quot;myJob2&quot;</span>, <span class="string">&quot;group1&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">  Trigger trigger = newTrigger().withIdentity(<span class="string">&quot;myTrigger3&quot;</span>, <span class="string">&quot;group1&quot;</span>).withSchedule(CronScheduleBuilder.cronSchedule(<span class="string">&quot;0/1 * * * * ?&quot;</span>)).build();</span><br><span class="line"></span><br><span class="line">  scheduler.scheduleJob(jobDetail, trigger);</span><br><span class="line">  <span class="keyword">if</span> (scheduler.isStarted()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;has started!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  scheduler.start();</span><br><span class="line">  Thread.sleep(<span class="number">60000</span>);</span><br><span class="line">  scheduler.shutdown();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SchedulerException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h2 id="与Spring结合"><a href="#与Spring结合" class="headerlink" title="与Spring结合"></a>与Spring结合</h2><h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p> </p>
<p>通过研读Quartz的源代码，和本实例，终于悟出了Quartz的工作原理。</p>
<p> 1. scheduler是一个计划调度器容器（总部），容器里面可以盛放众多的JobDetail和trigger，当容器启动后，里面的每个JobDetail都会根据trigger按部就班自动去执行。 <br> 2. JobDetail是一个可执行的工作，它本身可能是有状态的。 <br> 3. Trigger代表一个调度参数的配置，什么时候去调。 <br> 4. 当JobDetail和Trigger在scheduler容器上注册后，形成了装配好的作业（JobDetail和Trigger所组成的一对儿），就可以伴随容器启动而调度执行了。 <br> 5. scheduler是个容器，容器中有一个线程池，用来并行调度执行每个作业，这样可以提高容器效率。<br> 6. 将上述的结构用一个图来表示，如下：</p>
<p><img src="/images/java/quartz-central.png"></p>
<hr>
<p>[参考文献]:</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://lavasoft.blog.51cto.com/62575/181907/">深入解读Quartz的原理</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/io/object-serialization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/io/object-serialization/" class="post-title-link" itemprop="url">Java对象序列化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-27 11:28:00" itemprop="dateCreated datePublished" datetime="2016-08-27T11:28:00+08:00">2016-08-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:35" itemprop="dateModified" datetime="2021-01-19T09:18:35+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="/Java/advanced-engineer-outline/">&lt;&lt; Java高级软件工程师知识结构</a></p>
<ol>
<li>掌握InputStream、OutputStream、Reader、Writer的继承体系.</li>
<li>掌握字节流(FileInputStream、DataInputStream、BufferedInputStream、FileOutputSteam、DataOutputStream、BufferedOutputStream)和 字符流(BufferedReader、InputStreamReader、FileReader、BufferedWriter、OutputStreamWriter、PrintWriter、FileWriter), 并熟练运用.</li>
<li>掌握NIO实现原理及使用方法.</li>
</ol>
<p>Java IO包括:</p>
<ul>
<li><a href="/Java/io/IO-Model/">IO Model</a></li>
<li><a href="/Java/io/BIO/">Java BIO</a></li>
<li><a href="/Java/io/NIO/">Java NIO</a></li>
<li><a href="/Java/io/AIO/">Java AIO</a></li>
<li><a href="/Java/io/java-zip/">Java压缩</a></li>
<li><a href="/Java/io/object-serialization/">Java对象序列化</a></li>
<li><a href="/Java/io/java-XML-JSON/">Java XML与JSON</a></li>
</ul>
<h1 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h1><p>所谓序列化是将内存中Java对象转化为二进制字节数据, 反序列化就是从二进制字节数据转换为内存中的对象.  </p>
<ul>
<li>对象保存到文件: Java序列化将对象转换为二进制字节数据, 可以用于将内存中的对象保存到文件中.</li>
<li>复制对象：由于Java中的对象变量仅仅是栈中的一个指针, 而对象保存在堆内存中. 当<code>clone</code>复制对象时, 只是将对象中的对象变量复制, 而没有复制对象本身. 这被称为**<code>浅复制</code>**；相比之下, 使用序列化的方法, 可以将对象的值转换为二进制字节数组, 再<code>反序列化</code>便可以复制对象的所有内容, 这就是<code>深复制</code>.</li>
<li>自定义序列化</li>
</ul>
<h2 id="实现的样例"><a href="#实现的样例" class="headerlink" title="实现的样例"></a>实现的样例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">123l</span>;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> birthday;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, birthday=&quot;</span> + birthday +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">long</span> birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line">   ....<span class="comment">// getter setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="实现要点"><a href="#实现要点" class="headerlink" title="实现要点"></a>实现要点</h2><h3 id="Serializable接口"><a href="#Serializable接口" class="headerlink" title="Serializable接口"></a>Serializable接口</h3><p>Java是通过实现Serializable接口, 实现的序列化, Serializable接口里面没有任何的方法, 只是个标示接口.</p>
<h3 id="SerialVersionUID"><a href="#SerialVersionUID" class="headerlink" title="SerialVersionUID"></a>SerialVersionUID</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = ...;</span><br></pre></td></tr></table></figure>
<p><code>serialVersionUID</code>变量用于标记该类的版本UID.</p>
<p>Java使用一种<code>hash</code>值来快速的区分序列化流中的对象与要转换为的对象是否相同. 该 <code>hash</code>值 是根据给定源文件中几乎所有东西 — 方法名称、字段名称、字段类型、访问修改方法等 — 计算出来的, 序列化将该 hash 值与序列化流中的 hash 值相比较. 这个<code>hash</code>值就是<code>serialVersionUID</code>，<code>serialVersionUID</code>变量可以手动指定, 如果不指定, Java将使用 JDK<code>serialver</code> 命令计算出.</p>
<h3 id="ObjectOutputStream"><a href="#ObjectOutputStream" class="headerlink" title="ObjectOutputStream"></a>ObjectOutputStream</h3><p>实际的序列化和反序列化工作是通过ObjectOuputStream和ObjectInputStream来完成的。ObjectOutputStream的writeObject方法可以把一个Java对象写入到流中，ObjectInputStream的readObject方法可以从流中读取一个Java对象。在写入和读取的时候，虽然用的参数或返回值是单个对象，但实际上操纵的是一个对象图，包括该对象所引用的其它对象，以及这些对象所引用的另外的对象。Java会自动帮你遍历对象图并逐个序列化。除了对象之外，Java中的基本类型和数组也是可以通过 ObjectOutputStream和ObjectInputStream来序列化的。<br>下面的深复制是将内存中的二进制数组作为媒介来复制对象的. <a href="/Java/io/BIO/">关于ObjectOutputStream详情请看</a></p>
<h1 id="深复制与浅复制"><a href="#深复制与浅复制" class="headerlink" title="深复制与浅复制"></a>深复制与浅复制</h1><p>基础变量和对象的引用变量都是保存在JVM栈内存(<code>stack</code>)之中的, 而对象保存在JVM堆(Heap)内存中.<a href="/Java/JVM/">^JVM结构</a></p>
<p>实现<code>Clonable</code>接口, 并调用对象上的<code>clone</code>方法, 只会将JVM栈内存(stack)复制到新对象之中. 对象的引用变量所引用的对象实体不能使用.  这就是<code>浅复制</code>.</p>
<p>为了可以复制对象的所有的内容, 可以采用将目标序列化到内存中, 转换为二进制数据, 然后再反序列化回对象. 这就是”<code>深复制</code>“.</p>
<p>上代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShallowCopy</span> <span class="keyword">implements</span> <span class="title">Cloneable</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浅复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> ShallowCopy <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (ShallowCopy) <span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 深复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShallowCopy <span class="title">deepClone</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(baos);</span><br><span class="line">        oos.writeObject(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        ByteArrayInputStream bis = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(bis);</span><br><span class="line">        ShallowCopy shallowCopy = (ShallowCopy) ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> shallowCopy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="序列化多个目标"><a href="#序列化多个目标" class="headerlink" title="序列化多个目标"></a>序列化多个目标</h1><p>如上文所述, 序列化是将对象转换为字节数组, 需要<code>ObjectOutputStream</code>和<code>ObjectInputStream</code>实现. 因此, 可以向<code>ObjectOutputStream</code>输出多个对象, 也可以从<code>ObjectInputStream</code>中输入多个对象.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeObjects</span><span class="params">(List os, String fileName)</span> </span>&#123;</span><br><span class="line">    FileOutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        outputStream = <span class="keyword">new</span> FileOutputStream(fileName);</span><br><span class="line">        ObjectOutputStream stream = <span class="keyword">new</span> ObjectOutputStream(outputStream);</span><br><span class="line">        <span class="keyword">for</span> (Object o : os) &#123;</span><br><span class="line">            stream.writeObject(o);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (outputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                outputStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">readObjects</span><span class="params">(String fileName, Class&lt;T&gt; clasz)</span> </span>&#123;</span><br><span class="line">    FileInputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">    T result = <span class="keyword">null</span>;</span><br><span class="line">    List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        inputStream = <span class="keyword">new</span> FileInputStream(fileName);</span><br><span class="line">        ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(inputStream);</span><br><span class="line">        Object object = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span> ((object = in.readObject()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            result = (T) object;</span><br><span class="line">            list.add(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="序列化允许重构"><a href="#序列化允许重构" class="headerlink" title="序列化允许重构"></a>序列化允许重构</h1><p>序列化在保存对象的同时, 也就保存了数据. 序列化也成为保存数据的方式之一. 与数据库、XML或JSON等方式不同, 序列化依赖于对象体. 当变更数据项时, 需要修改类. 序列化是允许重构的.</p>
<p>序列化允许一定数量的类变种, 甚至重构之后也是如此, ObjectInputStream 仍可以很好地将其读出来.<br>Java Object Serialization 规范可以自动管理的关键任务是：</p>
<ul>
<li>将新字段添加到类中</li>
<li>将字段从 static 改为非 static</li>
<li>将字段从 transient 改为非 transient</li>
</ul>
<p>取决于所需的向后兼容程度, 转换字段形式（从非 static 转换为 static 或从非 transient 转换为 transient）或者删除字段需要额外的消息传递.</p>
<p>假设要在上面的<code>Person</code>类增加<code>gender</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">123l</span>;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> birthday;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> gender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;PersonV1&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, birthday=&quot;</span> + birthday +</span><br><span class="line">                <span class="string">&quot;, gender=&quot;</span> + gender +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">long</span> birthday, <span class="keyword">int</span> gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// setter getter .....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重构, 需要满足两个条件：</p>
<ul>
<li>serialVersionUID必须相同</li>
<li>类名必须与原类相同</li>
</ul>
<p>为了使 Java 运行时相信两种类型实际上是一样的, 第二版和随后版本的 <code>Person</code> 必须与第一版有相同的序列化版本 hash（存储为 private static final <code>serialVersionUID</code> 字段）. 因此, 我们需要 <code>serialVersionUID</code> 字段, 它是通过对原始（或 V1）版本的 <code>Person</code> 类运行 JDK<code>serialver</code> 命令计算出的.</p>
<p>一旦有了 <code>Person</code> 的 <code>serialVersionUID</code>, 不仅可以从原始对象 <code>Person</code> 的序列化数据创建 <code>PersonV2</code> 对象（当出现新字段时, 新字段被设为缺省值, 最常见的是“null”）, 还可以反过来做：即从 <code>PersonV2</code> 的数据通过反序列化得到 <code>Person</code>, 这毫不奇怪.</p>
<h1 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h1><p>Java对象序列化之后的内容格式是公开的。所以可以很容易的从中提取出各种信息。从实现的角度来说，可以从不同的层次来加强序列化的安全性。<br>对序列化之后的流进行加密。这可以通过CipherOutputStream来实现。实现自己的writeObject和readObject方法，在调用defaultWriteObject之前，先对要序列化的域的值进行加密处理。使用一个SignedObject或SealedObject来封装当前对象，用SignedObject或SealedObject进行序列化。在从流中进行反序列化的时候，可以通过ObjectInputStream的registerValidation方法添加ObjectInputValidation接口的实现，用来验证反序列化之后得到的对象是否合法。</p>
<h2 id="自定义序列化，提高安全性"><a href="#自定义序列化，提高安全性" class="headerlink" title="自定义序列化，提高安全性"></a>自定义序列化，提高安全性</h2><p>为了避免保存的数据被恶意利用, 可以通过模糊化需要保密的字段. 此处, hook<code>Person</code>类中的<code>age</code>字段, 在上面的<code>Person</code>类中添加两个方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 自定义将对象写入输出流的方法&lt;br/&gt;</span></span><br><span class="line"><span class="comment">* 此处, 判断性别为女, 将年龄左移2个单位</span></span><br><span class="line"><span class="comment">* &lt;code&gt;stream.defaultWriteObject();&lt;/code&gt;接下来将所有的对象写入.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream stream)</span> <span class="keyword">throws</span> java.io.IOException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (gender == <span class="number">1</span>) &#123;</span><br><span class="line">    age = age &lt;&lt; <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  stream.defaultWriteObject();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 自定义从输入流读入对象的方法:</span></span><br><span class="line"><span class="comment">* 与写对应, 在读入对象后, 女士的年龄右移2个单位</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream stream)</span></span></span><br><span class="line"><span class="function">  <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">  stream.defaultReadObject();</span><br><span class="line">  <span class="keyword">if</span> (gender == <span class="number">1</span>) &#123;  </span><br><span class="line">    age = age &gt;&gt; <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当调用<code>ObjectInputStream</code>读入对象时, 首先判断是否Entity实现了<code>readObject</code>方法, 如果实现了将调用该方法.</p>
<h1 id="签名与密封"><a href="#签名与密封" class="headerlink" title="签名与密封"></a>签名与密封</h1><p>//TODO</p>
<p>如果需要对整个对象进行加密和签名, 最简单的是将它放在一个 javax.crypto.SealedObject 和/或 java.security.SignedObject 包装器中. 两者都是可序列化的, 所以将对象包装在 SealedObject 中可以围绕原对象创建一种 “包装盒”. 必须有对称密钥才能解密, 而且密钥必须单独管理. 同样, 也可以将 SignedObject 用于数据验证, 并且对称密钥也必须单独管理.<br>结合使用这两种对象, 便可以轻松地对序列化数据进行密封和签名, 而不必强调关于数字签名验证或加密的细节. 很简洁, 是吧？</p>
<h1 id="将代理放在流中"><a href="#将代理放在流中" class="headerlink" title="将代理放在流中"></a>将代理放在流中</h1><p>很多情况下, 类中包含一个核心数据元素, 通过它可以派生或找到类中的其他字段. 在此情况下, 没有必要序列化整个对象. 可以将字段标记为<em>transient</em>, 但是每当有方法访问一个字段时, 类仍然必须显式地产生代码来检查它是否被初始化.</p>
<p>如果首要问题是序列化, 那么最好指定一个 flyweight 或代理放在流中. 为原始 <code>Person</code> 提供一个 <code>writeReplace</code> 方法, 可以序列化不同类型的对象来代替它. 类似地, 如果反序列化期间发现一个 <code>readResolve</code> 方法, 那么将调用该方法, 将替代对象提供给调用者.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonProxy</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonProxy</span><span class="params">(Person orig)</span></span>&#123;</span><br><span class="line">        data = orig.getFirstName() + <span class="string">&quot;,&quot;</span> + orig.getLastName() + <span class="string">&quot;,&quot;</span> + orig.getAge();</span><br><span class="line">        <span class="keyword">if</span> (orig.getSpouse() != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Person spouse = orig.getSpouse();</span><br><span class="line">            data = data + <span class="string">&quot;,&quot;</span> + spouse.getFirstName() + <span class="string">&quot;,&quot;</span> + spouse.getLastName() + <span class="string">&quot;,&quot;</span>  </span><br><span class="line">              + spouse.getAge();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String data;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> java.io.ObjectStreamException</span>&#123;</span><br><span class="line">        String[] pieces = data.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        Person result = <span class="keyword">new</span> Person(pieces[<span class="number">0</span>], pieces[<span class="number">1</span>], Integer.parseInt(pieces[<span class="number">2</span>]));</span><br><span class="line">        <span class="keyword">if</span> (pieces.length &gt; <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            result.setSpouse(<span class="keyword">new</span> Person(pieces[<span class="number">3</span>], pieces[<span class="number">4</span>], Integer.parseInt</span><br><span class="line">              (pieces[<span class="number">5</span>])));</span><br><span class="line">            result.getSpouse().setSpouse(result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String fn, String ln, <span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = fn; <span class="keyword">this</span>.lastName = ln; <span class="keyword">this</span>.age = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> firstName; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> lastName; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> age; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">getSpouse</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> spouse; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">writeReplace</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> java.io.ObjectStreamException</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PersonProxy(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String value)</span> </span>&#123; firstName = value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String value)</span> </span>&#123; lastName = value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123; age = value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpouse</span><span class="params">(Person value)</span> </span>&#123; spouse = value; &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[Person: firstName=&quot;</span> + firstName +</span><br><span class="line">            <span class="string">&quot; lastName=&quot;</span> + lastName +</span><br><span class="line">            <span class="string">&quot; age=&quot;</span> + age +</span><br><span class="line">            <span class="string">&quot; spouse=&quot;</span> + spouse.getFirstName() +</span><br><span class="line">            <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Person spouse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>注意, <code>PersonProxy</code> 必须跟踪 <code>Person</code> 的所有数据. 这通常意味着代理需要是 <code>Person</code> 的一个内部类, 以便能访问 private 字段. 有时候, 代理还需要追踪其他对象引用并手动序列化它们, 例如 <code>Person</code> 的 spouse.</p>
<p>这种技巧是少数几种不需要读/写平衡的技巧之一. 例如, 一个类被重构成另一种类型后的版本可以提供一个 <code>readResolve</code> 方法, 以便静默地将被序列化的对象转换成新类型. 类似地, 它可以采用 <code>writeReplace</code> 方法将旧类序列化成新版本.</p>
<h1 id="信任但要验证"><a href="#信任但要验证" class="headerlink" title="信任但要验证"></a>信任但要验证</h1><p>认为序列化流中的数据总是与最初写到流中的数据一致, 这没有问题. 但是, 正如一位美国前总统所说的, “信任, 但要验证”.</p>
<p>对于序列化的对象, 这意味着验证字段, 以确保在反序列化之后它们仍具有正确的值, “以防万一”. 为此, 可以实现 <code>ObjectInputValidation</code>接口, 并覆盖 <code>validateObject()</code> 方法. 如果调用该方法时发现某处有错误, 则抛出一个 <code>InvalidObjectException</code>.</p>
<h1 id="声明某个字段不序列化"><a href="#声明某个字段不序列化" class="headerlink" title="声明某个字段不序列化"></a>声明某个字段不序列化</h1><p>在默认的序列化实现中，Java对象中的非静态和非瞬时域都会被包括进来，而与域的可见性声明没有关系。这可能会导致某些不应该出现的域被包含在序列化之后的字节数组中，比如密码等隐私信息。由于Java对象序列化之后的格式是固定的，其它人可以很容易的从中分析出其中的各种信息。对于这种情况，一种解决办法是把域声明为瞬时的，即使用transient关键词。另外一种做法是添加一个serialPersistentFields?</p>
<p>域来声明序列化时要包含的域。从这里可以看到在Java序列化机制中的这种仅在书面层次上定义的契约。声明序列化的域必须使用固定的名称和类型。在后面还可以看到其它类似这样的契约。虽然Serializable只是一个标记接口，但它其实是包含有不少隐含的要求。下面的代码给出了<br> serialPersistentFields的声明示例，即只有firstName这个域是要被序列化的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectStreamField[] serialPersistentFields = &#123;</span><br><span class="line">    <span class="keyword">new</span> ObjectStreamField(<span class="string">&quot;firstName&quot;</span>, String.class)</span><br><span class="line">&#125;;  </span><br></pre></td></tr></table></figure>
<h1 id="定制化序列化Externalizable"><a href="#定制化序列化Externalizable" class="headerlink" title="定制化序列化Externalizable"></a>定制化序列化Externalizable</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 序列化和反序列化的操作</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExternalizableDemo</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        ser(); <span class="comment">// 序列化</span></span><br><span class="line">        dser(); <span class="comment">// 反序列话</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ser</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;d:&quot;</span> + File.separator + <span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">        ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(</span><br><span class="line">                file));</span><br><span class="line">        out.writeObject(<span class="keyword">new</span> Person(<span class="string">&quot;rollen&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dser</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;d:&quot;</span> + File.separator + <span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">        ObjectInputStream input = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(</span><br><span class="line">                file));</span><br><span class="line">        Object obj = input.readObject();</span><br><span class="line">        input.close();</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Externalizable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;姓名：&quot;</span> + name + <span class="string">&quot;  年龄：&quot;</span> + age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复写这个方法, 根据需要可以保存的属性或者具体内容, 在序列化的时候使用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        out.writeObject(<span class="keyword">this</span>.name);</span><br><span class="line">        out.writeInt(age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 复写这个方法, 根据需要读取内容 反序列话的时候需要</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            ClassNotFoundException</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = (String) in.readObject();</span><br><span class="line">        <span class="keyword">this</span>.age = in.readInt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="疑问"><a href="#疑问" class="headerlink" title="疑问:"></a>疑问:</h1><ol>
<li>转换成的二进制数据是什么样子？</li>
<li>Enum类型的变量是否能正确的序列化和反序列化？</li>
</ol>
<h1 id="其他序列化框架"><a href="#其他序列化框架" class="headerlink" title="其他序列化框架"></a>其他序列化框架</h1><h2 id="kryo"><a href="#kryo" class="headerlink" title="kryo"></a>kryo</h2><hr>
<p>[参考文献]:</p>
<ol>
<li>Think in Java</li>
<li><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/java/j-5things1/">关于 Java 对象序列化您不知道的 5 件事</a></li>
<li><a target="_blank" rel="noopener" href="http://www.infoq.com/cn/articles/cf-java-object-serialization-rmi/">Java深度历险（十）——Java对象序列化与RMI</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/lang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/lang/" class="post-title-link" itemprop="url">Java基本语法与小错误</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-18 14:58:00" itemprop="dateCreated datePublished" datetime="2016-08-18T14:58:00+08:00">2016-08-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:35" itemprop="dateModified" datetime="2021-01-19T09:18:35+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h1 id="常见的小错误"><a href="#常见的小错误" class="headerlink" title="常见的小错误"></a>常见的小错误</h1><h2 id="装箱类型为null时与基本类型比较"><a href="#装箱类型为null时与基本类型比较" class="headerlink" title="装箱类型为null时与基本类型比较"></a>装箱类型为<code>null</code>时与基本类型比较</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Integer i = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">	System.out.println(<span class="string">&quot;success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当装箱类型遇到比较运算符的时候，会首先调用相应的方法将装箱类型转换为基本类型，如果装箱类型变量为null，运行将会抛出<code>java.lang.NullPointerException</code>异常；而对于非装箱类型如<code>String</code>则没有这种情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String string = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (string == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">  	System.out.println(<span class="string">&quot;success!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="String-split"><a href="#String-split" class="headerlink" title="String.split"></a>String.split</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String[] split(String regex,</span><br><span class="line">                      <span class="keyword">int</span> limit)</span><br><span class="line"><span class="comment">// The limit parameter controls the number of times the pattern is applied and therefore affects the length of the resulting array. If the limit n is greater than zero then the pattern will be applied at most n - 1 times, the array&#x27;s length will be no greater than n, and the array&#x27;s last entry will contain all input beyond the last matched delimiter. If n is non-positive then the pattern will be applied as many times as possible and the array can have any length. If n is zero then the pattern will be applied as many times as possible, the array can have any length, and trailing empty strings will be discarded.</span></span><br><span class="line"><span class="comment">// 1. -1 pattern将应用尽可能多的次数</span></span><br><span class="line"><span class="comment">// 2. 0 pattern将应用尽可能多的次数，默认的空字符串将忽略</span></span><br><span class="line"><span class="comment">// 3. n&gt;0 pattern将应用n-1次，最后一个元素会包含所有分隔符后的输入</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/skill/JDBC-generate-entity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/skill/JDBC-generate-entity/" class="post-title-link" itemprop="url">JDBC-根据数据表生成Entity</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-12 11:03:00" itemprop="dateCreated datePublished" datetime="2016-08-12T11:03:00+08:00">2016-08-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:35" itemprop="dateModified" datetime="2021-01-19T09:18:35+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="/Java/jdbc/">上文</a> 主要介绍了JDBC的使用和目前框架中的优化等，本上主要介绍一个非常实用的例子: <strong>根据数据表生成Entity</strong></p>
<h1 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h1><p><code>Entity</code>或者<code>DTO</code>是Java中与数据表相对应的实体，将对象的属性封装有利于数据操作(如从数据库中读取某个实体，对这个实体操作，修改，新增等)，根据数据表生成Entity是必须应对的问题（当然可以选择手动敲），目前常用的方法有：</p>
<ul>
<li>Hibernate工具: Eclipse和Intellij IDEA有相应的插件</li>
<li>Mybatis-generator: 是生成Mybatis的Mapper、Entity和Dao的工具，<a href="JavaWeb/MyBatis/generator/">关于如何与Maven结合使用请参考</a></li>
</ul>
<p>本文编写的工具，直接使用JDBC API编写，不依赖IDE和ORM。</p>
<h1 id="DatabaseMetaData"><a href="#DatabaseMetaData" class="headerlink" title="DatabaseMetaData"></a>DatabaseMetaData</h1><p><a target="_blank" rel="noopener" href="http://tool.oschina.net/uploads/apidocs/jdk-zh/java/sql/DatabaseMetaData.html"><code>DatabaseMetaData</code></a>是<code>java.sql</code>中提供的关于数据库整体信息的API，这个接口使用驱动程序实现的，数据库的开发商对这个接口提供支持并使用不同的方式实现。在本例中使用的是<code>MySQL</code>数据库，也是由<code>mysql-connector-java.jar</code>提供的。</p>
<p><a target="_blank" rel="noopener" href="http://tool.oschina.net/uploads/apidocs/jdk-zh/java/sql/DatabaseMetaData.html"><code>DatabaseMetaData</code></a> 提高了数据库的整体信息，包括了数据表的信息。一个重要的方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">getColumns</span><br><span class="line"></span><br><span class="line"><span class="function">ResultSet <span class="title">getColumns</span><span class="params">(String catalog,</span></span></span><br><span class="line"><span class="function"><span class="params">                     String schemaPattern,</span></span></span><br><span class="line"><span class="function"><span class="params">                     String tableNamePattern,</span></span></span><br><span class="line"><span class="function"><span class="params">                     String columnNamePattern)</span></span></span><br><span class="line"><span class="function">                     <span class="keyword">throws</span> SQLException</span></span><br><span class="line"><span class="function">获取可在指定类别中使用的表列的描述。</span></span><br><span class="line"><span class="function">仅返回与类别、模式、表和列名称标准匹配的列描述。它们根据 TABLE_CAT、TABLE_SCHEM、TABLE_NAME 和 ORDINAL_POSITION 进行排序。</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">每个列描述都有以下列：</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  TABLE_CAT String </span>=&gt; 表类别（可为 <span class="keyword">null</span>）</span><br><span class="line">  TABLE_SCHEM String =&gt; 表模式（可为 <span class="keyword">null</span>）</span><br><span class="line">  TABLE_NAME String =&gt; 表名称</span><br><span class="line">  COLUMN_NAME String =&gt; 列名称</span><br><span class="line">  DATA_TYPE <span class="keyword">int</span> =&gt; 来自 java.sql.Types 的 SQL 类型</span><br><span class="line">  TYPE_NAME String =&gt; 数据源依赖的类型名称，对于 UDT，该类型名称是完全限定的</span><br><span class="line">  COLUMN_SIZE <span class="keyword">int</span> =&gt; 列的大小。</span><br><span class="line">  BUFFER_LENGTH 未被使用。</span><br><span class="line">  DECIMAL_DIGITS <span class="keyword">int</span> =&gt; 小数部分的位数。对于 DECIMAL_DIGITS 不适用的数据类型，则返回 Null。</span><br><span class="line">  NUM_PREC_RADIX <span class="keyword">int</span> =&gt; 基数（通常为 <span class="number">10</span> 或 <span class="number">2</span>）</span><br><span class="line">  NULLABLE <span class="keyword">int</span> =&gt; 是否允许使用 NULL。</span><br><span class="line">  columnNoNulls - 可能不允许使用 NULL 值</span><br><span class="line">  columnNullable - 明确允许使用 NULL 值</span><br><span class="line">  columnNullableUnknown - 不知道是否可使用 <span class="keyword">null</span></span><br><span class="line">  REMARKS String =&gt; 描述列的注释（可为 <span class="keyword">null</span>）</span><br><span class="line">  COLUMN_DEF String =&gt; 该列的默认值，当值在单引号内时应被解释为一个字符串（可为 <span class="keyword">null</span>）</span><br><span class="line">  SQL_DATA_TYPE <span class="keyword">int</span> =&gt; 未使用</span><br><span class="line">  SQL_DATETIME_SUB <span class="keyword">int</span> =&gt; 未使用</span><br><span class="line">  CHAR_OCTET_LENGTH <span class="keyword">int</span> =&gt; 对于 <span class="keyword">char</span> 类型，该长度是列中的最大字节数</span><br><span class="line">  ORDINAL_POSITION <span class="keyword">int</span> =&gt; 表中的列的索引（从 <span class="number">1</span> 开始）</span><br><span class="line">  IS_NULLABLE String =&gt; ISO 规则用于确定列是否包括 <span class="keyword">null</span>。</span><br><span class="line">  YES --- 如果参数可以包括 NULL</span><br><span class="line">  NO --- 如果参数不可以包括 NULL</span><br><span class="line">  空字符串 --- 如果不知道参数是否可以包括 <span class="keyword">null</span></span><br><span class="line">  SCOPE_CATLOG String =&gt; 表的类别，它是引用属性的作用域（如果 DATA_TYPE 不是 REF，则为 <span class="keyword">null</span>）</span><br><span class="line">  SCOPE_SCHEMA String =&gt; 表的模式，它是引用属性的作用域（如果 DATA_TYPE 不是 REF，则为 <span class="keyword">null</span>）</span><br><span class="line">  SCOPE_TABLE String =&gt; 表名称，它是引用属性的作用域（如果 DATA_TYPE 不是 REF，则为 <span class="keyword">null</span>）</span><br><span class="line">  SOURCE_DATA_TYPE <span class="keyword">short</span> =&gt; 不同类型或用户生成 Ref 类型、来自 java.sql.Types 的 SQL 类型的源类型（如果 DATA_TYPE 不是 DISTINCT 或用户生成的 REF，则为 <span class="keyword">null</span>）</span><br><span class="line">  IS_AUTOINCREMENT String =&gt; 指示此列是否自动增加</span><br><span class="line">    YES --- 如果该列自动增加</span><br><span class="line">    NO --- 如果该列不自动增加</span><br><span class="line">    空字符串 --- 如果不能确定该列是否是自动增加参数</span><br><span class="line">  COLUMN_SIZE 列表示给定列的指定列大小。对于数值数据，这是最大精度。对于字符数据，这是字符长度。对于日期时间数据类型，这是 String 表示形式的字符长度（假定允许的最大小数秒组件的精度）。对于二进制数据，这是字节长度。对于 ROWID 数据类型，这是字节长度。对于列大小不适用的数据类型，则返回 Null。</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line">  catalog - 类别名称；它必须与存储在数据库中的类别名称匹配；该参数为 <span class="string">&quot;&quot;</span> 表示获取没有类别的那些描述；为 <span class="keyword">null</span> 则表示该类别名称不应该用于缩小搜索范围</span><br><span class="line">  schemaPattern - 模式名称的模式；它必须与存储在数据库中的模式名称匹配；该参数为 <span class="string">&quot;&quot;</span> 表示获取没有模式的那些描述；为 <span class="keyword">null</span> 则表示该模式名称不应该用于缩小搜索范围</span><br><span class="line">  tableNamePattern - 表名称模式；它必须与存储在数据库中的表名称匹配</span><br><span class="line">  columnNamePattern - 列名称模式；它必须与存储在数据库中的列名称匹配</span><br><span class="line">返回：</span><br><span class="line">	ResultSet - 每一行都是一个列描述</span><br><span class="line">抛出：</span><br><span class="line">	SQLException - 如果发生数据库访问错误</span><br><span class="line">另请参见：</span><br><span class="line">	getSearchStringEscape()</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = DatabaseUtils.openConnection(); <span class="comment">// 得到数据库连接</span></span><br><span class="line">DatabaseMetaData databaseMetaData = conn.getMetaData();<span class="comment">// 获取数据库 MetaData</span></span><br><span class="line"><span class="comment">//获取数据表的表列描述,存放到 ResultSet</span></span><br><span class="line">ResultSet resultSet = databaseMetaData.getColumns(<span class="keyword">null</span>, <span class="string">&quot;%&quot;</span>, tableName, <span class="string">&quot;%&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">  String columnName = resultSet.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>); <span class="comment">//获取列名</span></span><br><span class="line">  String dataType = resultSet.getString(<span class="string">&quot;TYPE_NAME&quot;</span>); <span class="comment">//列的数据类型</span></span><br><span class="line">  <span class="keyword">int</span> columnSize = resultSet.getInt(<span class="string">&quot;COLUMN_SIZE&quot;</span>); <span class="comment">//列的大小</span></span><br><span class="line">  String remarks = resultSet.getString(<span class="string">&quot;REMARKS&quot;</span>); <span class="comment">//列的备注</span></span><br><span class="line">  colnames.add(getCamelStr(columnName));</span><br><span class="line">  colTypes.add(dataType);</span><br><span class="line">  colSizes.add(columnSize);</span><br><span class="line">  comments.add(remarks);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="生成类"><a href="#生成类" class="headerlink" title="生成类"></a>生成类</h1><p>生成POJO，包含字段和Setter和Getter</p>
<h2 id="生成字段"><a href="#生成字段" class="headerlink" title="生成字段"></a>生成字段</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析输出属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processAllAttrs</span><span class="params">(StringBuffer sb)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colnames.size(); i++) &#123;</span><br><span class="line">    String colName = colnames.get(i);</span><br><span class="line">    String colType = colTypes.get(i);</span><br><span class="line">    String comment = comments.get(i);</span><br><span class="line">    <span class="keyword">if</span> (comments != <span class="keyword">null</span> &amp;&amp; colName != <span class="keyword">null</span>) &#123;</span><br><span class="line">      sb.append(<span class="string">&quot;\t/**\n\t *  &quot;</span> + comment + <span class="string">&quot;\n\t **/\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    sb.append(<span class="string">&quot;\tprivate &quot;</span> + sqlType2JavaType(colType) + <span class="string">&quot; &quot;</span> + colName + <span class="string">&quot;;\r\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="生成Getter和Setter"><a href="#生成Getter和Setter" class="headerlink" title="生成Getter和Setter"></a>生成Getter和Setter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colnames.size(); i++) &#123;</span><br><span class="line">  String colName = colnames.get(i);</span><br><span class="line">  String colType = colTypes.get(i);</span><br><span class="line">  sb.append(<span class="string">&quot;\tpublic void set&quot;</span> + initcap(colName) + <span class="string">&quot;(&quot;</span> + sqlType2JavaType(colType) + <span class="string">&quot; &quot;</span> + colName</span><br><span class="line">            + <span class="string">&quot;)&#123;\r\n&quot;</span>);</span><br><span class="line">  sb.append(<span class="string">&quot;\t\tthis.&quot;</span> + colName + <span class="string">&quot;=&quot;</span> + colName + <span class="string">&quot;;\r\n&quot;</span>);</span><br><span class="line">  sb.append(<span class="string">&quot;\t&#125;\r\n\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  sb.append(<span class="string">&quot;\tpublic &quot;</span> + sqlType2JavaType(colType) + <span class="string">&quot; get&quot;</span> + initcap(colName) + <span class="string">&quot;()&#123;\r\n&quot;</span>);</span><br><span class="line">  sb.append(<span class="string">&quot;\t\treturn &quot;</span> + colName + <span class="string">&quot;;\r\n&quot;</span>);</span><br><span class="line">  sb.append(<span class="string">&quot;\t&#125;\r\n\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="组合成类文件"><a href="#组合成类文件" class="headerlink" title="组合成类文件"></a>组合成类文件</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">sb.append(<span class="string">&quot;package &quot;</span> + packagePath + <span class="string">&quot;;\r\n\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (needUtilPacket) &#123;</span><br><span class="line">	sb.append(<span class="string">&quot;import java.util.Date;\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (needSqlPacket) &#123;</span><br><span class="line">	sb.append(<span class="string">&quot;import java.sql.*;\r\n\r\n\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">sb.append(<span class="string">&quot;public class &quot;</span> + initcap(tableName) + <span class="string">&quot; &#123;\r\n\r\n&quot;</span>);</span><br><span class="line">processAllAttrs(sb);<span class="comment">//生成字段</span></span><br><span class="line">sb.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">generatGetterSetter(sb);<span class="comment">//生成getter和setter</span></span><br><span class="line">sb.append(<span class="string">&quot;&#125;\r\n&quot;</span>);</span><br><span class="line">System.out.println(sb.toString());</span><br><span class="line"><span class="keyword">return</span> sb.toString();</span><br></pre></td></tr></table></figure>


<hr>
<p>【参考文献】</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E6%A6%82%E8%AE%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E6%A6%82%E8%AE%BA/" class="post-title-link" itemprop="url">大数据技术概论</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-10 14:58:00" itemprop="dateCreated datePublished" datetime="2016-08-10T14:58:00+08:00">2016-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:36" itemprop="dateModified" datetime="2021-01-19T09:18:36+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="大数据技术概论"><a href="#大数据技术概论" class="headerlink" title="大数据技术概论"></a>大数据技术概论</h1><p>大数据存储管理：</p>
<ul>
<li>弹性扩展、容错技术</li>
<li>分层存储、索引（Hash、B树、倒排）</li>
<li>弱并发一致性管理</li>
</ul>
<p>单一计算模式不能涵盖所有<br>大数据计算需求<br>• MapReduce并行计算模式<br>• 分布内存抽象RDD<br>• 图计算模式<br>• 流式计算</p>
<p>硬件发展速度</p>
<p>存储墙: CPU性能每两年速度翻倍、硬盘性能每六年速度翻倍</p>
<p>数据访问速度： 磁盘容量增长远快于存储访问带宽</p>
<p>数据分发</p>
<p>并行计算框架发展</p>
<p><img src="../images/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%8F%91%E5%B1%95.png" alt="1557370798476"></p>
<p>1、Java <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47103781/">av47103781</a><br>2、Spring <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47103781/?spm_id_from=333.788.b_636f6d6d656e74.7">av47103781</a><br>3、Spring Mvc <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47176832/">av47176832</a><br>4、MyBatis <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47228830/">av47228830</a><br>5、Spring Boot <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47230137/">av47230137</a><br>6、Spring Cloud <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47228830/">av47228830</a><br>7、Dubbo <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47009143/">av47009143</a><br>8、MySQL <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47702905/">av47702905</a><br>9、Redis <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47423174/">av47423174</a><br>10、MongoDB <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47425352/">av47425352</a><br>11、Zookeeper <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47773419/">av47773419</a><br>12、Kafka <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47773990/">av47773990</a><br>13、Linux <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47701443/">av47701443</a><br>14、Docker <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47715282/">av47715282</a><br>15、Maven <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47382482/">av47382482</a><br>16、Git <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47701443/">av47701443</a><br>17、Jenkins <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47714706/">av47714706</a><br>18、IDEA <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av47382482/">av47382482</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/skill/Image-round-protrait/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/skill/Image-round-protrait/" class="post-title-link" itemprop="url">Java图片处理二--合成圆形头像(类似于QQ群聊)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-10 14:58:00" itemprop="dateCreated datePublished" datetime="2016-08-10T14:58:00+08:00">2016-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:35" itemprop="dateModified" datetime="2021-01-19T09:18:35+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p> <a href="/Java/Image-zip-square-portrait/">上一篇</a> 介绍了Java合成方形群头像的方法，方形群头像由于易于定位且不涉及形状填充和拼接，实现起来相对简单，本篇介绍的圆形头像方案则复杂很多。</p>
</blockquote>
<p>先看一下圆形头像的样子</p>
<p><img src="/images/java/image/round-portrait.png" alt="圆形头像样例"></p>
<p>从例子可以看出有如下几个特性:</p>
<ol>
<li>每张图片都是圆形的，涉及图片的剪切和图片填充到形状</li>
<li>当图片的个数多于1时，就要考虑图片的遮盖。</li>
<li>图片个数多余1时，需考虑图片的位置：2个是正对角线方向，3、4、5分别是正三角形、正四边形和正五边形</li>
</ol>
<p>接下来，从上面的三点介绍：</p>
<h1 id="图片的形状填充"><a href="#图片的形状填充" class="headerlink" title="图片的形状填充"></a>图片的形状填充</h1><p>在Java图形库(<code>java.awt</code>)中，存在图片形状填充的API，提供了<a target="_blank" rel="noopener" href="http://tool.oschina.net/apidocs/apidoc?api=jdk-zh">Area</a>工具，通过Area可以方便的实现图片的填充.  Area 类可以根据指定的 Shape 对象创建区域几何形状。如果 Shape 还不是封闭的，则显式地封闭几何形状。由 Shape 的几何形状指定的填充规则（奇偶或缠绕）用于确定得到的封闭区域。 </p>
<h2 id="Area填充"><a href="#Area填充" class="headerlink" title="Area填充"></a>Area填充</h2><p>步骤如下:</p>
<ul>
<li>创建Shape</li>
<li>创建Area</li>
<li>建立画板，设置与Area的交集</li>
<li>绘制待填充的图片</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> objectImageSize = <span class="number">260</span>;</span><br><span class="line"><span class="keyword">int</span> originImageSize = <span class="number">260</span>;</span><br><span class="line"><span class="comment">// 1. 创建Shape，这里定义了一个Polygon的Shape</span></span><br><span class="line"><span class="keyword">int</span> xpoints[] = &#123; <span class="number">20</span>, <span class="number">70</span>, <span class="number">130</span>, <span class="number">240</span> &#125;;</span><br><span class="line"><span class="keyword">int</span> ypoints[] = &#123; <span class="number">20</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">130</span> &#125;;</span><br><span class="line">Polygon polygon = <span class="keyword">new</span> Polygon(xpoints, ypoints, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// 2. 创建Area，并将Shape添加到Area</span></span><br><span class="line">Area tempArea = <span class="keyword">new</span> Area();</span><br><span class="line">tempArea.add(<span class="keyword">new</span> Area(polygon));</span><br><span class="line"><span class="comment">// 3. 建立画板</span></span><br><span class="line">BufferedImage tempBufferImage = <span class="keyword">new</span> BufferedImage(objectImageSize, objectImageSize, BufferedImage.TYPE_INT_RGB); <span class="comment">// 定义画板的大小和颜色</span></span><br><span class="line">Graphics2D g2d = tempBufferImage.createGraphics(); <span class="comment">// 创建</span></span><br><span class="line"></span><br><span class="line">g2d.setColor(Color.pink);</span><br><span class="line">g2d.fillRect(<span class="number">0</span>, <span class="number">0</span>, objectImageSize, objectImageSize); <span class="comment">//使用颜色填充，作为背景色</span></span><br><span class="line"><span class="comment">// 消除锯齿</span></span><br><span class="line">g2d.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_ON);</span><br><span class="line">g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line"><span class="comment">// 设置与Area的交集</span></span><br><span class="line">g2d.setClip(tempArea);</span><br><span class="line"><span class="comment">// 4. 绘制待填充的图片：设置了与Area的交集之后，绘制图片将只在交集内绘制</span></span><br><span class="line">BufferedImage bufferedImage = ImageUtil.resize2(<span class="string">&quot;lt.png&quot;</span>, originImageSize, originImageSize, <span class="keyword">true</span>);</span><br><span class="line">g2d.drawImage(bufferedImage, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line">g2d.dispose(); <span class="comment">// 关闭绘图区</span></span><br><span class="line"><span class="comment">// 5. 输出绘图区</span></span><br><span class="line">String format = <span class="string">&quot;JPG&quot;</span>;</span><br><span class="line">ImageIO.write(tempBufferImage, format, <span class="keyword">new</span> File(<span class="string">&quot;result.jpg&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>见上面的结果:<br><img src="/images/java/image/area-clip.jpg"></p>
<h2 id="Area剪切"><a href="#Area剪切" class="headerlink" title="Area剪切"></a>Area剪切</h2><p>Area可以实现区域的交集、并集、互减和组合区域并减去其交集， 本例使用Area互减实现圆形的互减。下面演示</p>
<p>实现月牙形状</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ellipse2D.Double circle1 = <span class="keyword">new</span> Ellipse2D.Double(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">tempArea.add(<span class="keyword">new</span> Area(circle1)); <span class="comment">// 定义Area 1</span></span><br><span class="line">Ellipse2D.Double circle2 = <span class="keyword">new</span> Ellipse2D.Double(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">tempArea.subtract(<span class="keyword">new</span> Area(circle2)); <span class="comment">// 减去Area 2</span></span><br></pre></td></tr></table></figure>
<p>看效果</p>
<p><img src="/images/java/image/area-crescent.jpg"></p>
<h1 id="圆形头像"><a href="#圆形头像" class="headerlink" title="圆形头像"></a>圆形头像</h1><p>接下来实现圆形头像，基本上就是图片的定位，亲，高中几何学的怎么样？</p>
<h2 id="图形Item坐标信息"><a href="#图形Item坐标信息" class="headerlink" title="图形Item坐标信息"></a>图形Item坐标信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class ItemConfig &#123;</span><br><span class="line">		&#x2F;**</span><br><span class="line">		 * item的大小, 圆的最小外切矩形</span><br><span class="line">		 *&#x2F;</span><br><span class="line">		int itemSize;</span><br><span class="line">		&#x2F;**</span><br><span class="line">		 * 留白区域大小</span><br><span class="line">		 *&#x2F;</span><br><span class="line">		int whiteSize;</span><br><span class="line">		&#x2F;**</span><br><span class="line">		 * item起始坐标</span><br><span class="line">		 *&#x2F;</span><br><span class="line">		int[][] itemLoaction;</span><br><span class="line">		&#x2F;**</span><br><span class="line">		 * 切口圆的坐标</span><br><span class="line">		 *&#x2F;</span><br><span class="line">		int[][] subtractLocation;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="计算坐标"><a href="#计算坐标" class="headerlink" title="计算坐标"></a>计算坐标</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">ItemConfig itemConfig = <span class="keyword">new</span> ItemConfig();</span><br><span class="line">iconCount = iconCount &gt; <span class="number">5</span> ? <span class="number">5</span> : iconCount;<span class="comment">// 图标最多五个</span></span><br><span class="line"><span class="keyword">int</span> borderWidth = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> whiteSize = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> r;</span><br><span class="line"><span class="keyword">switch</span> (iconCount) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">int</span> itemSize = imageSize - <span class="number">2</span> * borderWidth;</span><br><span class="line">      <span class="keyword">int</span> x = borderWidth, y = borderWidth;</span><br><span class="line">      itemConfig.itemSize = itemSize;</span><br><span class="line">      itemConfig.whiteSize = <span class="number">10</span>;</span><br><span class="line">      itemConfig.itemLoaction = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] = x;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>] = y;</span><br><span class="line">      itemConfig.subtractLocation = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      itemConfig.whiteSize = <span class="number">10</span>;</span><br><span class="line">      r = (<span class="keyword">int</span>) ((imageSize - <span class="number">2</span> * borderWidth + <span class="number">2</span> * itemConfig.whiteSize) / (<span class="number">2</span> + Math.sqrt(<span class="number">2</span>)));</span><br><span class="line">      itemConfig.itemSize = r * <span class="number">2</span>;</span><br><span class="line">      itemConfig.itemLoaction = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] = imageSize - <span class="number">2</span> * r - itemConfig.whiteSize - borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>] = imageSize - <span class="number">2</span> * r - itemConfig.whiteSize - borderWidth;</span><br><span class="line"></span><br><span class="line">      itemConfig.subtractLocation = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">0</span>] = (<span class="keyword">int</span>) (itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] - <span class="number">1.5</span> * itemConfig.whiteSize);</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">1</span>] = (<span class="keyword">int</span>) (itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] - <span class="number">1.5</span> * itemConfig.whiteSize);</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">1</span>] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      itemConfig.whiteSize = whiteSize;</span><br><span class="line">      r = (<span class="keyword">int</span>) ((imageSize - <span class="number">2</span> * borderWidth) / (<span class="number">2</span> + Math.sqrt(<span class="number">3</span>))) + itemConfig.whiteSize / <span class="number">2</span>;</span><br><span class="line">      itemConfig.itemSize = <span class="number">2</span> * r;</span><br><span class="line"></span><br><span class="line">      itemConfig.itemLoaction = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] = (imageSize - <span class="number">2</span> * borderWidth) / <span class="number">2</span> + borderWidth - r;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>] = imageSize - borderWidth - <span class="number">2</span> * r;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>] = imageSize - borderWidth - <span class="number">2</span> * r;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>] = imageSize - borderWidth - <span class="number">2</span> * r;</span><br><span class="line"></span><br><span class="line">      itemConfig.subtractLocation = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">1</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">1</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">2</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">2</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      whiteSize = <span class="number">10</span>;</span><br><span class="line">      itemConfig.whiteSize = whiteSize;</span><br><span class="line">      r = (<span class="keyword">int</span>) ((imageSize - <span class="number">2.0</span> * borderWidth) / <span class="number">4</span> + whiteSize);</span><br><span class="line">      itemConfig.itemSize = <span class="number">2</span> * r;</span><br><span class="line"></span><br><span class="line">      itemConfig.itemLoaction = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>] = imageSize - borderWidth - whiteSize - <span class="number">2</span> * r;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>] = imageSize - borderWidth - whiteSize - <span class="number">2</span> * r;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">      itemConfig.subtractLocation = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">4</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">1</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">2</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">2</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">3</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">3</span>][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">      whiteSize = <span class="number">10</span>;</span><br><span class="line">      itemConfig.whiteSize = whiteSize;</span><br><span class="line">      r = (<span class="keyword">int</span>) ((imageSize - <span class="number">2.0</span> * borderWidth)</span><br><span class="line">      / (<span class="number">2</span> * (Math.cos(Math.toRadians(<span class="number">18</span>)) + Math.cos(Math.toRadians(<span class="number">54</span>))) + <span class="number">2</span>)) + whiteSize;</span><br><span class="line">      itemConfig.itemSize = <span class="number">2</span> * r;</span><br><span class="line"></span><br><span class="line">      itemConfig.itemLoaction = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] = (imageSize - <span class="number">2</span> * borderWidth) / <span class="number">2</span> - r + borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] = borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>] = (<span class="keyword">int</span>) (<span class="number">2</span> * r * Math.cos(Math.toRadians(<span class="number">54</span>))) + borderWidth;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>] = (<span class="keyword">int</span>) (borderWidth + <span class="number">2</span> * r * Math.sin(Math.toRadians(<span class="number">18</span>)));</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>] = imageSize - borderWidth - <span class="number">2</span> * r;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">0</span>] = (<span class="keyword">int</span>) (imageSize - borderWidth - <span class="number">2</span> * r</span><br><span class="line">      - <span class="number">2</span> * r * Math.sin(Math.toRadians(<span class="number">18</span>)));</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">4</span>][<span class="number">0</span>] = imageSize - borderWidth - <span class="number">2</span> * r;</span><br><span class="line">      itemConfig.itemLoaction[<span class="number">4</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">      itemConfig.subtractLocation = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>][<span class="number">2</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">0</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">1</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">1</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">2</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">2</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">3</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">4</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">3</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">4</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">3</span>][<span class="number">1</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">4</span>][<span class="number">0</span>] = itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">0</span>] - itemConfig.itemLoaction[<span class="number">4</span>][<span class="number">0</span>];</span><br><span class="line">      itemConfig.subtractLocation[<span class="number">4</span>][<span class="number">1</span>] = itemConfig.itemLoaction[<span class="number">0</span>][<span class="number">1</span>] - itemConfig.itemLoaction[<span class="number">4</span>][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="绘制圆形头像"><a href="#绘制圆形头像" class="headerlink" title="绘制圆形头像"></a>绘制圆形头像</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ItemConfig itemConfig = calcLocation(<span class="number">480</span>, <span class="number">5</span>);</span><br><span class="line">BufferedImage imageNew = <span class="keyword">new</span> BufferedImage(<span class="number">480</span>, <span class="number">480</span>, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">Graphics2D graphics2DNew = imageNew.createGraphics();</span><br><span class="line">graphics2DNew.setColor(Color.white);</span><br><span class="line">graphics2DNew.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">480</span>, <span class="number">480</span>);</span><br><span class="line">graphics2DNew.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line">graphics2DNew.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING, RenderingHints.VALUE_TEXT_ANTIALIAS_ON);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; itemConfig.itemLoaction.length; i++) &#123;</span><br><span class="line">  String fileName = urls.get(i);</span><br><span class="line">  Area tempArea = <span class="keyword">new</span> Area();</span><br><span class="line">  Ellipse2D.Double circle0 = <span class="keyword">new</span> Ellipse2D.Double(<span class="number">10</span>, <span class="number">10</span>, itemConfig.itemSize - <span class="number">2</span> * itemConfig.whiteSize,</span><br><span class="line">  itemConfig.itemSize - <span class="number">2</span> * itemConfig.whiteSize);</span><br><span class="line">  tempArea.add(<span class="keyword">new</span> Area(circle0));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (itemConfig.subtractLocation != <span class="keyword">null</span> &amp;&amp; itemConfig.subtractLocation[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">    Ellipse2D.Double circle1 = <span class="keyword">new</span> Ellipse2D.Double(itemConfig.subtractLocation[i][<span class="number">0</span>],</span><br><span class="line">    itemConfig.subtractLocation[i][<span class="number">1</span>], itemConfig.itemSize, itemConfig.itemSize);</span><br><span class="line">    tempArea.subtract(<span class="keyword">new</span> Area(circle1));</span><br><span class="line">  &#125;</span><br><span class="line">  graphics2DNew.drawImage(fillImageToModel(fileName, itemConfig.itemSize, tempArea),</span><br><span class="line">  itemConfig.itemLoaction[i][<span class="number">0</span>], itemConfig.itemLoaction[i][<span class="number">1</span>], <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line">graphics2DNew.dispose();</span><br><span class="line"><span class="keyword">return</span> imageNew;</span><br></pre></td></tr></table></figure>


<p>效果上面已经有了…</p>
<hr>
<p>参考文献:</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/ElasticSearch/ElasticSearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/ElasticSearch/ElasticSearch/" class="post-title-link" itemprop="url">ElasticSearch开发基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-10 14:58:00" itemprop="dateCreated datePublished" datetime="2016-08-10T14:58:00+08:00">2016-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:36" itemprop="dateModified" datetime="2021-01-19T09:18:36+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><p>Es 基于lucene</p>
<p>Elasticsearch 是一个分布式、可扩展、实时的搜索与数据分析引擎。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/oldratlee/useful-scripts">ES分析脚本</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Impala/Impala-why-faster-than-hive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Impala/Impala-why-faster-than-hive/" class="post-title-link" itemprop="url">Impala: why faster than hive</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-10 14:58:00" itemprop="dateCreated datePublished" datetime="2016-08-10T14:58:00+08:00">2016-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:36" itemprop="dateModified" datetime="2021-01-19T09:18:36+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h1 id="Impala"><a href="#Impala" class="headerlink" title="Impala"></a>Impala</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/16755599/how-does-impala-provide-faster-query-response-compared-to-hive">How does impala provide faster query response compared to hive</a></p>
</blockquote>
<p>Impala = SQL on HDFS<br>Hive = SQL on Hadoop</p>
<p>impala darmon running on datanode<br>cache some of the data that is in HDFS</p>
<h2 id="why-fast"><a href="#why-fast" class="headerlink" title="why fast"></a>why fast</h2><blockquote>
<p>why Impala is faster than Hive in Query processing? Below are the some key points.</p>
</blockquote>
<ul>
<li>While processing SQL-like queries, Impala does not write intermediate results on disk(like in Hive MapReduce); instead full SQL processing is done in memory, which makes it faster.</li>
<li>With Impala, the query starts its execution instantly compared to MapReduce, which may take significant time to start processing larger SQL queries and this adds more time in processing.</li>
<li>Impala Query Planner uses smart algorithms to execute queries in multiple stages in parallel nodes to provide results faster, avoiding sorting and shuffle steps, which may be unnecessary in most of the cases.</li>
<li>Impala has information about each data block in HDFS, so when processing the query, it takes advantage of this knowledge to distribute queries more evenly in all DataNodes.</li>
<li>There exists Impala daemon, which runs on each DataNode. These are responsible for processing queries.When query submitted, impalad(Impala daemon) reads and writes to data file and parallelizes the query by distributing the work to all other Impala nodes in the Impala cluster.</li>
<li>Another key reason for fast performance is that Impala first generates assembly-level code for each query. The assembly code executes faster than any other code framework because while Impala queries are running natively in memory, having a framework will add additional delay in the execution due to the framework overhead.</li>
</ul>
<ol>
<li>在处理类似sql的查询时，Impala不会在磁盘上写入中间结果(如Hive MapReduce);相反，SQL处理完全是在内存中完成的，这使它更快。</li>
<li>不使用map/reduce, 将数据fork到jvm和流量穿透是非常昂贵的。Impala将查询任务分割成子任务，在数据所在的节点上，各个节点独立并行运行，最后再单个节点上汇总结果。</li>
<li>与MapReduce相比，Impala查询立即开始执行，MapReduce可能会花费大量时间来开始处理较大的SQL查询，这会增加处理时间。</li>
<li>Impala Query Planner使用智能算法在并行节点中的多个stage执行查询，以更快地提供结果，避免sortinh和shuffle步骤，这在大多数情况下可能是不必要的。</li>
<li>Impala拥有关于HDFS每个数据块的信息，因此在处理查询时，它利用这些知识在所有数据节点中更均匀地分布查询。</li>
<li>存在在每个DataNode上运行的Impala守护进程。它们负责处理查询。当提交查询时，impalad(Impala守护进程)对数据文件进行读写操作，并通过将工作分配给Impala集群中的所有其他Impala节点来并行化查询。</li>
<li>快速性能的另一个关键原因是Impala首先为每个查询生成汇编级别的代码。汇编代码的执行速度比任何其他代码框架都快，因为Impala查询在本机的内存中运行时，拥有一个框架会由于框架开销而增加额外的执行延迟。</li>
<li>它使用hdfs存储，对于大文件来说速度很快。它尽可能多地缓存查询、结果和数据。</li>
<li>它支持新的文件格式，如parquet，即列式存储格式。使用这种格式，数据扫描量更少</li>
</ol>
<p>Impala在内存中的处理所有查询，因此节点上的内存限制肯定是一个因素。必须有足够的内存来支持生成的数据集，在复杂的连接操作期间，数据集可能会成倍增长。如果查询开始处理数据，结果数据集无法装入可用内存，则查询将失败。</p>
<h3 id="disadvantage"><a href="#disadvantage" class="headerlink" title="disadvantage"></a>disadvantage</h3><ol>
<li>不支持UDF和自定义序列化</li>
<li>impala查询是HiveSQL的子集</li>
<li>hive支持存储和查询，而impala只能查询</li>
</ol>
<h2 id="Impala-doesn’t-provide-fault-tolerance-compared-to-Hive"><a href="#Impala-doesn’t-provide-fault-tolerance-compared-to-Hive" class="headerlink" title="Impala doesn’t provide fault-tolerance compared to Hive"></a>Impala doesn’t provide fault-tolerance compared to Hive</h2><p>so if there is a problem during your query then it’s gone. </p>
<blockquote>
<p>Definitely for ETL type of jobs where failure of one job would be costly I would recommend Hive, but Impala can be awesome for small ad-hoc queries, for example for data scientists or business analysts who just want to take a look and analyze some data without building robust jobs. Also from my personal experience, Impala is still not very mature, and I’ve seen some crashes sometimes when the amount of data is larger than available memory.</p>
</blockquote>
<p>对于ETL类型的工作，如果一个工作的失败代价很高，我会推荐Hive，但是Impala对于小的特别查询来说可能是很棒的，例如对于那些只想查看和分析一些数据而不想构建健壮工作的数据科学家或业务分析师来说。从我个人的经验来看，Impala还不太成熟，有时当数据量超过可用内存时，我会看到一些崩溃。</p>
<blockquote>
<p>This means if your join, sort, or group by didn’t fit in memory, Impala would just kill the query. No warning. Just dead. Hive would never do that because it’s underlying processing architecture has no problem doing that.</p>
</blockquote>
<p>这就意味着，内存不能承载join sort或group运算，Impala会无告警的立即kill掉查询，直接失败。而hive离线处理架构可以轻松处理，不会死掉</p>
<h2 id="MPP"><a href="#MPP" class="headerlink" title="MPP"></a>MPP</h2><blockquote>
<p>Impala uses MPP(massively parallel processing) unlike Hive which uses MapReduce under the hood, which involves some initial overheads (as Charles sir has specified). Massively parallel processing is a type of computing that uses many separate CPUs running in parallel to execute a single program where each CPU has it’s own dedicated memory. The very fact that Impala, being MPP based, doesn’t involve the overheads of a MapReduce jobs viz. job setup and creation, slot assignment, split creation, map generation etc., makes it blazingly fast.</p>
</blockquote>
<p>Impala提供了更快的响应，因为它使用了MPP(大规模并行处理)，而Hive在底层使用了MapReduce，这涉及到一些初始开销(正如Charles sir所指定的)。大规模并行处理是一种计算类型，它使用许多单独的并行运行的CPU来执行单个程序，其中每个CPU都有自己的专用内存。Impala是基于MPP的，它不涉及MapReduce作业的开销，即作业设置和创建、插槽分配、分割创建、地图生成等，这使得它的运行速度非常快。</p>
<blockquote>
<p>But that doesn’t mean that Impala is the solution to all your problems. Being highly memory intensive (MPP), it is not a good fit for tasks that require heavy data operations like joins etc., as you just can’t fit everything into the memory. This is where Hive is a better fit.</p>
</blockquote>
<p>MPP 作为高度内存密集型的运算，因为无法将所有的数据放入内存，并不适合需要大数据量的操作(如join)；反而Hive更适合</p>
<p>实时的对部分数据即时查询适合Impala，对大数据的批处理请求，适合Hive</p>
<h2 id="Impala-not-always-faster-than-hive"><a href="#Impala-not-always-faster-than-hive" class="headerlink" title="Impala not always faster than hive"></a>Impala not always faster than hive</h2><blockquote>
<p>In my current job we used to make all the querys with Impala, the biggest query (like 800 million rows after 8 joins) was taking from 2 to 20 mins (depending if the tables where already on memory or not) I migrate that Query to Hive, partitioned the tables and create buckets on them, now it takes 3–4 mins, It may be a few more seconds than the best 2 mins with Impala but it’s much more fast if we consider that most of the time Impala takes 12–18 mins.</p>
</blockquote>
<p>在我目前的工作中，使用Impala进行所有的查询，最大的查询(比如8个连接后的8亿行)需要2到20分钟(取决于表是否已经在内存中);我将该查询迁移到Hive，对表进行分区并在其上创建桶，现在需要3到4分钟，这可能比Impala最好的2分钟多几秒钟，但如果我们考虑Impala大部分时间需要12到18分钟，速度会快得多。 </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Hadoop/HDFS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Hadoop/HDFS/" class="post-title-link" itemprop="url">HDFS基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-08-10 14:58:00" itemprop="dateCreated datePublished" datetime="2016-08-10T14:58:00+08:00">2016-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-19 09:18:36" itemprop="dateModified" datetime="2021-01-19T09:18:36+08:00">2021-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>NameNode 保存这个文件的数据块信息</li>
<li>DataNode 存储实际的文件</li>
<li>当MR启动的时候，首先获取所要处理的文件的块信息和节点信息，然后在这些节点上同时启动任务，在数据所在节点上同时处理</li>
</ul>
<p>MapReduce是底层编程语言，您需要专业知识才能在此级别工作。工程师在Map Reduce上开发了一个名为Hive的层，以便用户可以使用SQL来处理HDFS中存储的数据。Hive将这些SQL查询转换为一系列Map Reduce，然后调度执行。因此，Hive极大地简化了数据处理任务。但是Hive使用底层Map Reduce体系结构，这是用于处理数据的另一层</p>
<p>Impala 一旦部署在Hadoop集群中，它将在每个数据节点上运行自己的进程，并完全跳过MapReduce阶段。一旦收到一个SQL，Impala master节点调度数据所在的节点上直接执行任务。因为它跳过MapReduce转换阶段并直接在节点上执行，所以它可以完成每秒钟的SQL查询</p>
<p>当您在Hive中启动查询时，在背景地图中，Reduce会出现在启动查询需要花费大量时间的画面中，就像您在Impala中启动查询一样，它使用自己的体系结构，即MPP(大规模并行处理)而不是Map Reduce来从HDFS获取结果。它在内存中执行查询，总是比磁盘快。</p>
<p>It’s an HDFS quirk. A file that’s currently being written to will appear to have a size of 0 but once it’s closed it will show its true size</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">aaronzhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">223</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">108</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aaronzhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
