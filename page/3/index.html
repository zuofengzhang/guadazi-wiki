<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Guadazi">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Guadazi">
<meta property="og:locale">
<meta property="article:author" content="aaronzhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>Guadazi</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guadazi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/Flink-connectors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/Flink-connectors/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flink-Connector之插件机制"><a href="#Flink-Connector之插件机制" class="headerlink" title="Flink Connector之插件机制"></a>Flink Connector之插件机制</h1><blockquote>
<p> Connector是Flink与外部存储连接的桥梁，Flink在对接外部存储和数据格式上</p>
<p> 对于一个外部存储系统的库表来说，需要处理三方面的定义：</p>
<ol>
<li><p>connector: 定义了流、批、读、写的实现</p>
</li>
<li><p>Format: 定义了数据的解析</p>
</li>
<li><p>Schema: 定义了表的字段信息</p>
<p>Flink使用Java SPI机制实现插件，方便扩展和管理。Flink更专注于计算，</p>
<p>而各种不同的Connector专注于实现批量读写、流式读写、数据一致性协议、分区、offset和时间戳生成等逻辑</p>
<p>本文主要介绍Flink Connector插件机制</p>
</li>
</ol>
</blockquote>
<h2 id="Java-SPI"><a href="#Java-SPI" class="headerlink" title="Java SPI"></a>Java SPI</h2><p>(Service provider interface，服务提供者接口)，是Java提供的一套实现扩展的API。</p>
<p>Java SPI是符合<a target="_blank" rel="noopener" href="https://www.kancloud.cn/digest/java-designer-patten/163177">接口隔离原则</a>的设计，实现调用者和实现者的解耦，不同的实现方实现了可插拔：</p>
<ol>
<li>接口定义了交互的”协议”</li>
<li>根据不同的实现方案，定义该接口的不同实现类</li>
<li>调用者根据实际的使用需要，启用、扩展或者替换框架的实现策略</li>
</ol>
<p>常见的SPI的例子：</p>
<ul>
<li>数据库驱动加载: JDBC加载不同类型的数据库的驱动</li>
<li>日志门面实现类的加载: Slf4J加载不同提供商的日志实现类</li>
</ul>
<p>使用介绍：</p>
<ol>
<li>服务提供者提供接口的实现类，实现类必须含义不带参数的改造方法</li>
<li>在Jar包的<code>META-INF/services</code>目录下创建一个以“接口全限定名”为命名的文件，内容为实现类的全限定名；</li>
<li>将接口的实现类所在的Jar包放在<code>classpath</code>中</li>
<li><code>java.util.ServiceLoder</code>通过扫描<code>META-INF/services</code>目录下的配置文件找到实现类，加载类到JVM</li>
</ol>
<p><code>ServiceLoader</code></p>
<ol>
<li> <code>ServiceLoader</code>可以跨越jar包获取META-INF下的配置文件</li>
<li>通过反射方法Class.forName()加载类对象，并用instance()方法将类实例化</li>
<li>把实例化后的类缓存到providers对象中，(<code>LinkedHashMap&lt;String,S&gt;</code>类型）<br> 然后返回实例对象</li>
</ol>
<p>性能损失</p>
<ol>
<li>延迟加载，需要遍历全部和加载全部实现类</li>
<li>非线程安全</li>
</ol>
<h2 id="TableFactory的定义"><a href="#TableFactory的定义" class="headerlink" title="TableFactory的定义"></a>TableFactory的定义</h2><p>flink-table-common模块中定义了TableFactory的接口、调用者和工具类, </p>
<h3 id="TableFactory"><a href="#TableFactory" class="headerlink" title="TableFactory"></a>TableFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.flink.table.factories;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">用于从基于字符串的属性中创建与表相关的不同实例的一个工厂。 该工厂使用Java的服务提供商接口（SPI）做服务发现，使用一组描述所需配置的规范化属性来调用工厂。 工厂允许匹配给定的属性集。</span></span><br><span class="line"><span class="comment">将实现此接口的类添加到要找到的当前类路径中的JAR文件的&quot;META_INF/services/org.apache.flink.table.factories.TableFactory&quot;文件中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TableFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	指定为此工厂实现的Context。 该框架保证仅在满足指定的属性和值集的情况下才与此工厂匹配。</span></span><br><span class="line"><span class="comment">典型的属性可能是：</span></span><br><span class="line"><span class="comment">-connector.type</span></span><br><span class="line"><span class="comment">-format.type</span></span><br><span class="line"><span class="comment">指定的属性版本允许框架在字符串格式更改的情况下提供向后兼容的属性：</span></span><br><span class="line"><span class="comment">-connector.property</span></span><br><span class="line"><span class="comment">-version-format.property-version</span></span><br><span class="line"><span class="comment">空上下文意味着工厂匹配所有请求。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">Map&lt;String, String&gt; <span class="title">requiredContext</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	返回该工厂可以处理的属性键列表。 此方法将用于验证。 如果传递了该工厂无法处理的属性，则将引发异常。 该列表不得包含上下文指定的键。</span></span><br><span class="line"><span class="comment">示例属性可能是：</span></span><br><span class="line"><span class="comment">   - schema.#.type</span></span><br><span class="line"><span class="comment">	    - schema.#.name</span></span><br><span class="line"><span class="comment">	    - connector.topic</span></span><br><span class="line"><span class="comment">	    - format.line-delimiter</span></span><br><span class="line"><span class="comment">	    - format.ignore-parse-errors</span></span><br><span class="line"><span class="comment">	    - format.fields.#.type</span></span><br><span class="line"><span class="comment">	    - format.fields.#.name</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">注意：使用“＃”表示值的数组，其中“＃”表示一个或多个数字。 诸如“ format.property-version”之类的属性版本不得成为受支持属性的一部分。</span></span><br><span class="line"><span class="comment">在某些情况下，将通配符声明为“ *”可能会很有用。 通配符只能在属性键的末尾声明。</span></span><br><span class="line"><span class="comment">例如，如果应支持任意格式：</span></span><br><span class="line"><span class="comment">- format.*</span></span><br><span class="line"><span class="comment">注意：应谨慎使用通配符，因为它们会吞下不受支持的属性，从而可能导致不良行为</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">List&lt;String&gt; <span class="title">supportedProperties</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以flink-hbase为例, 在<code>META-INF/services/</code>中定义了文件<code>org.apache.flink.table.factories.TableFactory</code></p>
<p>文件的内容为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.flink.addons.hbase.HBaseTableFactory</span><br></pre></td></tr></table></figure>
<p>这个类就是TableFactory的实现</p>
<h2 id="TableFactory查找"><a href="#TableFactory查找" class="headerlink" title="TableFactory查找"></a>TableFactory查找</h2><p>Flink 在 Connector的实现上，也是采用SPI机制</p>
<p><img src="https://gitee.com/averyzhang/pic-go/raw/master/img/20210505014933.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[SPI查找实现类]--&gt;B[是否TableFactory的子类]</span><br><span class="line">B--&gt;C[是否满足必要属性]</span><br><span class="line">C--&gt;D[是否满足属性匹配]</span><br><span class="line">D--&gt;E[创建TableFactory实现类]</span><br></pre></td></tr></table></figure>
<p>入口方法: <code>org.apache.flink.table.factories.TableFactoryService#find(java.lang.Class&lt;T&gt;, java.util.Map&lt;java.lang.String,java.lang.String&gt;)</code></p>
<p>调用样例: </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TableFactoryService</span>.find(classOf[<span class="type">TableFactory</span>[_]],sinkProperties)</span><br></pre></td></tr></table></figure>
<p>最终调用查找方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends TableFactory&gt; <span class="function">T <span class="title">findSingleInternal</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			Class&lt;T&gt; factoryClass,</span></span></span><br><span class="line"><span class="function"><span class="params">			Map&lt;String, String&gt; properties,</span></span></span><br><span class="line"><span class="function"><span class="params">			Optional&lt;ClassLoader&gt; classLoader)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 查找Factory</span></span><br><span class="line">		List&lt;TableFactory&gt; tableFactories = discoverFactories(classLoader);</span><br><span class="line"><span class="comment">// 过滤Factory    </span></span><br><span class="line">		List&lt;T&gt; filtered = filter(tableFactories, factoryClass, properties);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (filtered.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">// 查找到超过1个，抛出异常      </span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> AmbiguousTableFactoryException(</span><br><span class="line">				filtered,</span><br><span class="line">				factoryClass,</span><br><span class="line">				tableFactories,</span><br><span class="line">				properties);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> filtered.get(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>查找实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;TableFactory&gt; <span class="title">discoverFactories</span><span class="params">(Optional&lt;ClassLoader&gt; classLoader)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;TableFactory&gt; result = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">			ClassLoader cl = classLoader.orElse(Thread.currentThread().getContextClassLoader());</span><br><span class="line">			ServiceLoader</span><br><span class="line">				.load(TableFactory.class, cl)</span><br><span class="line">				.iterator()</span><br><span class="line">				.forEachRemaining(result::add);</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (ServiceConfigurationError e) &#123;</span><br><span class="line">			LOG.error(<span class="string">&quot;Could not load service provider for table factories.&quot;</span>, e);</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> TableException(<span class="string">&quot;Could not load service provider for table factories.&quot;</span>, e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>过滤</p>
<p>有三层过滤: </p>
<ul>
<li>filterByFactoryClass: 判断是否为TableFactory的实现类</li>
<li>filterByContext: 判断必要属性是否匹配: 来源于TableFactory.requiredContext</li>
<li>filterBySupportedProperties: 判断属性是否支持：来源于TableFactory.supportedProperties</li>
</ul>
<h2 id="TableFactory的分类"><a href="#TableFactory的分类" class="headerlink" title="TableFactory的分类"></a>TableFactory的分类</h2><p><img src="https://gitee.com/averyzhang/pic-go/raw/master/img/20210505012958.png" alt="OPPO&#39;s Real-time Data Warehouse and Development of Flink SQL | Medium"></p>
<p>对于一个外部存储系统的库表来说，需要处理三方面的定义：</p>
<ol>
<li>connector: 定义了流、批、读、写的实现</li>
<li>Format: 定义了数据的解析</li>
<li>Schema: 定义了表的字段信息</li>
</ol>
<p>Schema信息可以在注册库表的时候直接增加，connector、format信息通过TableFactory实现可插拔</p>
<p><img src="https://gitee.com/averyzhang/pic-go/raw/master/img/20210505014815.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">      TableFactory &lt;|-- StreamTableSourceFactory~T~</span><br><span class="line">      TableFactory &lt;|-- StreamTableSinkFactory~T~</span><br><span class="line">      TableFactory &lt;|-- BatchTableSourceFactory~T~</span><br><span class="line">      TableFactory &lt;|-- BatchTableSinkFactory~T~</span><br><span class="line">      TableFactory &lt;|-- TableFormatFactory~T~</span><br><span class="line">	  StreamTableSourceFactory &lt;|-- HBaseTableFactory</span><br><span class="line">	  StreamTableSinkFactory &lt;|-- HBaseTableFactory</span><br><span class="line">      class TableFactory&#123;</span><br><span class="line">         +requiredConext() Map~StringString~</span><br><span class="line">         +supportedProperties() List~String~</span><br><span class="line">      &#125;</span><br><span class="line">      class StreamTableSourceFactory&#123;</span><br><span class="line">      	 +createStreamTableSink(Map&lt;String, String&gt;) StreamTableSink~T~</span><br><span class="line">      	 +createTableSink(Map&lt;String, String&gt;) TableSink~T~</span><br><span class="line">      &#125;</span><br><span class="line">	  class StreamTableSinkFactory&#123;</span><br><span class="line">		  +createStreamTableSink(Map&lt;String, String&gt;) StreamTableSink~T~</span><br><span class="line">		  +createTableSink(Map&lt;String, String&gt;) TableSink~T~</span><br><span class="line"></span><br><span class="line">	  &#125;</span><br><span class="line">      class BatchTableSourceFactory&#123;</span><br><span class="line">      	+createBatchTableSource(Map&lt;String, String&gt;) BatchTableSource~T~</span><br><span class="line">      	+createTableSource(Map&lt;String, String&gt;) TableSource~T~</span><br><span class="line">      &#125;</span><br><span class="line">      class BatchTableSinkFactory&#123;</span><br><span class="line">      	+createBatchTableSink(Map&lt;String, String&gt;) BatchTableSink~T~</span><br><span class="line">      	+createTableSink(Map&lt;String, String&gt;) TableSink~T~</span><br><span class="line">      &#125;</span><br><span class="line">	  class TableFormatFactory&#123;</span><br><span class="line">		  +supportsSchemaDerivation()</span><br><span class="line">		  +supportedProperties() List~String~</span><br><span class="line">	  &#125;</span><br><span class="line">	  class HBaseTableFactory&#123;</span><br><span class="line">	  &#125;</span><br></pre></td></tr></table></figure>
<p>TableFactory可以分为:</p>
<ul>
<li>StreamTableSourceFactory</li>
<li>StreamTableSinkFactory</li>
<li>BatchTableSourceFactory</li>
<li>BatchTableSinkFactory</li>
<li>TableFormatFactory</li>
</ul>
<h2 id="常见的Connector样例"><a href="#常见的Connector样例" class="headerlink" title="常见的Connector样例"></a>常见的Connector样例</h2><p>援引一张1.10的优化设计图</p>
<p><img src="https://gitee.com/averyzhang/pic-go/raw/master/img/20210429220246.png" alt="img"></p>
<h3 id="kafka-DDL定义"><a href="#kafka-DDL定义" class="headerlink" title="kafka-DDL定义"></a>kafka-DDL定义</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orders_kafka (</span><br><span class="line">  ...</span><br><span class="line">  etime <span class="type">timestamp</span>(<span class="number">3</span>),</span><br><span class="line">  watermark <span class="keyword">for</span> etime <span class="keyword">as</span> etime <span class="operator">-</span> <span class="type">interval</span> <span class="string">&#x27;5&#x27;</span> <span class="keyword">second</span> </span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">  <span class="string">&#x27;connector.type&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;kafka&#x27;</span>, <span class="comment">-- connector信息</span></span><br><span class="line">  <span class="string">&#x27;connector.version&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;universal&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;connector.topic&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;kafka-2-mysql-window&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;connector.properties.zookeeper.connect&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;localhost:2181&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;connector.properties.bootstrap.servers&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;localhost:9092&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;connector.properties.group.id&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;order-streaming-test&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;connector.startup-mode&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;earliest-offset&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;update-mode&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;append&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;format.type&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;json&#x27;</span>, <span class="comment">-- format信息</span></span><br><span class="line">  <span class="string">&#x27;format.derive-schema&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="MySQL-DDL定义"><a href="#MySQL-DDL定义" class="headerlink" title="MySQL-DDL定义"></a>MySQL-DDL定义</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> agg_result (</span><br><span class="line">  ...</span><br><span class="line">  time_id STRING</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">   <span class="string">&#x27;connector.type&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.driver&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;com.mysql.cj.jdbc.Driver&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/fdata&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.table&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;t_agg_result&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;connector.password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;---&#x27;</span></span><br><span class="line">)   </span><br></pre></td></tr></table></figure>




<h2 id="Connector设计要点"><a href="#Connector设计要点" class="headerlink" title="Connector设计要点"></a>Connector设计要点</h2><ol>
<li>自定义Factory，根据需要实现StreamTableSourceFactory和StreamTableSinkFactory</li>
<li>根据需要继承ConnectorDescriptorValidator，定义自己的connector参数（with 后面跟的那些）</li>
<li>Factory中的requiredContext、supportedProperties都比较重要，框架中对Factory的过滤和检查需要他们</li>
<li>需要自定义个TableSink，根据你需要连接的中间件选择是AppendStreamTableSink、Upsert、Retract重写consumeDataStream方法</li>
<li>自定义一个SinkFunction，在invoke方法中实现将数据写入到外部中间件。</li>
</ol>
<p>参考文献</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/117654469">Flink深入浅出：JDBC Connector源码分析</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/Flink/Flink-Clients/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/Flink/Flink-Clients/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Flink-Clients"><a href="#Flink-Clients" class="headerlink" title="Flink Clients"></a>Flink Clients</h1><p><img src="https://gitee.com/averyzhang/pic-go/raw/master/img/20210601214328.jpg" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/bigdata/clickhouse/%E5%90%91%E9%87%8F%E5%8C%96%E4%B8%8E%E7%81%AB%E5%B1%B1%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bigdata/clickhouse/%E5%90%91%E9%87%8F%E5%8C%96%E4%B8%8E%E7%81%AB%E5%B1%B1%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="向量化执行引擎"><a href="#向量化执行引擎" class="headerlink" title="向量化执行引擎"></a>向量化执行引擎</h1><p><a target="_blank" rel="noopener" href="http://mysql.taobao.org/monthly/2017/01/06/">向量化执行引擎</a></p>
<h2 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h2><ol>
<li>传统的一次一个tuple的pipeline模式，CPU的大部分处理时在遍历操作数，而不是在处理数据，CPU利用率低，还导致缓存性能低和频繁跳转。</li>
<li>寻址性能是存储的瓶颈，顺序读写性能比随机读取效率更高，但大部分查询都是随机读取，此外磁盘读写速度远远落后于CPU数据执行速度。列存储可以最大化利用磁盘读写能力</li>
</ol>
<p>列存储的优势:</p>
<ul>
<li>压缩能力提升: 列类型统一，存放一起，易于压缩</li>
<li>减少IO读写总量：仅仅需要读取需要的列</li>
<li>减少查询过程中的节点函数的调用次数：计算过程中，列存以数据块的形式返回上层节点，减少函数调用次数</li>
<li>向量化执行：计算的过程中，相同的列执行相同的操作，可以使用SIMD提升计算效率；不支持SIMD，也可以通过循环提升效率</li>
<li>延迟物化：减少查询计划树之间传递数据总量</li>
</ul>
<h2 id="向量化引擎的适用条件"><a href="#向量化引擎的适用条件" class="headerlink" title="向量化引擎的适用条件"></a>向量化引擎的适用条件</h2><ul>
<li>列存储</li>
<li>OLAP</li>
</ul>
<p>OLAP适合列存储<br>OLTP点查询适合行存储</p>
<h2 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h2><ul>
<li>火山模型: 修改成一次返回一组列</li>
<li>层次型执行模式: 将优化好的执行计划数转换为编译执行：一次调用下来后，每一层都完成后才向上返回数据，减少各层次节点间的调用次数</li>
</ul>
<p>在数据量比较大的情况下，内存可能放不下这些数据，需要写盘，这样会造成额外的开销。</p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ul>
<li>向量化执行引擎可以减少节点间的调度，提高CPU的利用率。</li>
<li>因为列存数据，同一列的数据放在一起，导致向量化执行引擎在执行的时候拥有了更多的机会能够利用的当前硬件与编译的新优化特征。</li>
<li>因为列存数据存储将同类型的类似数据放在一起使得压缩比能够达到更高，这样可以拉近一些磁盘IO能力与计算能力的差距。</li>
</ul>
<h2 id="注意的问题"><a href="#注意的问题" class="headerlink" title="注意的问题"></a>注意的问题</h2><ul>
<li>通信库的效率: MPP架构上是share nothing架构的，所以它的集群各执行节点是有通信需要的，通信效率的高低也是决定了查询执行效率。另外就是大集群情况下，如果使用tcp方式连接，连接数会受限。</li>
<li>数据读写争抢问题 这个问题本身不是向量化执行引擎的，而是列存带来的，因为列存储表每一列单独存储为一个文件，这样在写盘的时候有优化与没有优化的差距还是非常明显的。</li>
<li>列存数据过滤效率问题 列存数据中的一个处理单元是由连续的N个值放在一起组成的一个Col（数组），然后再由多个Col的数组组成了一个处理单元。在进行过率的时候如何能够更加紧凑的放置数据是需要我们考虑列存在过滤掉效率和存放之间如何优化的问题。</li>
<li>表达式计算问题（LLVM） LLVM优化可以将表达式计算由遍历树多层调用模式变为，只调用一个函数的扁平式执行方式。这样可以极大的提高表达式的执行性能。值得一提的是LLVM技术的优势也可以应用在执行计划编译执行模型的构建上面。</li>
</ul>
<h1 id="火山模型"><a href="#火山模型" class="headerlink" title="火山模型"></a>火山模型</h1><p>例如 SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Id, Name, Age, (Age <span class="operator">-</span> <span class="number">30</span>) <span class="operator">*</span> <span class="number">50</span> <span class="keyword">AS</span> Bonus</span><br><span class="line"><span class="keyword">FROM</span> People</span><br><span class="line"><span class="keyword">WHERE</span> Age <span class="operator">&gt;</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>对应火山模型如下：</p>
<p><img src="vx_images/3461008149501.jpg"></p>
<p>其中——</p>
<p>User：客户端；</p>
<p>Project：垂直分割（投影），选择字段；</p>
<p>Select（或 Filter）：水平分割（选择)，用于过滤行，也称为谓词；</p>
<p>Scan：扫描数据。</p>
<p>这里包含了 3 个 Operator，首先 User 调用最上方的 Operator（Project）希望得到 next tuple，Project 调用子节点（Select），而 Select 又调用子节点（Scan），Scan 获得表中的 tuple 返回给 Select，Select 会检查是否满足过滤条件，如果满足则返回给 Project，如果不满足则请求 Scan 获取 next tuple。Project 会对每一个 tuple 选择需要的字段或者计算新字段并返回新的 tuple 给 User。当 Scan 发现没有数据可以获取时，则返回一个结束标记告诉上游已结束。</p>
<p>为了更好地理解一个 Operator 中发生了什么，下面通过伪代码来理解 Select Operator：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Tuple <span class="title">Select::next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        Tuple candidate = child-&gt;next(); <span class="comment">// 从子节点中获取 next tuple</span></span><br><span class="line">        <span class="keyword">if</span> (candidate == EndOfStream) <span class="comment">// 是否得到结束标记</span></span><br><span class="line">            <span class="keyword">return</span> EndOfStream;</span><br><span class="line">        <span class="keyword">if</span> (condition-&gt;check(candidate)) <span class="comment">// 是否满足过滤条件</span></span><br><span class="line">            <span class="keyword">return</span> candidate; <span class="comment">// 返回 tuple</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="火山模型的优缺点"><a href="#火山模型的优缺点" class="headerlink" title="火山模型的优缺点"></a>火山模型的优缺点</h2><p>可以看出火山模型的<strong>优点</strong>在于：简单，每个 Operator 可以单独抽象实现、不需要关心其他 Operator 的逻辑。</p>
<p>那么<strong>缺点</strong>呢？也够明显吧？每次都是计算一个 tuple（Tuple-at-a-time），这样会造成多次调用 next ，也就是造成大量的虚函数调用，这样会造成 CPU 的利用率不高。</p>
<blockquote>
<p>知识点补习——虚函数<br>C++ 中用 virtual 标记的函数，而在 Java 中没有 final 修饰的普通方法（没有标记为 static、native）都是虚函数。<br>虚函数的重要特性是支持在子类中进行 override（重写），从而实现面向对象的重要特性之一：多态。</p>
</blockquote>
<p>但是为什么之前的数据库设计者没有去优化这方面呢？是他们没想到吗？怎么可能？这个时候我们可能要考虑到 30 年前的硬件水平了，当时的 IO 速度是远远小于 CPU 的计算速度的，那么 SQL 查询引擎的优化则会被 IO 开销所遮蔽（毕竟花费很多精力只带来 1% 场景下的速度提升意义并不大）。</p>
<p>可是随着近些年来存储越来越快，这个时候我们再思考如何让计算更快可能就有点意思了。</p>
<h2 id="虚函数造成cpu利用率不高"><a href="#虚函数造成cpu利用率不高" class="headerlink" title="虚函数造成cpu利用率不高"></a>虚函数造成cpu利用率不高</h2><ul>
<li>空间开销<br>  首先，由于需要为每一个包含虚函数的类生成一个虚函数表，所以程序的二进制文件大小会相应的增大；其次，对于包含虚函数的类的实例来说，每个实例都包含一个虚函数表指针用于指向对应的虚函数表，所以每个实例的空间占用都增加一个指针大小（32位系统4字节，64位系统8字节）。这些空间开销可能会造成缓存的不友好，在一定程度上影响程序性能。</li>
<li>时间开销<br>  虚函数的时间开销主要是增加了一次内存寻址，通过虚函数表指针找到虚函数表，虽对程序性能有一些影响，但是影响并不大。</li>
</ul>
<p>影响到虚函数调用性能的背后原因是流水线和分支预测，由于虚函数调用需要间接跳转，所以会导致虚函数调用比普通函数调用多了分支预测的过程，产生性能差距的原因主要是分支预测失败导致的流水线冲刷性能开销。</p>
<h2 id="优化方向"><a href="#优化方向" class="headerlink" title="优化方向"></a>优化方向</h2><h2 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h2><p><img src="vx_images/5443594707024.png"></p>
<h2 id="向量化"><a href="#向量化" class="headerlink" title="向量化"></a>向量化</h2><p>按照行加载到CPU Cache，如果只访问个别列就丢弃了，CPU Cache利用率不高。<br>按列存储，因为输入是同列的一组数据，面对的是相同的操作，并且如果每次只取一列的部分数据，返回一个可以放到 CPU Cache 的向量，那么又可以利用到 CPU Cache。</p>
<p>知识点补习：向量化<br>向量化计算就是将一个循环处理一个数组的时候每次处理 1 个数据共处理 N 次，转化为向量化——每次同时处理 8 个数据共处理 N/8 次，其中依赖的技术就是 SIMD（Single Instruction Multiple Data，单指令流多数据流），SIMD 可以在一条 CPU 指令上处理 2、4、8 或者更多份的数据。</p>
<h2 id="代码生成是否因为SQL复杂过慢"><a href="#代码生成是否因为SQL复杂过慢" class="headerlink" title="代码生成是否因为SQL复杂过慢"></a>代码生成是否因为SQL复杂过慢</h2><h2 id="循环优化"><a href="#循环优化" class="headerlink" title="循环优化"></a>循环优化</h2><h2 id="share-nothing架构"><a href="#share-nothing架构" class="headerlink" title="share nothing架构"></a>share nothing架构</h2><h2 id="表达式计算问题（LLVM）"><a href="#表达式计算问题（LLVM）" class="headerlink" title="表达式计算问题（LLVM）"></a>表达式计算问题（LLVM）</h2><p>列式存储</p>
<p>SIMD</p>
<p>火山模型</p>
<p>延迟物化</p>
<p>谓词</p>
<p>Greenplum</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/distributed/02.%E9%99%90%E6%B5%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/distributed/02.%E9%99%90%E6%B5%81/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="02-限流"><a href="#02-限流" class="headerlink" title="02.限流"></a>02.限流</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/other/hexo/hexo._config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/other/hexo/hexo._config/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          {"title":"Guadazi","subtitle":null,"description":"My wiki -  flat kownledages library","keywords":null,"author":"averyzhang","language":"zh-Hans","timezone":null,"url":"http://yoursite.com","root":"/","permalink":":title/","permalink_defaults":null,"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":true,"filename_case":0,"render_drafts":false,"post_asset_folder":false,"relative_link":false,"future":true,"highlight":{"enable":true,"line_number":true,"auto_detect":false,"tab_replace":null},"index_generator":{"path":"","per_page":10,"order_by":"-date"},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","per_page":10,"pagination_dir":"page","theme":"next","deploy":{"type":"git","repo":"git@github.com:zuofengzhang/guadazi-wiki.git","branch":"gh-pages"},"search":{"path":"search.xml","field":"post","format":"html","limit":10000}}
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/other/hexo/1.gitee%E5%9B%BE%E5%BA%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/other/hexo/1.gitee%E5%9B%BE%E5%BA%8A/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-gitee图床"><a href="#1-gitee图床" class="headerlink" title="1.gitee图床"></a>1.gitee图床</h1><p>因为自建博客需要图片服务器,考虑到用本机的图片服务器需要考虑数据备份链接路径等一系列问题,还是推荐使用第三方的服务</p>
<p>当前各个主要平台的oss服务，有免费的有收费的,这里就不多说,毕竟个人的理解不一样</p>
<p>本文只讨论使用码云搭建第三方图床的问题,好了,开始使用码云搭建图床的具体操作</p>
<h3 id="在码云上建一个空的远程仓库-然后建一个空的文件夹"><a href="#在码云上建一个空的远程仓库-然后建一个空的文件夹" class="headerlink" title="在码云上建一个空的远程仓库,然后建一个空的文件夹"></a>在码云上建一个空的远程仓库,然后建一个空的文件夹</h3><p>这里有几点建议</p>
<ul>
<li>不要轻易修改仓库的名字和文件夹的名字</li>
<li>注意命名规范简洁,有点强迫症不好意思,丑的链接接受不了</li>
</ul>
<p>最终的路径像这样,当然你要图片链接更加简洁使用根目录当我没说<br><code>https://gitee.com/iMist/res/tree/master/upload_images</code></p>
<p>然后点击上传文件,进入上传页面,上传一张图片,这个就是我们以后会使用的图床界面</p>
<p><img src="images/20191207121344004_555127881.png"></p>
<p>其实这个时候可以使用码云库的链接访问了,如果你的库是<code>public</code>的</p>
<p>你的链接类似这样<code>https://gitee.com/iMist/res/raw/master/upload_images/img_gitee_pages.png</code></p>
<blockquote>
<p>注意：图片链接需要将<code>blob</code>替换成<code>raw</code>,才是图片的永久链接</p>
</blockquote>
<p>其实这个路径可以用在博客中了,路径还算简短,但是到此为止,就太没有意思了,你用接口测试工具访问一下这个图片,每次都在几百毫秒左右,我用<code>wordpress</code>本来就放弃了<br>一部分的速度要求,现在还搞这么慢,不能忍</p>
<h3 id="方式二-利用码云提供的Gitee-Pages搭建静态页面服务"><a href="#方式二-利用码云提供的Gitee-Pages搭建静态页面服务" class="headerlink" title="方式二:利用码云提供的Gitee Pages搭建静态页面服务"></a>方式二:利用码云提供的<code>Gitee Pages</code>搭建静态页面服务</h3><p>这个可以用来搭建静态博客<code>hexo</code>等,但是我们是要来搭建图床的<br><img src="images/20191207121343697_952955927.png" alt="img"></p>
<p><img src="images/20191207121343241_636860794.png" alt="img"></p>
<p>点击<code>Gitee Pages</code>,将当前分支一般是master分支作为部署的分支,选择根目录（不填就行了代表整个仓库）,然后点击启动就开始部署了</p>
<p>部署完成就可以访问之前上传的测试图片,地址像这样<code>https://imist.gitee.io/res/upload_images/img_gitee_pages.png</code></p>
<p>保留上传链接作为快捷图床服务</p>
<p><code>https://gitee.com/iMist/res/upload/master/upload_images</code><br>以后就可以快速打开图床了,接口测试工据测试一下,缓存生效了,速度很快,适合静态资源的保存</p>
<p>写在最后,这种方式有点不好的就是每次都要重新部署一下服务才能访问图片,要掏钱才能推送立刻部署</p>
<h3 id="方式三-通过码云OpenAPI自行搭建图床-推荐"><a href="#方式三-通过码云OpenAPI自行搭建图床-推荐" class="headerlink" title="方式三:通过码云OpenAPI自行搭建图床(推荐)"></a>方式三:通过码云OpenAPI自行搭建图床(推荐)</h3><p>前面两种方法相当简单,但是比较low,都免费了还方便使用git管理,管他呢,现在推荐第三种方式通过码云openapi编写代码实现上传图片并且返回<code>url</code> <code>html</code>以及<code>markdown</code>格式的链接<br>首先<br>首先了解一下码云的<code>OpenApi</code><br><a target="_blank" rel="noopener" href="https://gitee.com/api/v5/swagger#/getV5ReposOwnerRepoStargazers?ex=no">码云OpenApi文档</a></p>
<p><code>点击仓库-&gt;新建文件</code>接口文档<br><img src="images/20191207121342608_883834082.png" alt="img"><br>好的,我们现在看一下文件上传接口规范<br><img src="images/20191207121342104_1127425720.png" alt="img"><br>这里特意提一下<code>access_token</code> 这个参数就是码云OpenApi私人令牌,可以直接在申请,但是申请的令牌只有一天的有效期,这显然不是我们需要的<br>,图片需要base64编码(暗示不可以上传大图),接口请求参考如下<br><img src="images/20191207121341495_640083683.png" alt="img"><br>上传图片响应<br><img src="images/20191207121340888_2032965796.png" alt="img"></p>
<p>再来介绍第二个接口,这里直接通过接口测试工具展示了,比较需要注意的是登录账号是绑定的邮箱号(POST请求,<code>Content-Type: application/x-www-form-urlencoded</code> ) ,<code>client_secret</code>和 <code>client_id</code>需要创建第三方应用获取,scope代表授权项,空格隔开</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST --data-urlencode &quot;grant_type&#x3D;password&quot; --data-urlencode &quot;username&#x3D;&#123;email&#125;&quot; --data-urlencode &quot;password&#x3D;&#123;password&#125;&quot; --data-urlencode &quot;client_id&#x3D;&#123;client_id&#125;&quot; --data-urlencode &quot;client_secret&#x3D;&#123;client_secret&#125;&quot; --data-urlencode &quot;scope&#x3D;projects user_info issues notes&quot; https:&#x2F;&#x2F;gitee.com&#x2F;oauth&#x2F;token</span><br></pre></td></tr></table></figure>
<p><img src="images/20191207121340383_285494061.png" alt="img"><br>密码登录响应<br><img src="images/20191207121339876_435751514.png" alt="img"></p>
<p>第三个接口是当 access_token 过期后（有效期为一天），你可以通过以下 refresh_token 方式重新获取 access_token（ POST请求 ）,请求响应和第二个登录接口响应一致<br><code>https://gitee.com/oauth/token?grant_type=refresh_token&amp;refresh_token=&#123;refresh_token&#125;</code></p>
<p>了解完这些就直接编写代码就可以了,这里我不清楚可不可以用部署的静态页面通过代码上传,没有测试过,但是我是部署了一个轻量级服务来实现的,代码这里就不发了,就是调用一下接口就行了,比较简单,看一下最终的效果(我写的页面比较low,没有润色打磨,毕竟是自己用的将就看一下)<br><img src="images/20191207121339372_1837590703.png" alt="img"></p>
<h2 id="小确幸"><a href="#小确幸" class="headerlink" title="小确幸"></a>小确幸</h2><p><code>每一丝灵感都值得被记录,每一笔记录都是成长,每一点成长都值得欢呼</code></p>
<p>博主个人站: <a target="_blank" rel="noopener" href="https://www.imisty.cn/">www.imisty.cn</a><br>CSDN博客: <a target="_blank" rel="noopener" href="https://blog.csdn.net/lookinthefog">https://blog.csdn.net/lookinthefog</a><br>博客园 :<a target="_blank" rel="noopener" href="https://www.cnblogs.com/imist">https://imist.cnblogs.com/</a></p>
<p>希望能够认识一些热爱技术的小伙伴,欢迎友链接哟</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/other/hexo/hexo.next._config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/other/hexo/hexo.next._config/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          {"override":false,"favicon":{"small":"/images/favicon-16x16-next.png","medium":"/images/favicon-32x32-next.png","apple_touch_icon":"/images/apple-touch-icon-next.png","safari_pinned_tab":"/images/logo.svg"},"keywords":"Hexo, NexT","rss":null,"footer":{"since":2015,"icon":"user","copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":false,"index_with_subtitle":false,"menu":{"home":"/ || home","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_icons":{"enable":true},"scheme":"Gemini","social_icons":{"enable":true,"icons_only":false,"transition":false},"links_icon":"link","links_title":"Links","links_layout":"block","links":{"easy blog":"http://blog.zhangzuofeng.cn"},"avatar":"/images/logo.png","toc":{"enable":true,"number":true,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},"scroll_to_more":true,"save_scroll":false,"excerpt_description":true,"auto_excerpt":{"enable":true,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"categories":true},"post_wordcount":{"item_text":true,"wordcount":false,"min2read":false,"totalcount":false,"separated_meta":true},"post_copyright":{"enable":false,"license":"CC BY-NC-SA 3.0","license_url":"https://creativecommons.org/licenses/by-nc-sa/3.0/"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"night bright","font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"mathjax":{"enable":false,"per_page":false,"cdn":"//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"},"han":false,"disqus":{"enable":false,"shortname":null,"count":true},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":null,"appkey":null,"notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"duoshuo_info":{"ua_enable":true,"admin_enable":false,"user_id":0},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":null,"app_key":null},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":false,"site_uv":true,"site_uv_header":"<i class=\"fa fa-user\"></i>","site_uv_footer":null,"site_pv":true,"site_pv_header":"<i class=\"fa fa-eye\"></i>","site_pv_footer":null,"page_pv":true,"page_pv_header":"<i class=\"fa fa-file-o\"></i>","page_pv_footer":null},"baidu_push":false,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":true,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":false,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"needMoreShare2":null},"css":"css","js":"js","images":"images","version":"5.1.4"}
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/other/ML/Persona/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/other/ML/Persona/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Persona-用户画像"><a href="#Persona-用户画像" class="headerlink" title="Persona 用户画像"></a>Persona 用户画像</h1><p><img src="_v_images/20190719185754420_392880617.png" alt="用户画像建模体系"><br><img src="_v_images/20190719185943507_312176550.png" alt="用户画像技术体系"></p>
<p><img src="_v_images/20190719190207508_181494051.png" alt="画像应用"></p>
<p>画像枚举值</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/other/ML/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5-python3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/other/ML/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5-python3/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="机器学习实践-python3"><a href="#机器学习实践-python3" class="headerlink" title="机器学习实践-python3"></a>机器学习实践-python3</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/c406495762/column/info/16415">机器学习实践-Python3 CSDN专栏</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/other/devops/spring-boot-service-ops/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/other/devops/spring-boot-service-ops/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-10 16:13:50" itemprop="dateCreated datePublished" datetime="2021-07-10T16:13:50+08:00">2021-07-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="spring-boot访问运维脚本"><a href="#spring-boot访问运维脚本" class="headerlink" title="spring boot访问运维脚本"></a>spring boot访问运维脚本</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">aaronzhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">252</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">127</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aaronzhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
