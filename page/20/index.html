<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Guadazi">
<meta property="og:url" content="http://example.com/page/20/index.html">
<meta property="og:site_name" content="Guadazi">
<meta property="og:locale">
<meta property="article:author" content="aaronzhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/20/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>Guadazi</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Guadazi</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/database/MySQL/syntax_5_sample/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/database/MySQL/syntax_5_sample/" class="post-title-link" itemprop="url">MySQL SQL语法样例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-29 00:00:00" itemprop="dateCreated datePublished" datetime="2016-07-29T00:00:00+08:00">2016-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:20" itemprop="dateModified" datetime="2021-04-10T17:39:20+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DataBase/" itemprop="url" rel="index"><span itemprop="name">DataBase</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>建立如下的表格:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tdb_goods;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------------------------------+---------------+------------+-------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id <span class="operator">|</span> goods_name                                                             <span class="operator">|</span> goods_cate    <span class="operator">|</span> brand_name <span class="operator">|</span> goods_price <span class="operator">|</span> is_show <span class="operator">|</span> is_saleoff <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------------------------------------------------------+---------------+------------+-------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> R510VC <span class="number">15.6</span>英寸笔记本                                                  <span class="operator">|</span> 笔记本        <span class="operator">|</span> 华硕       <span class="operator">|</span>    <span class="number">3399.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> Y400N <span class="number">14.0</span>英寸笔记本电脑                                               <span class="operator">|</span> 笔记本        <span class="operator">|</span> 联想       <span class="operator">|</span>    <span class="number">4899.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> G150TH <span class="number">15.6</span>英寸游戏本                                                  <span class="operator">|</span> 游戏本        <span class="operator">|</span> 雷神       <span class="operator">|</span>    <span class="number">8499.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">4</span> <span class="operator">|</span> X550CC <span class="number">15.6</span>英寸笔记本                                                  <span class="operator">|</span> 笔记本        <span class="operator">|</span> 华硕       <span class="operator">|</span>    <span class="number">2799.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">5</span> <span class="operator">|</span> X240(<span class="number">20</span>ALA0EYCD) <span class="number">12.5</span>英寸超极本                                        <span class="operator">|</span> 超级本        <span class="operator">|</span> 联想       <span class="operator">|</span>    <span class="number">4999.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">6</span> <span class="operator">|</span> U330P <span class="number">13.3</span>英寸超极本                                                   <span class="operator">|</span> 超级本        <span class="operator">|</span> 联想       <span class="operator">|</span>    <span class="number">4299.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">7</span> <span class="operator">|</span> SVP13226SCB <span class="number">13.3</span>英寸触控超极本                                         <span class="operator">|</span> 超级本        <span class="operator">|</span> 索尼       <span class="operator">|</span>    <span class="number">7999.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">8</span> <span class="operator">|</span> iPad mini MD531CH<span class="operator">/</span>A <span class="number">7.9</span>英寸平板电脑                                    <span class="operator">|</span> 平板电脑      <span class="operator">|</span> 苹果       <span class="operator">|</span>    <span class="number">1998.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">9</span> <span class="operator">|</span> iPad Air MD788CH<span class="operator">/</span>A <span class="number">9.7</span>英寸平板电脑 （<span class="number">16</span>G WiFi版）                      <span class="operator">|</span> 平板电脑      <span class="operator">|</span> 苹果       <span class="operator">|</span>    <span class="number">3388.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">10</span> <span class="operator">|</span>  iPad mini ME279CH<span class="operator">/</span>A 配备 Retina 显示屏 <span class="number">7.9</span>英寸平板电脑 （<span class="number">16</span>G WiFi版） <span class="operator">|</span> 平板电脑      <span class="operator">|</span> 苹果       <span class="operator">|</span>    <span class="number">2788.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">11</span> <span class="operator">|</span> IdeaCentre C340 <span class="number">20</span>英寸一体电脑                                         <span class="operator">|</span> 台式机        <span class="operator">|</span> 联想       <span class="operator">|</span>    <span class="number">3499.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">12</span> <span class="operator">|</span> Vostro <span class="number">3800</span><span class="operator">-</span>R1206 台式电脑                                             <span class="operator">|</span> 台式机        <span class="operator">|</span> 戴尔       <span class="operator">|</span>    <span class="number">2899.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> iMac ME086CH<span class="operator">/</span>A <span class="number">21.5</span>英寸一体电脑                                        <span class="operator">|</span> 台式机        <span class="operator">|</span> 苹果       <span class="operator">|</span>    <span class="number">9188.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">14</span> <span class="operator">|</span> AT7<span class="number">-7414</span>LP 台式电脑 （i5<span class="number">-3450</span>四核 <span class="number">4</span>G <span class="number">500</span>G <span class="number">2</span>G独显 DVD 键鼠 Linux ）     <span class="operator">|</span> 台式机        <span class="operator">|</span> 宏碁       <span class="operator">|</span>    <span class="number">3699.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">15</span> <span class="operator">|</span> Z220SFF F4F06PA工作站                                                  <span class="operator">|</span> 服务器<span class="operator">/</span>工作站 <span class="operator">|</span> 惠普       <span class="operator">|</span>    <span class="number">4288.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">16</span> <span class="operator">|</span> PowerEdge T110 II服务器                                                <span class="operator">|</span> 服务器<span class="operator">/</span>工作站 <span class="operator">|</span> 戴尔       <span class="operator">|</span>    <span class="number">5388.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">17</span> <span class="operator">|</span> Mac Pro MD878CH<span class="operator">/</span>A 专业级台式电脑                                       <span class="operator">|</span> 服务器<span class="operator">/</span>工作站 <span class="operator">|</span> 苹果       <span class="operator">|</span>   <span class="number">28888.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">18</span> <span class="operator">|</span>  HMZ<span class="operator">-</span>T3W 头戴显示设备                                                  <span class="operator">|</span> 笔记本配件    <span class="operator">|</span> 索尼       <span class="operator">|</span>    <span class="number">6999.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">19</span> <span class="operator">|</span> 商务双肩背包                                                           <span class="operator">|</span> 笔记本配件    <span class="operator">|</span> 索尼       <span class="operator">|</span>      <span class="number">99.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">20</span> <span class="operator">|</span> X3250 M4机架式服务器 <span class="number">2583</span>i14                                           <span class="operator">|</span> 服务器<span class="operator">/</span>工作站 <span class="operator">|</span> IBM        <span class="operator">|</span>    <span class="number">6888.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">21</span> <span class="operator">|</span> 玄龙精英版 笔记本散热器                                                <span class="operator">|</span> 笔记本配件    <span class="operator">|</span> 九州风神   <span class="operator">|</span>       <span class="number">0.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">22</span> <span class="operator">|</span>  HMZ<span class="operator">-</span>T3W 头戴显示设备                                                  <span class="operator">|</span> 笔记本配件    <span class="operator">|</span> 索尼       <span class="operator">|</span>    <span class="number">6999.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">23</span> <span class="operator">|</span> 商务双肩背包                                                           <span class="operator">|</span> 笔记本配件    <span class="operator">|</span> 索尼       <span class="operator">|</span>      <span class="number">99.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------------------------------------------+---------------+------------+-------------+---------+------------+</span></span><br></pre></td></tr></table></figure>
<p>计算所有商品的平均价格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(goods_price) <span class="keyword">AS</span> &quot;average price&quot; <span class="keyword">FROM</span> tdb_goods;</span><br></pre></td></tr></table></figure>
<p>评价价格保留两位小数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">AVG</span>(goods_price),<span class="number">2</span>) <span class="keyword">AS</span> &quot;average price&quot; <span class="keyword">FROM</span> tdb_goods;</span><br></pre></td></tr></table></figure>
<p>计算高于平均价格的商品</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> goods_id,goods_name,goods_price <span class="keyword">FROM</span> tdb_goods <span class="keyword">WHERE</span> goods_price<span class="operator">&gt;=</span><span class="number">5635.36</span>;</span><br></pre></td></tr></table></figure>
<p>使用子查询查询价格高于平均价格的商品信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> goods_id,goods_name,goods_price <span class="keyword">FROM</span> tdb_goods <span class="keyword">WHERE</span> goods_price<span class="operator">&gt;=</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(goods_price) <span class="keyword">FROM</span> tdb_goods</span><br><span class="line">    );</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id <span class="operator">|</span> goods_name                       <span class="operator">|</span> goods_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> G150TH <span class="number">15.6</span>英寸游戏本            <span class="operator">|</span>    <span class="number">8499.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">7</span> <span class="operator">|</span> SVP13226SCB <span class="number">13.3</span>英寸触控超极本   <span class="operator">|</span>    <span class="number">7999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> iMac ME086CH<span class="operator">/</span>A <span class="number">21.5</span>英寸一体电脑  <span class="operator">|</span>    <span class="number">9188.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">17</span> <span class="operator">|</span> Mac Pro MD878CH<span class="operator">/</span>A 专业级台式电脑 <span class="operator">|</span>   <span class="number">28888.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">18</span> <span class="operator">|</span>  HMZ<span class="operator">-</span>T3W 头戴显示设备            <span class="operator">|</span>    <span class="number">6999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">20</span> <span class="operator">|</span> X3250 M4机架式服务器 <span class="number">2583</span>i14     <span class="operator">|</span>    <span class="number">6888.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">22</span> <span class="operator">|</span>  HMZ<span class="operator">-</span>T3W 头戴显示设备            <span class="operator">|</span>    <span class="number">6999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>使用子查询 计算高于平均价格的所有商品的评价价格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(goods_price) <span class="keyword">FROM</span> tdb_goods <span class="keyword">WHERE</span> goods_price<span class="operator">&gt;=</span>(<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(goods_price) <span class="keyword">FROM</span> tdb_goods);</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">AVG</span>(goods_price) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">10780.0000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"></span><br><span class="line">使用avg函数时, 只有一条记录, 其他字段的信息只显示第一条.</span><br><span class="line"><span class="keyword">SELECT</span> goods_id,goods_name,goods_price,<span class="built_in">AVG</span>(goods_price) <span class="keyword">FROM</span> tdb_goods <span class="keyword">WHERE</span> goods_price<span class="operator">&gt;=</span>(<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(goods_price) <span class="keyword">FROM</span> tdb_goods);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------------------+-------------+------------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id <span class="operator">|</span> goods_name            <span class="operator">|</span> goods_price <span class="operator">|</span> <span class="built_in">AVG</span>(goods_price) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------------------+-------------+------------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> G150TH <span class="number">15.6</span>英寸游戏本 <span class="operator">|</span>    <span class="number">8499.000</span> <span class="operator">|</span>    <span class="number">10780.0000000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------------------+-------------+------------------+</span></span><br></pre></td></tr></table></figure>
<p>利用子查询查询比”超极本”贵的商品信息(这里的”贵”就体现于多条记录比较时的处理)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> goods_price <span class="keyword">from</span> tdb_goods <span class="keyword">where</span> goods_cate<span class="operator">=</span><span class="string">&#x27;超级本&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> goods_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4299.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">7999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> goods_id,goods_name,goods_price <span class="keyword">FROM</span> tdb_goods </span><br><span class="line"><span class="keyword">WHERE</span> goods_price <span class="operator">&gt;</span><span class="keyword">ANY</span> (</span><br><span class="line">    <span class="keyword">select</span> goods_price <span class="keyword">from</span> tdb_goods <span class="keyword">where</span> goods_cate<span class="operator">=</span><span class="string">&#x27;超级本&#x27;</span></span><br><span class="line">    );</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id <span class="operator">|</span> goods_name                       <span class="operator">|</span> goods_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> Y400N <span class="number">14.0</span>英寸笔记本电脑         <span class="operator">|</span>    <span class="number">4899.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> G150TH <span class="number">15.6</span>英寸游戏本            <span class="operator">|</span>    <span class="number">8499.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">5</span> <span class="operator">|</span> X240(<span class="number">20</span>ALA0EYCD) <span class="number">12.5</span>英寸超极本  <span class="operator">|</span>    <span class="number">4999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">7</span> <span class="operator">|</span> SVP13226SCB <span class="number">13.3</span>英寸触控超极本   <span class="operator">|</span>    <span class="number">7999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> iMac ME086CH<span class="operator">/</span>A <span class="number">21.5</span>英寸一体电脑  <span class="operator">|</span>    <span class="number">9188.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">16</span> <span class="operator">|</span> PowerEdge T110 II服务器          <span class="operator">|</span>    <span class="number">5388.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">17</span> <span class="operator">|</span> Mac Pro MD878CH<span class="operator">/</span>A 专业级台式电脑 <span class="operator">|</span>   <span class="number">28888.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">18</span> <span class="operator">|</span>  HMZ<span class="operator">-</span>T3W 头戴显示设备            <span class="operator">|</span>    <span class="number">6999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">20</span> <span class="operator">|</span> X3250 M4机架式服务器 <span class="number">2583</span>i14     <span class="operator">|</span>    <span class="number">6888.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">22</span> <span class="operator">|</span>  HMZ<span class="operator">-</span>T3W 头戴显示设备            <span class="operator">|</span>    <span class="number">6999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> goods_id,goods_name,goods_price <span class="keyword">FROM</span> tdb_goods <span class="keyword">WHERE</span> goods_price <span class="operator">&gt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">select</span> goods_price <span class="keyword">from</span> tdb_goods <span class="keyword">where</span> goods_cate<span class="operator">=</span><span class="string">&#x27;超级本&#x27;</span></span><br><span class="line">    );</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id <span class="operator">|</span> goods_name                       <span class="operator">|</span> goods_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> G150TH <span class="number">15.6</span>英寸游戏本            <span class="operator">|</span>    <span class="number">8499.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">13</span> <span class="operator">|</span> iMac ME086CH<span class="operator">/</span>A <span class="number">21.5</span>英寸一体电脑  <span class="operator">|</span>    <span class="number">9188.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">17</span> <span class="operator">|</span> Mac Pro MD878CH<span class="operator">/</span>A 专业级台式电脑 <span class="operator">|</span>   <span class="number">28888.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------------------------------+-------------+</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">SELECT</span> goods_id,goods_name,goods_price <span class="keyword">FROM</span> tdb_goods <span class="keyword">WHERE</span> goods_price <span class="operator">=</span> <span class="keyword">ANY</span> (</span><br><span class="line">    <span class="keyword">select</span> goods_price <span class="keyword">from</span> tdb_goods <span class="keyword">where</span> goods_cate<span class="operator">=</span><span class="string">&#x27;超级本&#x27;</span></span><br><span class="line">    );</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id <span class="operator">|</span> goods_name                      <span class="operator">|</span> goods_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------------------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">5</span> <span class="operator">|</span> X240(<span class="number">20</span>ALA0EYCD) <span class="number">12.5</span>英寸超极本 <span class="operator">|</span>    <span class="number">4999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">6</span> <span class="operator">|</span> U330P <span class="number">13.3</span>英寸超极本            <span class="operator">|</span>    <span class="number">4299.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">7</span> <span class="operator">|</span> SVP13226SCB <span class="number">13.3</span>英寸触控超极本  <span class="operator">|</span>    <span class="number">7999.000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------------------------------+-------------+</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>多表更新:<br>参照分类表更新商品表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> tdb_goods_cates(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> cate_id <span class="type">SMALLINT</span> UNSIGNED <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> cate_name <span class="type">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> COLUMNS <span class="keyword">FROM</span> tdb_goods_cates;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+----------------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field     <span class="operator">|</span> Type                 <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+----------------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> cate_id   <span class="operator">|</span> <span class="type">smallint</span>(<span class="number">5</span>) unsigned <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cate_name <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">40</span>)          <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+----------------------+------+-----+---------+----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tdb_goods_cates(cate_name)  <span class="keyword">select</span> goods_cate <span class="keyword">from</span> tdb_goods </span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> goods_cate;</span><br><span class="line">Query OK, <span class="number">7</span> <span class="keyword">rows</span> affected (<span class="number">0.07</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tdb_goods_cates;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------------+</span></span><br><span class="line"><span class="operator">|</span> cate_id <span class="operator">|</span> cate_name     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span> 台式机        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span> 游戏本        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span> 平板电脑      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span> 笔记本        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span> 笔记本配件    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">6</span> <span class="operator">|</span> 超级本        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">7</span> <span class="operator">|</span> 服务器<span class="operator">/</span>工作站 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+---------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> tdb_goods</span><br><span class="line">  <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tdb_goods_cates</span><br><span class="line">    <span class="keyword">ON</span> goods_cate <span class="operator">=</span> cate_name</span><br><span class="line">    <span class="keyword">SET</span> goods_cate<span class="operator">=</span>cate_id;</span><br><span class="line">Query OK, <span class="number">23</span> <span class="keyword">rows</span> affected (<span class="number">0.08</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tdb_goods\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">   goods_id: <span class="number">1</span></span><br><span class="line"> goods_name: R510VC <span class="number">15.6</span>英寸笔记本</span><br><span class="line"> goods_cate: <span class="number">4</span></span><br><span class="line"> brand_name: 华硕</span><br><span class="line">goods_price: <span class="number">3399.000</span></span><br><span class="line">    is_show: <span class="number">1</span></span><br><span class="line"> is_saleoff: <span class="number">0</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">   goods_id: <span class="number">2</span></span><br><span class="line"> goods_name: Y400N <span class="number">14.0</span>英寸笔记本电脑</span><br><span class="line"> goods_cate: <span class="number">4</span></span><br><span class="line"> brand_name: 联想</span><br><span class="line">goods_price: <span class="number">4899.000</span></span><br><span class="line">    is_show: <span class="number">1</span></span><br><span class="line"> is_saleoff: <span class="number">0</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">3.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">   goods_id: <span class="number">3</span></span><br><span class="line"> goods_name: G150TH <span class="number">15.6</span>英寸游戏本</span><br><span class="line"> goods_cate: <span class="number">2</span></span><br><span class="line"> brand_name: 雷神</span><br><span class="line">goods_price: <span class="number">8499.000</span></span><br><span class="line">    is_show: <span class="number">1</span></span><br><span class="line"> is_saleoff: <span class="number">0</span></span><br><span class="line"> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> goods_brands(</span><br><span class="line">    id TINYINT AUTO_INCREMENT <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>,</span><br><span class="line">    brand_name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">SELECT</span> brand_name <span class="keyword">FROM</span> tdb_goods <span class="keyword">GROUP</span> <span class="keyword">BY</span> brand_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> goods_brands;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> brand_name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 联想       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 雷神       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 索尼       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> IBM        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 苹果       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 戴尔       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 宏碁       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 惠普       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 华硕       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 九州风神   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> tdb_goods <span class="keyword">INNER</span> <span class="keyword">JOIN</span> goods_brands</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">on</span> tdb_goods.brand_name<span class="operator">=</span>goods_brands.brand_name</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">set</span> tdb_goods.brand_name<span class="operator">=</span>goods_brands.id;</span><br><span class="line">Query OK, <span class="number">23</span> <span class="keyword">rows</span> affected (<span class="number">0.09</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tdb_goods\G;</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">   goods_id: <span class="number">1</span></span><br><span class="line"> goods_name: R510VC <span class="number">15.6</span>英寸笔记本</span><br><span class="line"> goods_cate: <span class="number">4</span></span><br><span class="line"> brand_name: <span class="number">9</span></span><br><span class="line">goods_price: <span class="number">3399.000</span></span><br><span class="line">    is_show: <span class="number">1</span></span><br><span class="line"> is_saleoff: <span class="number">0</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">2.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">   goods_id: <span class="number">2</span></span><br><span class="line"> goods_name: Y400N <span class="number">14.0</span>英寸笔记本电脑</span><br><span class="line"> goods_cate: <span class="number">4</span></span><br><span class="line"> brand_name: <span class="number">1</span></span><br><span class="line">goods_price: <span class="number">4899.000</span></span><br><span class="line">    is_show: <span class="number">1</span></span><br><span class="line"> is_saleoff: <span class="number">0</span></span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DESC</span> tdb_goods;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field       <span class="operator">|</span> Type                   <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id    <span class="operator">|</span> <span class="type">smallint</span>(<span class="number">5</span>) unsigned   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> goods_name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">150</span>)           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> goods_cate  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">40</span>)            <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> brand_name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">40</span>)            <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> goods_price <span class="operator">|</span> <span class="type">decimal</span>(<span class="number">15</span>,<span class="number">3</span>) unsigned <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">0.000</span>   <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> is_show     <span class="operator">|</span> tinyint(<span class="number">1</span>)             <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">1</span>       <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> is_saleoff  <span class="operator">|</span> tinyint(<span class="number">1</span>)             <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------+------+-----+---------+----------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tdb_goods</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> CHANGE goods_cate cate_id <span class="type">SMALLINT</span> UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> CHANGE brand_name brand_id <span class="type">SMALLINT</span> UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line">Query OK, <span class="number">23</span> <span class="keyword">rows</span> affected (<span class="number">0.17</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DESC</span> tdb_goods;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field       <span class="operator">|</span> Type                   <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id    <span class="operator">|</span> <span class="type">smallint</span>(<span class="number">5</span>) unsigned   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> goods_name  <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">150</span>)           <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cate_id     <span class="operator">|</span> <span class="type">smallint</span>(<span class="number">5</span>) unsigned   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> brand_id    <span class="operator">|</span> <span class="type">smallint</span>(<span class="number">5</span>) unsigned   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> goods_price <span class="operator">|</span> <span class="type">decimal</span>(<span class="number">15</span>,<span class="number">3</span>) unsigned <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">0.000</span>   <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> is_show     <span class="operator">|</span> tinyint(<span class="number">1</span>)             <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">1</span>       <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> is_saleoff  <span class="operator">|</span> tinyint(<span class="number">1</span>)             <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------+------+-----+---------+----------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改类名</span><br><span class="line"><span class="keyword">desc</span> tdb_goods_brands;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field      <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> id         <span class="operator">|</span> tinyint(<span class="number">4</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> brand_name <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+------+-----+---------+----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tdb_goods_brands change id brand_id tinyint(<span class="number">4</span>) <span class="keyword">not</span> <span class="keyword">null</span> ;</span><br><span class="line">Query OK, <span class="number">13</span> <span class="keyword">rows</span> affected (<span class="number">0.20</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">desc</span> tdb_goods_brands;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field      <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> brand_id   <span class="operator">|</span> tinyint(<span class="number">4</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> brand_name <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+------+-----+---------+-------+</span></span><br></pre></td></tr></table></figure>
<p>删除商品名称重复记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">查找名称相同的记录</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tdb_goods <span class="keyword">as</span> t1 <span class="keyword">group</span> <span class="keyword">by</span> t1.goods_name <span class="keyword">having</span> <span class="built_in">count</span>(t1.goods_name)<span class="operator">&gt;=</span><span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------------------+---------+----------+-------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> goods_id <span class="operator">|</span> goods_name            <span class="operator">|</span> cate_id <span class="operator">|</span> brand_id <span class="operator">|</span> goods_price <span class="operator">|</span> is_show <span class="operator">|</span> is_saleoff <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------------------+---------+----------+-------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">18</span> <span class="operator">|</span>  HMZ<span class="operator">-</span>T3W 头戴显示设备 <span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span>    <span class="number">6999.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">19</span> <span class="operator">|</span> 商务双肩背包          <span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span>      <span class="number">99.000</span> <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>          <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------------------+---------+----------+-------------+---------+------------+</span></span><br><span class="line"></span><br><span class="line">错误的写法:</span><br><span class="line"><span class="keyword">delete</span> tt1 <span class="keyword">from</span> tdb_goods <span class="keyword">as</span> tt1 <span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line"> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tdb_goods <span class="keyword">as</span> t1 <span class="keyword">group</span> <span class="keyword">by</span> t1.goods_name <span class="keyword">having</span> <span class="built_in">count</span>(t1.goods_name)<span class="operator">&gt;=</span><span class="number">2</span>) <span class="keyword">as</span> tt2</span><br><span class="line"> <span class="keyword">on</span> tt1.goods_name<span class="operator">=</span>tt2.goods_name <span class="keyword">and</span> tt1.goods_id<span class="operator">&gt;</span>tt2.goods_id;</span><br><span class="line">Query OK, <span class="number">24</span> <span class="keyword">rows</span> affected (<span class="number">0.07</span> sec)</span><br><span class="line"></span><br><span class="line">正确的写法:</span><br><span class="line"><span class="keyword">delete</span> tt1 <span class="keyword">from</span> tdb_goods <span class="keyword">as</span> tt1 <span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tdb_goods <span class="keyword">as</span> t1 <span class="keyword">group</span> <span class="keyword">by</span> t1.goods_name </span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(t1.goods_name)<span class="operator">&gt;=</span><span class="number">2</span>) <span class="keyword">as</span> tt2 </span><br><span class="line">    <span class="keyword">on</span> tt1.goods_name<span class="operator">=</span>tt2.goods_name </span><br><span class="line">    <span class="keyword">where</span> tt1.goods_id<span class="operator">&gt;</span>tt2.goods_id;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h2 id="Delete中包含left-join"><a href="#Delete中包含left-join" class="headerlink" title="Delete中包含left join"></a>Delete中包含left join</h2><ol>
<li>左侧的表是待删除的表</li>
<li>不能关联成功的要过滤掉</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tbl_pps_nc_group_member</span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="operator">=</span> #fromUserId#</span><br><span class="line"><span class="keyword">and</span> group_id <span class="keyword">in</span> (<span class="keyword">SELECT</span> group_id <span class="keyword">FROM</span> tbl_pps_nc_group <span class="keyword">where</span> user_id <span class="operator">=</span> #myUserId# );</span><br></pre></td></tr></table></figure>
<p>与</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">FROM</span> tbl_pps_nc_group_member nm</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> tbl_pps_nc_group ng <span class="keyword">ON</span> nm.user_id <span class="operator">=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">AND</span> nm.group_id<span class="operator">=</span>ng.group_id <span class="keyword">AND</span> ng.user_id <span class="operator">=</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> ng.group_id <span class="keyword">is</span> <span class="keyword">NOT</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<h1 id="在好友关系中获取对方的信息"><a href="#在好友关系中获取对方的信息" class="headerlink" title="在好友关系中获取对方的信息"></a>在好友关系中获取对方的信息</h1><p>对于好友关系来说，是彼此的关系，可以不分先后，如果要区分邀请和被邀请，就必须考虑。<br>假设存在两个表格:<br>第一个表格是用户信息表<code>t_user_info</code>，用于记录用户的信息。<br>第二个表格是好友关系表<code>t_friend</code>, 用于记录用户的好友关系。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user_info (</span><br><span class="line">	user_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> auto_increment,</span><br><span class="line">	`name` <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	phone <span class="type">VARCHAR</span>(<span class="number">11</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_friend (</span><br><span class="line">	 friend_ref_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> auto_increment,</span><br><span class="line"> 	 from_user_id <span class="type">int</span>,</span><br><span class="line">     to_user_id <span class="type">int</span>,</span><br><span class="line">	 `status` TINYINT(<span class="number">1</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>如果要获取对方的信息，邀请者获取得到的是被邀请者的信息，而被邀请者获取得到的是邀请者的信息。<br>状态值<code>status</code>代表 0：待验证，1：已添加，2：已拒绝，4：待对方验证，5: 对方已添加，6：对方已拒绝</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	u.`name` <span class="keyword">AS</span> userName,</span><br><span class="line">	u.phone <span class="keyword">AS</span> userPhone,</span><br><span class="line">	u.user_id <span class="keyword">AS</span> userId,</span><br><span class="line">	<span class="keyword">CASE</span> <span class="keyword">WHEN</span> f.from_user_id <span class="operator">=</span> <span class="string">&#x27;1018&#x27;</span> <span class="keyword">THEN</span> 	f.`status` <span class="operator">+</span> <span class="number">4</span> <span class="keyword">ELSE</span> f.`status` <span class="keyword">END</span> <span class="keyword">AS</span> `status`</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	t_friend f</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_user_info u </span><br><span class="line">	<span class="keyword">ON</span> (u.user_id <span class="operator">=</span> f.from_user_id 	<span class="keyword">AND</span> f.to_user_id <span class="operator">=</span> <span class="string">&#x27;1018&#x27;</span> )</span><br><span class="line">		<span class="keyword">OR</span> (u.user_id <span class="operator">=</span> f.to_user_id <span class="keyword">AND</span> f.from_user_id <span class="operator">=</span> <span class="string">&#x27;1018&#x27;</span> )</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	u.user_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
<p><strong>[总结]</strong></p>
<ol>
<li><code>left join</code>中的<code>on</code>语句, 是在被关联表满足<code>on</code>条件才会关联，否则显示为<code>null</code>, 因此通过判断右侧是否为空，可以判断是否满足条件</li>
<li>关联条件是另一个技巧, 取对方的<code>id</code>条件</li>
</ol>
<h1 id="Explain解析查询"><a href="#Explain解析查询" class="headerlink" title="Explain解析查询"></a>Explain解析查询</h1><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/zhuxineli/article/details/14455029">MYSQL explain详解</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/multithread/03.volatile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/multithread/03.volatile/" class="post-title-link" itemprop="url">Java多线程3: volatile</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-28 16:00:00" itemprop="dateCreated datePublished" datetime="2016-07-28T16:00:00+08:00">2016-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:20" itemprop="dateModified" datetime="2021-04-10T17:39:20+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="/Java/advanced-engineer-outline/">&lt;&lt;Java高级软件工程师知识结构</a></p>
<pre><code>Java多线程是Java基础的重要的一部分,支持多线程是Java的重要特性之一. 主要包括如下内容:</code></pre>
<blockquote>
<ol>
<li><a href="/Java/multithread/01.base/">Java多线程1: 线程生命周期和多线程基础</a></li>
<li><a href="/Java/multithread/02.Lock-Semaphore-Atomic/">Java多线程2: Lock、信号量、原子量与队列</a></li>
<li><a href="/Java/multithread/03.volatile/">Java多线程3: volatile</a></li>
<li><a href="/Java/multithread/04.thread-synchronization/">Java多线程4: 同步锁与Java线程同步方法比较</a></li>
<li><a href="/Java/multithread/05.ThreadPool/">Java多线程5: 线程池</a></li>
<li><a href="/Java/multithread/06.BlockingQueue/">Java多线程6: Java阻塞队列与生产者消费者模式</a></li>
</ol>
</blockquote>
<h1 id="volatile用处"><a href="#volatile用处" class="headerlink" title="volatile用处"></a>volatile用处</h1><p>在JDK1.2之前,Java的内存模型实现总是从主存（即共享内存）读取变量. 为了获得最佳速度,允许线程保存共享成员变量的私有拷贝,而且只当线程进入或者离开同步代码块时才将私有拷贝与共享内存中的原始值进行比较,在当前的Java内存模型下,线程可以把变量保存在本地内存（比如机器的寄存器）中,而不是直接在主存中进行读写,这就可能造成一个线程在主存中修改了一个变量的值,而另外一个线程还继续使用它在寄存器中的变量值的拷贝,造成数据的不一致,</p>
<p>volatile 指示JVM这个变量不稳定,每次使用它都到主存中进行读取,一般说来,多任务环境下,各任务间共享的变量都应该加volatile修饰符,</p>
<p>volatile 修饰的成员变量在每次被线程访问时, 都强迫从共享内存中重读该成员变量的值, 而且, 当成员变量发生变化时, 强迫线程将变化值回写到共享内存, 这样在任何时刻, 两个不同的线程总是看到某个成员变量的同一个值,</p>
<h1 id="使用同步解决变量不一致问题"><a href="#使用同步解决变量不一致问题" class="headerlink" title="使用同步解决变量不一致问题"></a>使用同步解决变量不一致问题</h1><p>内存可见性:<br>在一个任意对象上执行同步语句,目的是为了让该线程在进入和离开同步代码块时,将该线程中的所有变量的私有拷贝与共享内存中的原始值进行比较,从而发现没有用volatile标记的变量所发生的变化</p>
<p>加锁（synchronized同步）的功能不仅仅局限于互斥行为, 同时还存在另外一个重要的方面：内存可见性, 我们不仅希望防止某个线程正在使用对象状态而另一个线程在同时修改该状态, 而且还希望确保当一个线程修改了对象状态后, 其他线程能够看到该变化, 而线程的同步恰恰也能够实现这一点, 内置锁可以用于确保某个线程以一种可预测的方式来查看另一个线程的执行结果, 为了确保所有的线程都能看到共享变量的最新值, 可以在所有执行读操作或写操作的线程上加上同一把锁, 下图示例了同步的可见性保证,</p>
<p><img src="/images/java/multithread/03.volatile/sychronized-sample.png"></p>
<p>当线程A执行某个同步代码块时, 线程B随后进入由同一个锁保护的同步代码块, 这种情况下可以保证, 当锁被释放前, A看到的所有变量值（锁释放前 , A看到的变量包括y和x）在B获得同一个锁后同样可以由B看到, 换句话说, 当线程B执行由锁保护的同步代码块时, 可以看到线程A之前在同一个锁保护的同步代码块中的所有操作结果, 如果在线程A unlock M之后, 线程B才进入lock M, 那么线程B都可以看到线程A unlock M之前的操作, 可以得到i=1,j=1, 如果在线程B unlock M之后, 线程A才进入lock M, 那么线程B就不一定能看到线程A中的操作, 因此j的值就不一定是1</p>
<h1 id="volatile同步机制"><a href="#volatile同步机制" class="headerlink" title="volatile同步机制"></a>volatile同步机制</h1><p>volatile 是一种稍弱的同步机制,在访问 volatile 变量时不会执行加锁操作,也就不会执行线程阻塞,因此 volatile 变量是一种比 synchronized 关键字更轻量级的同步机制,</p>
<blockquote>
<p>在两个或者更多的线程需要访问的成员变量上使用volatile, 当要访问的变量已在synchronized代码块中, 或者为常量时, 没必要使用volatile, 由于使用volatile屏蔽掉了JVM中必要的代码优化, 所以在效率上比较低, 因此一定在必要时才使用此关键字</p>
</blockquote>
<h1 id="实际现象"><a href="#实际现象" class="headerlink" title="实际现象"></a>实际现象</h1><p>对于非volatile修饰的变量, 尽管jvm的优化, 会导致变量的可见性问题, 但这种可见性的问题也只是在短时间内高并发的情况下发生, CPU执行时会很快刷新Cache, 一般的情况下很难出现, 而且出现这种问题是不可预测的, 与jvm、机器配置环境等都有关</p>
<h1 id="正确使用Volatile变量"><a href="#正确使用Volatile变量" class="headerlink" title="正确使用Volatile变量"></a>正确使用Volatile变量</h1><p>当且仅当满足以下所有条件时,才应该使用volatile变量：</p>
<ol>
<li>对变量的写入操作不依赖变量的当前值,或者你能确保只有单个线程更新变量的值</li>
<li>该变量没有包含在具有其他变量的不变式中</li>
</ol>
<p>关于正确使用Volatile请参考: <a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html">Java 理论与实践: 正确使用 Volatile 变量</a></p>
<hr>
<p>【参考文献】:</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/ns_code/article/details/17101369">【Java并发编程】之五：volatile变量修饰符—意料之外的问题（含代码） </a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/ns_code/article/details/17382679">【Java并发编程】之十八：第五篇中volatile意外问题的正确分析解答（含代码）</a></li>
<li>《深入Java虚拟机——JVM高级特性与最佳实践》</li>
<li><a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html">Java 理论与实践: 正确使用 Volatile 变量</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/skill/Image-zip-square-portrait/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/skill/Image-zip-square-portrait/" class="post-title-link" itemprop="url">Java图片处理一(压缩图片与生成微信头像)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-14 14:58:00" itemprop="dateCreated datePublished" datetime="2016-07-14T14:58:00+08:00">2016-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:19" itemprop="dateModified" datetime="2021-04-10T17:39:19+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="读入图片-本地图片和网络图片"><a href="#读入图片-本地图片和网络图片" class="headerlink" title="读入图片(本地图片和网络图片)"></a>读入图片(本地图片和网络图片)</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">InputStream <span class="title">readImageFromPath</span><span class="params">(String filePath)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (filePath.startsWith(<span class="string">&quot;http&quot;</span>)) &#123;</span><br><span class="line">            URL url = <span class="keyword">null</span>;</span><br><span class="line">            HttpURLConnection conn;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                url = <span class="keyword">new</span> URL(filePath);</span><br><span class="line">                conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">                conn.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">                conn.connect();</span><br><span class="line">                InputStream inputStream = conn.getInputStream();</span><br><span class="line">                <span class="keyword">return</span> inputStream;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(filePath));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BufferedImage bi = ImageIO.read(readImageFromPath(filePath));</span></span><br></pre></td></tr></table></figure>
<h1 id="压缩图像"><a href="#压缩图像" class="headerlink" title="压缩图像"></a>压缩图像</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 图片缩放</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> filePath</span></span><br><span class="line"><span class="comment"> *            图片路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> height</span></span><br><span class="line"><span class="comment"> *            高度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> width</span></span><br><span class="line"><span class="comment"> *            宽度</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bb</span></span><br><span class="line"><span class="comment"> *            比例不对时是否需要补白</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">BufferedImage <span class="title">resize2</span><span class="params">(String filePath, <span class="keyword">int</span> height, <span class="keyword">int</span> width, <span class="keyword">boolean</span> bb)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">double</span> ratio = <span class="number">0</span>; <span class="comment">// 缩放比例</span></span><br><span class="line">		BufferedImage bi = ImageIO.read(readImageFromPath(filePath));</span><br><span class="line">		Image itemp = bi.getScaledInstance(width, height,</span><br><span class="line">				Image.SCALE_SMOOTH);</span><br><span class="line">		<span class="comment">// 计算比例</span></span><br><span class="line">		<span class="keyword">if</span> ((bi.getHeight() &gt; height) || (bi.getWidth() &gt; width)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (bi.getHeight() &gt; bi.getWidth()) &#123;</span><br><span class="line">				ratio = (<span class="keyword">new</span> Integer(height)).doubleValue()</span><br><span class="line">						/ bi.getHeight();</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				ratio = (<span class="keyword">new</span> Integer(width)).doubleValue() / bi.getWidth();</span><br><span class="line">			&#125;</span><br><span class="line">			AffineTransformOp op = <span class="keyword">new</span> AffineTransformOp(</span><br><span class="line">					AffineTransform.getScaleInstance(ratio, ratio), <span class="keyword">null</span>);</span><br><span class="line">			itemp = op.filter(bi, <span class="keyword">null</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (bb) &#123;</span><br><span class="line">			BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height,</span><br><span class="line">					BufferedImage.TYPE_INT_RGB);</span><br><span class="line">			Graphics2D g = image.createGraphics();</span><br><span class="line">			g.setColor(Color.white);</span><br><span class="line">			g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">			<span class="keyword">if</span> (width == itemp.getWidth(<span class="keyword">null</span>))</span><br><span class="line">				g.drawImage(itemp, <span class="number">0</span>, (height - itemp.getHeight(<span class="keyword">null</span>)) / <span class="number">2</span>,</span><br><span class="line">						itemp.getWidth(<span class="keyword">null</span>), itemp.getHeight(<span class="keyword">null</span>),</span><br><span class="line">						Color.white, <span class="keyword">null</span>);</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				g.drawImage(itemp, (width - itemp.getWidth(<span class="keyword">null</span>)) / <span class="number">2</span>, <span class="number">0</span>,</span><br><span class="line">						itemp.getWidth(<span class="keyword">null</span>), itemp.getHeight(<span class="keyword">null</span>),</span><br><span class="line">						Color.white, <span class="keyword">null</span>);</span><br><span class="line">			g.dispose();</span><br><span class="line">			itemp = image;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (BufferedImage) itemp;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="生成微信头像"><a href="#生成微信头像" class="headerlink" title="生成微信头像"></a>生成微信头像</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageElement</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left;</span><br><span class="line">	<span class="keyword">int</span> top;</span><br><span class="line">	BufferedImage bufferedImage;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最多行列数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> MAX_GRIDS = <span class="number">3</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 行间距</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> spacing = <span class="number">5</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 边距</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> border = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 图片的目标大小</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> width = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">ImageCombinationUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成组合头像</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> paths</span></span><br><span class="line"><span class="comment"> *            用户图像</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCombinationOfhead</span><span class="params">(List&lt;String&gt; paths)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> pathSize = paths.size();</span><br><span class="line">	<span class="keyword">if</span> (pathSize == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">int</span> maxImageCount = MAX_GRIDS * MAX_GRIDS;</span><br><span class="line">	<span class="keyword">int</span> imageCount = pathSize &gt; maxImageCount ? maxImageCount : pathSize;</span><br><span class="line">	<span class="keyword">int</span> grids = (<span class="keyword">int</span>) Math.ceil(Math.sqrt(imageCount));</span><br><span class="line">	grids = grids &gt; MAX_GRIDS ? MAX_GRIDS : grids;</span><br><span class="line">	<span class="keyword">int</span> hrow = imageCount / grids;</span><br><span class="line">	<span class="keyword">int</span> rows = hrow + (imageCount - hrow * grids &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> columnCountOfLastRow = imageCount - (rows - <span class="number">1</span>) * grids;</span><br><span class="line">	<span class="keyword">int</span> columns = imageCount / rows;</span><br><span class="line">	columns = imageCount - columns * rows &gt; <span class="number">0</span> ? columns + <span class="number">1</span> : columns;</span><br><span class="line">	System.out.println(<span class="string">&quot;imageCount :&quot;</span> + pathSize + <span class="string">&quot;\t grids :&quot;</span> + grids</span><br><span class="line">			+ <span class="string">&quot;\trows:&quot;</span> + rows + <span class="string">&quot;\t columns:&quot;</span> + columns</span><br><span class="line">			+ <span class="string">&quot;\t columnsOfLastRow:&quot;</span> + columnCountOfLastRow);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span>[] matrix = <span class="keyword">new</span> <span class="keyword">int</span>[rows];</span><br><span class="line">	Arrays.fill(matrix, grids);</span><br><span class="line">	matrix[<span class="number">0</span>] = columnCountOfLastRow;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算每个图片的尺寸</span></span><br><span class="line">	<span class="keyword">int</span> imageMeasure = (width - <span class="number">2</span> * border - (grids - <span class="number">1</span>)</span><br><span class="line">			* spacing)</span><br><span class="line">			/ grids;</span><br><span class="line"></span><br><span class="line">	List&lt;ImageElement&gt; imageElements = <span class="keyword">new</span> ArrayList&lt;ImageElement&gt;();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; imageCount; i++) &#123;</span><br><span class="line">		ImageElement imageMatrix = <span class="keyword">new</span> ImageElement();</span><br><span class="line">		imageMatrix.bufferedImage = ImageCombinationUtil.resize2(paths.get(i),</span><br><span class="line">				imageMeasure, imageMeasure, <span class="keyword">true</span>);</span><br><span class="line">		imageElements.add(imageMatrix);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 计算坐标</span></span><br><span class="line">	<span class="keyword">int</span> top = border;</span><br><span class="line">	top = rows &lt; grids ? top + (spacing + imageMeasure) * (grids - rows)</span><br><span class="line">			/ <span class="number">2</span> : top;</span><br><span class="line">	<span class="keyword">int</span> imageIndex = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">0</span>; row &lt; matrix.length; row++) &#123;</span><br><span class="line">		<span class="keyword">int</span> column = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> left = border;</span><br><span class="line">		left = matrix[row] &lt; grids ? left + (spacing + imageMeasure)</span><br><span class="line">				* (grids - matrix[row])/<span class="number">2</span> : left;</span><br><span class="line">		<span class="keyword">while</span> (column &lt; matrix[row]) &#123;</span><br><span class="line">			imageElements.get(imageIndex).left = left + column</span><br><span class="line">					* (imageMeasure + spacing);</span><br><span class="line">			imageElements.get(imageIndex).top = top + row</span><br><span class="line">					* (imageMeasure + spacing);</span><br><span class="line">			imageIndex++;</span><br><span class="line">			column++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 创建画板</span></span><br><span class="line">	BufferedImage outImage1 = <span class="keyword">new</span> BufferedImage(width,</span><br><span class="line">			width, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">	<span class="comment">// 生成画布</span></span><br><span class="line">	Graphics g = outImage1.getGraphics();</span><br><span class="line">	Graphics2D g2d = (Graphics2D) g;</span><br><span class="line">	<span class="comment">// 设置背景色</span></span><br><span class="line">	g2d.setBackground(<span class="keyword">new</span> Color(<span class="number">231</span>, <span class="number">231</span>, <span class="number">231</span>));</span><br><span class="line">	<span class="comment">// 通过使用当前绘图表面的背景色进行填充来清除指定的矩形。</span></span><br><span class="line">	g2d.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, width);</span><br><span class="line">	<span class="comment">// 绘制</span></span><br><span class="line">	<span class="keyword">for</span> (ImageElement imageElement : imageElements) &#123;</span><br><span class="line">		g2d.drawImage(imageElement.bufferedImage, imageElement.left,</span><br><span class="line">				imageElement.top, <span class="keyword">null</span>);</span><br><span class="line">		<span class="comment">// 需要改变颜色的话在这里绘上颜色。可能会用到AlphaComposite类</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	String outPath = <span class="string">&quot;d:\\&quot;</span> + System.currentTimeMillis() + <span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">	String format = <span class="string">&quot;JPG&quot;</span>;</span><br><span class="line">	ImageIO.write(outImage1, format, <span class="keyword">new</span> File(outPath));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果</p>
<p><img src="/images/java/util/imageCombinResult.png"></p>
<h1 id="图像转化为InputStream"><a href="#图像转化为InputStream" class="headerlink" title="图像转化为InputStream"></a>图像转化为InputStream</h1><p>方便直接从内存上传到服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">InputStream <span class="title">image2InputStream</span><span class="params">(BufferedImage bufferedImage)</span> </span>&#123;</span><br><span class="line">	InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">	ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">	ImageOutputStream imageOutputStream = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		imageOutputStream = ImageIO.createImageOutputStream(outputStream);</span><br><span class="line">		ImageIO.write(bufferedImage, <span class="string">&quot;JPG&quot;</span>, imageOutputStream);</span><br><span class="line">		inputStream = <span class="keyword">new</span> ByteArrayInputStream(outputStream.toByteArray());</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> inputStream;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/network/uploadAndReceiveImages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/network/uploadAndReceiveImages/" class="post-title-link" itemprop="url">图片上传与接收</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-13 11:00:00" itemprop="dateCreated datePublished" datetime="2016-07-13T11:00:00+08:00">2016-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:20" itemprop="dateModified" datetime="2021-04-10T17:39:20+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="服务端接收图片"><a href="#服务端接收图片" class="headerlink" title="服务端接收图片"></a>服务端接收图片</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> excu;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest)request;</span><br><span class="line">    MultipartFile multipartFile = multipartRequest.getFile(CommonConstant.FORM_NAME);</span><br><span class="line">    LogUtil.trace(<span class="string">&quot;--&gt;上传图片=multipartFile:&quot;</span> + multipartFile);</span><br><span class="line"></span><br><span class="line">    String originalName = multipartFile.getOriginalFilename();</span><br><span class="line">    LogUtil.trace(<span class="string">&quot;--&gt;上传图片=originaName:&quot;</span> + originalName+<span class="string">&quot; multipartFileSize:&quot;</span> + multipartFile.getSize());</span><br><span class="line"></span><br><span class="line">    InputStream inputStream = multipartFile.getInputStream();</span><br><span class="line">    <span class="keyword">long</span> size = inputStream.available();</span><br><span class="line">    LogUtil.trace(<span class="string">&quot;--&gt;上传图片=file size:&quot;</span> + size);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> == size || size == -<span class="number">1</span> || <span class="keyword">null</span> == userId || <span class="string">&quot;&quot;</span>.equals(userId)) &#123;</span><br><span class="line">        excu = <span class="keyword">false</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        excu = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(excu) &#123;</span><br><span class="line">        originalName = System.currentTimeMillis() + <span class="string">&quot;&quot;</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">100</span>)</span><br><span class="line">                + originalName.substring(originalName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="keyword">boolean</span> isUploadSuccess = QiniuUploadUtil.uploadFileToQiniu(“userImgBucketName”, originalName,</span><br><span class="line">                inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(isUploadSuccess) &#123;</span><br><span class="line">            String imageUrl = “userImgURL” + originalName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/skill/pinyin4j/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/skill/pinyin4j/" class="post-title-link" itemprop="url">pinyin4j</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-13 08:58:00" itemprop="dateCreated datePublished" datetime="2016-07-13T08:58:00+08:00">2016-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:19" itemprop="dateModified" datetime="2021-04-10T17:39:19+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">String <span class="title">cn2Spell</span><span class="params">(String chinese)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (chinese == <span class="keyword">null</span> || chinese.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        StringBuffer pybf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">char</span>[] arr = chinese.toCharArray();</span><br><span class="line">        HanyuPinyinOutputFormat defaultFormat = <span class="keyword">new</span> HanyuPinyinOutputFormat();</span><br><span class="line">        defaultFormat.setCaseType(HanyuPinyinCaseType.LOWERCASE);</span><br><span class="line">        defaultFormat.setToneType(HanyuPinyinToneType.WITHOUT_TONE);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] &gt; <span class="number">128</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    String[] str = PinyinHelper.toHanyuPinyinStringArray(</span><br><span class="line">                            arr[i], defaultFormat);</span><br><span class="line">                    <span class="keyword">if</span> (str == <span class="keyword">null</span> || str.length == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    pybf.append(PinyinHelper.toHanyuPinyinStringArray(</span><br><span class="line">                            arr[i], defaultFormat)[<span class="number">0</span>]);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BadHanyuPinyinOutputFormatCombination e) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                pybf.append(arr[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pybf.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/network/push/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/network/push/" class="post-title-link" itemprop="url">消息推送</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-12 16:02:00" itemprop="dateCreated datePublished" datetime="2016-07-12T16:02:00+08:00">2016-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:20" itemprop="dateModified" datetime="2021-04-10T17:39:20+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="推送服务"><a href="#推送服务" class="headerlink" title="推送服务"></a>推送服务</h1><p>维护任何一个长连接都需要心跳机制，客户端发送一个心跳给服务器，服务器给客户端一个心跳应答，这样就形成客户端服务器的一次完整的握手，这个握手是让双方都知道他们之间的连接是没有断开，客户端是在线的。如果超过一个时间的阈值，客户端没有收到服务器的应答，或者服务器没有收到客户端的心跳，那么对客户端来说则断开与服务器的连接重新建立一个连接，对服务器来说只要断开这个连接即可。那么在智能手机上的长连接心跳和在Internet上的长连接心跳有什么不同的目的呢？原因就在于智能手机使用的是移动无线网络，那么我们在讲长连接之前我们首先要了解无线移动网络的特点。<br>由于大部分的移动无线网络运营商为了减少网关NAT映射表的负荷，如果一个链路有一段时间没有通信时就会删除其对应表，造成链路中断，正是这种刻意缩短空闲连接的释放超时，原本是想节省信道资源的作用，没想到让互联网的应用不得以远高于正常频率发送心跳来维护推送的长连接。这也是为什么会有之前的信令风暴，微信摇收费的传言，因为这类的应用发送心跳的频率是很短的，既造成了信道资源的浪费，也造成了手机电量的快速消耗。</p>
<p>推送的实现方式：</p>
<ol>
<li>客户端不断的查询服务器，检索新内容，也就是所谓的pull 或者轮询方式</li>
<li>客户端和服务器之间维持一个TCP/IP长连接，服务器向客户端push</li>
<li>服务器又新内容时，发送一条类似短信的信令给客户端，客户端收到后从服务器中下载新内容，也就是SMS的推送方式。</li>
</ol>
<p>苹果的推送系统和googleC2DM推送系统其实都是在系统级别维护一个TCP/IP长连接，都是基于第二种的方式进行推送的。第三种方式由于运营商没有免费开放这种信令导致了这种推送在成本上是无法接受的，虽然这种推送的方式非常的稳定，高效和及时。</p>
<h1 id="IOS推送"><a href="#IOS推送" class="headerlink" title="IOS推送"></a>IOS推送</h1><p>首先第一步当然是介绍一下苹果的推送机制(APNS)咯（ps:其实每一篇教程都有），先来看一张苹果官方对其推送做出解释的概要图。<br><img src="/images/network/push/APNS-process.png"></p>
<p>Provider是给你手机应用发出推送消息的服务器，而APNS（Apple Push Notification Service）则是苹果消息推送服务器。<br>你本地的服务器当需要给应用推送一条消息的时候，先要将消息发出到苹果推送服务器，然后再由苹果推送服务器将消息发到安装了该应用的手机。</p>
<p>接下来再看一张解释图：<br><img src="/images/network/push/APNS-process-detail.png"></p>
<p>根据上图的逻辑我来给大家解释一下：</p>
<ol>
<li>你的IOS应用需要去注册APNS消息推送功能。</li>
<li>当苹果APNS推送服收到来自你应用的注册消息就会返回一串device token给你（很重要）</li>
<li>将应用收到的device Token传给你本地的Push服务器。</li>
<li>当你需要为应用推送消息的时候，你本地的推送服务器会将消息，以及Device Token打包发送到苹果的APNS服</li>
<li>APNS再将消息推送给目的iphone</li>
</ol>
<p>   IOS长连接是由系统来维护的，也就是说苹果的IOS系统在系统级别维护了一个客户端和苹果服务器的长链接，IOS上的所有应用上的推送都是先将消息推送到苹果的服务器然后将苹果服务器通过这个系统级别的长链接推送到手机终端上，这样的的几个好处为：1.在手机终端始终只要维护一个长连接即可，而且由于这个长链接是系统级别的不会出现被杀死而无法推送的情况。2.省电，不会出现每个应用都各自维护一个自己的长连接。3.安全，只有在苹果注册的开发者才能够进行推送，等等。</p>
<h1 id="Android推送"><a href="#Android推送" class="headerlink" title="Android推送"></a>Android推送</h1><p>android的长连接是由每个应用各自维护的，但是google也推出了和苹果技术架构相似的推送框架，C2DM,云端推送功能，但是由于google<br>的服务器不在中国境内，其他的原因你懂的。所以导致这个推送无法使用，android的开发者不得不自己去维护一个长链接，于是每个应用如果都24小时在<br>线，那么都得各自维护一个长连接，这种电量和流量的消耗是可想而知的。虽然国内也出现了各种推送平台，但是都无法达到只维护一个长连接这种消耗的级别。</p>
<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/array/" class="post-title-link" itemprop="url">Java数组</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-06-09 12:26:00" itemprop="dateCreated datePublished" datetime="2016-06-09T12:26:00+08:00">2016-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:19" itemprop="dateModified" datetime="2021-04-10T17:39:19+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-声明一个数组"><a href="#1-声明一个数组" class="headerlink" title="1.  声明一个数组"></a>1.  声明一个数组</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String[] aArray = <span class="keyword">new</span> String[<span class="number">5</span>];  </span><br><span class="line">String[] bArray = &#123;<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>&#125;;  </span><br><span class="line">String[] cArray = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>&#125;;  </span><br></pre></td></tr></table></figure>
<h1 id="2-输出一个数组"><a href="#2-输出一个数组" class="headerlink" title="2.  输出一个数组"></a>2.  输出一个数组</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] intArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </span><br><span class="line">String intArrayString = Arrays.toString(intArray);  </span><br><span class="line"><span class="comment">// print directly will print reference value  </span></span><br><span class="line">System.out.println(intArray);  </span><br><span class="line"><span class="comment">// [I@7150bd4d  </span></span><br><span class="line">System.out.println(intArrayString);  </span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5]  </span></span><br></pre></td></tr></table></figure>
<h1 id="3-从一个数组创建数组列表"><a href="#3-从一个数组创建数组列表" class="headerlink" title="3.  从一个数组创建数组列表"></a>3.  从一个数组创建数组列表</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] stringArray = &#123; <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span> &#125;;  </span><br><span class="line">ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;String&gt;(Arrays.asList(stringArray));  </span><br><span class="line">System.out.println(arrayList);  </span><br><span class="line"><span class="comment">// [a, b, c, d, e]  </span></span><br></pre></td></tr></table></figure>
<h1 id="4-检查一个数组是否包含某个值"><a href="#4-检查一个数组是否包含某个值" class="headerlink" title="4.  检查一个数组是否包含某个值"></a>4.  检查一个数组是否包含某个值</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] stringArray = &#123; <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span> &#125;;  </span><br><span class="line"><span class="keyword">boolean</span> b = Arrays.asList(stringArray).contains(<span class="string">&quot;a&quot;</span>);  </span><br><span class="line">System.out.println(b);  </span><br><span class="line"><span class="comment">// true  </span></span><br></pre></td></tr></table></figure>
<h1 id="5-连接两个数组"><a href="#5-连接两个数组" class="headerlink" title="5.  连接两个数组"></a>5.  连接两个数组</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] intArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </span><br><span class="line"><span class="keyword">int</span>[] intArray2 = &#123; <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span> &#125;;  </span><br><span class="line"><span class="comment">// Apache Commons Lang library  </span></span><br><span class="line"><span class="keyword">int</span>[] combinedIntArray = ArrayUtils.addAll(intArray, intArray2);  </span><br></pre></td></tr></table></figure>
<h1 id="6-声明一个内联数组（Array-inline）"><a href="#6-声明一个内联数组（Array-inline）" class="headerlink" title="6.  声明一个内联数组（Array inline）"></a>6.  声明一个内联数组（Array inline）</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">method(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>&#125;);  </span><br></pre></td></tr></table></figure>
<h1 id="7-把提供的数组元素放入一个字符串"><a href="#7-把提供的数组元素放入一个字符串" class="headerlink" title="7.  把提供的数组元素放入一个字符串"></a>7.  把提供的数组元素放入一个字符串</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// containing the provided list of elements  </span></span><br><span class="line"><span class="comment">// Apache common lang  </span></span><br><span class="line">String j = StringUtils.join(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span> &#125;, <span class="string">&quot;, &quot;</span>);  </span><br><span class="line">System.out.println(j);  </span><br><span class="line"><span class="comment">// a, b, c  </span></span><br></pre></td></tr></table></figure>
<h1 id="8-将一个数组列表转换为数组"><a href="#8-将一个数组列表转换为数组" class="headerlink" title="8.  将一个数组列表转换为数组"></a>8.  将一个数组列表转换为数组</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String[] stringArray = &#123; <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span> &#125;;  </span><br><span class="line">ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;String&gt;(Arrays.asList(stringArray));  </span><br><span class="line">String[] stringArr = <span class="keyword">new</span> String[arrayList.size()];  </span><br><span class="line">arrayList.toArray(stringArr);  </span><br><span class="line"><span class="keyword">for</span> (String s : stringArr)  </span><br><span class="line">    System.out.println(s);  </span><br></pre></td></tr></table></figure>
<h1 id="9-将一个数组转换为集（set）"><a href="#9-将一个数组转换为集（set）" class="headerlink" title="9.  将一个数组转换为集（set）"></a>9.  将一个数组转换为集（set）</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;String&gt;(Arrays.asList(stringArray));  </span><br><span class="line">System.out.println(set);  </span><br><span class="line"><span class="comment">//[d, e, b, c, a]  </span></span><br></pre></td></tr></table></figure>
<h1 id="10-逆向一个数组"><a href="#10-逆向一个数组" class="headerlink" title="10.  逆向一个数组"></a>10.  逆向一个数组</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] intArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </span><br><span class="line">ArrayUtils.reverse(intArray);  </span><br><span class="line">System.out.println(Arrays.toString(intArray));  </span><br><span class="line"><span class="comment">//[5, 4, 3, 2, 1]  </span></span><br></pre></td></tr></table></figure>
<h1 id="11-移除数组中的元素"><a href="#11-移除数组中的元素" class="headerlink" title="11.  移除数组中的元素"></a>11.  移除数组中的元素</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] intArray = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;  </span><br><span class="line"><span class="keyword">int</span>[] removed = ArrayUtils.removeElement(intArray, <span class="number">3</span>);<span class="comment">//create a new array  </span></span><br><span class="line">System.out.println(Arrays.toString(removed));  </span><br></pre></td></tr></table></figure>
<h1 id="12-将整数转换为字节数组"><a href="#12-将整数转换为字节数组" class="headerlink" title="12.  将整数转换为字节数组"></a>12.  将整数转换为字节数组</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] bytes = ByteBuffer.allocate(<span class="number">4</span>).putInt(<span class="number">8</span>).array();  </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">byte</span> t : bytes) &#123;  </span><br><span class="line">   System.out.format(<span class="string">&quot;0x%x &quot;</span>, t);  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/multithread/06.BlockingQueue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/multithread/06.BlockingQueue/" class="post-title-link" itemprop="url">Java多线程6: Java阻塞队列</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-05-31 00:00:00" itemprop="dateCreated datePublished" datetime="2016-05-31T00:00:00+08:00">2016-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:20" itemprop="dateModified" datetime="2021-04-10T17:39:20+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="/Java/advanced-engineer-outline/">&lt;Java高级软件工程师知识结构</a></p>
<blockquote>
<p>   Java多线程是Java基础的重要的一部分，支持多线程是Java的重要特性之一. 主要包括如下内容:</p>
<ol>
<li><a href="/Java/multithread/01.base/">Java多线程1: 线程生命周期和多线程基础</a></li>
<li><a href="/Java/multithread/02.Lock-Semaphore-Atomic/">Java多线程2: Lock、信号量、原子量与队列</a></li>
<li><a href="/Java/multithread/03.volatile/">Java多线程3: volatile</a></li>
<li><a href="/Java/multithread/04.thread-synchronization/">Java多线程4: 同步锁与Java线程同步方法比较</a></li>
<li><a href="/Java/multithread/05.ThreadPool/">Java多线程5: 线程池</a></li>
<li><a href="/Java/multithread/06.BlockingQueue/">Java多线程6: Java阻塞队列与生产者消费者模式</a></li>
</ol>
</blockquote>
<hr>
<h1 id="阻塞队列与阻塞栈"><a href="#阻塞队列与阻塞栈" class="headerlink" title="阻塞队列与阻塞栈"></a>阻塞队列与阻塞栈</h1><p><img src="images/20191201214259668_108772893.png"></p>
<p>Java定义了阻塞队列的接口<code>java.util.concurrent.BlockingQueue</code>,<br>阻塞队列的概念是, 一个指定长度的队列, 如果队列满了, 添加新元素的操作会被阻塞等待, 直到有空位为止. 同样, 当队列为空时候, 请求队列元素的操作同样会阻塞等待, 直到有可用元素为止.<br>阻塞队列还有更多实现类, 用来满足各种复杂的需求：<code>ArrayBlockingQueue</code>, <code>DelayQueue</code>, <code>LinkedBlockingQueue</code>, <code>PriorityBlockingQueue</code>, <code>SynchronousQueue</code> , 具体的API差别也很小.</p>
<p>对于阻塞栈, 与阻塞队列相似. 不同点在于栈是<code>“后入先出”</code>的结构, 每次操作的是栈顶, 而队列是“先进先出”的结构, 每次操作的是队列头.<br>Java为阻塞栈定义了接口：<code>java.util.concurrent.BlockingDeque</code></p>
<h1 id="1、核心方法"><a href="#1、核心方法" class="headerlink" title="1、核心方法"></a>1、核心方法</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlockingQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将给定元素设置到队列中，如果设置成功返回true, 否则返回false。如果是往限定了长度的队列中设置值，推荐使用offer()方法。</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将给定的元素设置到队列中，如果设置成功返回true, 否则返回false. e的值不能为空，否则抛出空指针异常。</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将元素设置到队列中，如果队列中没有多余的空间，该方法会一直阻塞，直到队列中有多余的空间。</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将给定元素在给定的时间内设置到队列中，如果设置成功返回true, 否则返回false.</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e, <span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从队列中获取值，如果队列中没有值，线程会一直阻塞，直到队列中有值，并且该方法取得了该值。</span></span><br><span class="line">    <span class="function">E <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在给定的时间里，从队列中获取值，时间到了直接调用普通的poll方法，为null则直接返回null。</span></span><br><span class="line">    <span class="function">E <span class="title">poll</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取队列中剩余的空间。</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">remainingCapacity</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从队列中移除指定的值。</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断队列中是否拥有该值。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将队列中值，全部移除，并发设置到给定的集合中。</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">drainTo</span><span class="params">(Collection&lt;? <span class="keyword">super</span> E&gt; c)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//指定最多数量限制将队列中值，全部移除，并发设置到给定的集合中。</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">drainTo</span><span class="params">(Collection&lt;? <span class="keyword">super</span> E&gt; c, <span class="keyword">int</span> maxElements)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="2、阻塞队列的成员"><a href="#2、阻塞队列的成员" class="headerlink" title="2、阻塞队列的成员"></a>2、阻塞队列的成员</h1><p>方法\处理方式 抛出异常 返回特殊值 一直阻塞 超时退出</p>
<p>插入方法 add(e) offer(e) put(e) offer(e,time,unit)</p>
<p>移除方法 remove() poll() take() poll(time,unit)</p>
<p>检查方法 element() peek() 不可用 不可用</p>
<p><img src="images/20191201214440080_637429054.png"></p>
<h1 id="3、成员详解"><a href="#3、成员详解" class="headerlink" title="3、成员详解"></a>3、成员详解</h1><h2 id="ArrayBlockingQueue"><a href="#ArrayBlockingQueue" class="headerlink" title="ArrayBlockingQueue"></a>ArrayBlockingQueue</h2><pre><code>   基于数组的阻塞队列实现，在ArrayBlockingQueue内部，维护了一个定长数组，以便缓存队列中的数据对象，这是一个常用的阻塞队列，除了一个定长数组外，ArrayBlockingQueue内部还保存着两个整形变量，分别标识着队列的头部和尾部在数组中的位置。  </code></pre>
<p>　　ArrayBlockingQueue在生产者放入数据和消费者获取数据，都是共用同一个锁对象，由此也意味着两者无法真正并行运行，这点尤其不同于LinkedBlockingQueue；按照实现原理来分析，ArrayBlockingQueue完全可以采用分离锁，从而实现生产者和消费者操作的完全并行运行。Doug Lea之所以没这样去做，也许是因为ArrayBlockingQueue的数据写入和获取操作已经足够轻巧，以至于引入独立的锁机制，除了给代码带来额外的复杂性外，其在性能上完全占不到任何便宜。 ArrayBlockingQueue和LinkedBlockingQueue间还有一个明显的不同之处在于，前者在插入或删除元素时不会产生或销毁任何额外的对象实例，而后者则会生成一个额外的Node对象。这在长时间内需要高效并发地处理大批量数据的系统中，其对于GC的影响还是存在一定的区别。而在创建ArrayBlockingQueue时，我们还可以控制对象的内部锁是否采用公平锁，默认采用非公平锁。</p>
<h2 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h2><pre><code>   基于链表的阻塞队列，同ArrayListBlockingQueue类似，其内部也维持着一个数据缓冲队列（该队列由一个链表构成），当生产者往队列中放入一个数据时，队列会从生产者手中获取数据，并缓存在队列内部，而生产者立即返回；只有当队列缓冲区达到最大值缓存容量时（LinkedBlockingQueue可以通过构造函数指定该值），才会阻塞生产者队列，直到消费者从队列中消费掉一份数据，生产者线程会被唤醒，反之对于消费者这端的处理也基于同样的原理。而LinkedBlockingQueue之所以能够高效的处理并发数据，还因为其对于生产者端和消费者端分别采用了独立的锁来控制数据同步，这也意味着在高并发的情况下生产者和消费者可以并行地操作队列中的数据，以此来提高整个队列的并发性能。  </code></pre>
<p>作为开发者，我们需要注意的是，如果构造一个LinkedBlockingQueue对象，而没有指定其容量大小，LinkedBlockingQueue会默认一个类似无限大小的容量（Integer.MAX_VALUE），这样的话，如果生产者的速度一旦大于消费者的速度，也许还没有等到队列满阻塞产生，系统内存就有可能已被消耗殆尽了。</p>
<h2 id="DelayQueue"><a href="#DelayQueue" class="headerlink" title="DelayQueue"></a>DelayQueue</h2><pre><code>   DelayQueue中的元素只有当其指定的延迟时间到了，才能够从队列中获取到该元素。DelayQueue是一个没有大小限制的队列，因此往队列中插入数据的操作（生产者）永远不会被阻塞，而只有获取数据的操作（消费者）才会被阻塞。  </code></pre>
<p>使用场景：<br>       DelayQueue使用场景较少，但都相当巧妙，常见的例子比如使用一个DelayQueue来管理一个超时未响应的连接队列。</p>
<h2 id="PriorityBlockingQueue"><a href="#PriorityBlockingQueue" class="headerlink" title="PriorityBlockingQueue"></a>PriorityBlockingQueue</h2><pre><code>   基于优先级的阻塞队列（优先级的判断通过构造函数传入的Compator对象来决定），但需要注意的是PriorityBlockingQueue并不会阻塞数据生产者，而只会在没有可消费的数据时，阻塞数据的消费者。因此使用的时候要特别注意，生产者生产数据的速度绝对不能快于消费者消费数据的速度，否则时间一长，会最终耗尽所有的可用堆内存空间。在实现PriorityBlockingQueue时，内部控制线程同步的锁采用的是公平锁。</code></pre>
<h2 id="SynchronousQueue"><a href="#SynchronousQueue" class="headerlink" title="SynchronousQueue"></a>SynchronousQueue</h2><pre><code>   一种无缓冲的等待队列，类似于无中介的直接交易，有点像原始社会中的生产者和消费者，生产者拿着产品去集市销售给产品的最终消费者，而消费者必须亲自去集市找到所要商品的直接生产者，如果一方没有找到合适的目标，那么对不起，大家都在集市等待。相对于有缓冲的BlockingQueue来说，少了一个中间经销商的环节（缓冲区），如果有经销商，生产者直接把产品批发给经销商，而无需在意经销商最终会将这些产品卖给那些消费者，由于经销商可以库存一部分商品，因此相对于直接交易模式，总体来说采用中间经销商的模式会吞吐量高一些（可以批量买卖）；但另一方面，又因为经销商的引入，使得产品从生产者到消费者中间增加了额外的交易环节，单个产品的及时响应性能可能会降低。  </code></pre>
<p>　　声明一个SynchronousQueue有两种不同的方式，它们之间有着不太一样的行为。公平模式和非公平模式的区别:<br>　　如果采用公平模式：SynchronousQueue会采用公平锁，并配合一个FIFO队列来阻塞多余的生产者和消费者，从而体系整体的公平策略；<br>　　但如果是非公平模式（SynchronousQueue默认）：SynchronousQueue采用非公平锁，同时配合一个LIFO队列来管理多余的生产者和消费者，而后一种模式，如果生产者和消费者的处理速度有差距，则很容易出现饥渴的情况，即可能有某些生产者或者是消费者的数据永远都得不到处理。</p>
<h1 id="4、秒杀demo"><a href="#4、秒杀demo" class="headerlink" title="4、秒杀demo"></a>4、秒杀demo</h1><h2 id="秒杀对列"><a href="#秒杀对列" class="headerlink" title="秒杀对列"></a>秒杀对列</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hsshy.beam.queue.jvm;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hsshy.beam.queue.entity.SuccessKilled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 秒杀队列(固定长度为100)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 科帮网 By https://blog.52itstyle.com</span></span><br><span class="line"><span class="comment"> * 创建时间   2018年5月10日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeckillQueue</span> </span>&#123;</span><br><span class="line">     <span class="comment">//队列大小</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> QUEUE_MAX_SIZE   = <span class="number">100</span>;</span><br><span class="line">    <span class="comment">/** 用于多线程间下单的队列 */</span></span><br><span class="line">    <span class="keyword">static</span> BlockingQueue&lt;SuccessKilled&gt; blockingQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;SuccessKilled&gt;(QUEUE_MAX_SIZE);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 私有的默认构造子，保证外界无法直接实例化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SeckillQueue</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类级的内部类，也就是静态的成员式内部类，该内部类的实例与外部类的实例</span></span><br><span class="line"><span class="comment">     * 没有绑定关系，而且只有被调用到才会装载，从而实现了延迟加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 静态初始化器，由JVM来保证线程安全</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span>  <span class="keyword">static</span> SeckillQueue queue = <span class="keyword">new</span> SeckillQueue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//单例队列</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SeckillQueue <span class="title">getMailQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.queue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产入队</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> kill</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     * add(e) 队列未满时，返回true；队列满则抛出IllegalStateException(“Queue full”)异常——AbstractQueue </span></span><br><span class="line"><span class="comment">     * put(e) 队列未满时，直接插入没有返回值；队列满时会阻塞等待，一直等到队列未满时再插入。</span></span><br><span class="line"><span class="comment">     * offer(e) 队列未满时，返回true；队列满时返回false。非阻塞立即返回。</span></span><br><span class="line"><span class="comment">     * offer(e, time, unit) 设定等待的时间，如果在指定时间内还不能往队列中插入数据则返回false，插入成功返回true。 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  Boolean  <span class="title">produce</span><span class="params">(SuccessKilled kill)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> blockingQueue.offer(kill);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消费出队</span></span><br><span class="line"><span class="comment">     * poll() 获取并移除队首元素，在指定的时间内去轮询队列看有没有首元素有则返回，否者超时后返回null</span></span><br><span class="line"><span class="comment">     * take() 与带超时时间的poll类似不同在于take时候如果当前队列空了它会一直等待其他线程调用notEmpty.signal()才会被唤醒</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  SuccessKilled <span class="title">consume</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> blockingQueue.take();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取队列大小</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> blockingQueue.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="springboot启动时执行类"><a href="#springboot启动时执行类" class="headerlink" title="springboot启动时执行类"></a>springboot启动时执行类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hsshy.beam.queue.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hsshy.beam.queue.entity.SuccessKilled;</span><br><span class="line"><span class="keyword">import</span> com.hsshy.beam.queue.service.ISeckillService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationArguments;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消费秒杀队列</span></span><br><span class="line"><span class="comment"> * 创建者 科帮网</span></span><br><span class="line"><span class="comment"> * 创建时间 2018年4月3日</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISeckillService seckillService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments <span class="keyword">var</span>)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="comment">//进程内队列</span></span><br><span class="line">            SuccessKilled kill = SeckillQueue.getMailQueue().consume();</span><br><span class="line">            <span class="keyword">if</span>(kill!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                seckillService.startSeckil(kill.getId(), kill.getUserId());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="controller层"><a href="#controller层" class="headerlink" title="controller层"></a>controller层</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value=&quot;秒杀柒(进程内队列)&quot;,nickname=&quot;科帮网&quot;)</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/startQueue&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> R <span class="title">startQueue</span><span class="params">(<span class="keyword">long</span> seckillId)</span></span>&#123;</span><br><span class="line">       seckillService.deleteSeckill(seckillId);</span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">long</span> killId =  seckillId;</span><br><span class="line">       LOGGER.info(<span class="string">&quot;开始秒杀柒(正常)&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++)&#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">long</span> userId = i;</span><br><span class="line">           Runnable task = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">               <span class="meta">@Override</span></span><br><span class="line">               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                   SuccessKilled kill = <span class="keyword">new</span> SuccessKilled();</span><br><span class="line">                   kill.setId(killId);</span><br><span class="line">                   kill.setUserId(userId);</span><br><span class="line">                   <span class="keyword">try</span> &#123;</span><br><span class="line">                       Boolean flag = SeckillQueue.getMailQueue().produce(kill);</span><br><span class="line">                       <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                           LOGGER.info(<span class="string">&quot;用户:&#123;&#125;&#123;&#125;&quot;</span>,kill.getUserId(),<span class="string">&quot;秒杀成功&quot;</span>);</span><br><span class="line">                       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                           LOGGER.info(<span class="string">&quot;用户:&#123;&#125;&#123;&#125;&quot;</span>,userId,<span class="string">&quot;秒杀失败&quot;</span>);</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                       e.printStackTrace();</span><br><span class="line">                       LOGGER.info(<span class="string">&quot;用户:&#123;&#125;&#123;&#125;&quot;</span>,userId,<span class="string">&quot;秒杀失败&quot;</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;;</span><br><span class="line">           executor.execute(task);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">           Long  seckillCount = seckillService.getSeckillCount(seckillId);</span><br><span class="line">           LOGGER.info(<span class="string">&quot;一共秒杀出&#123;&#125;件商品&quot;</span>,seckillCount);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> R.ok();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="5、延时队列demo"><a href="#5、延时队列demo" class="headerlink" title="5、延时队列demo"></a>5、延时队列demo</h1><h2 id="消息体"><a href="#消息体" class="headerlink" title="消息体"></a>消息体</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hsshy.beam.queue.delay;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Delayed;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 消息体定义 实现Delayed接口就是实现两个方法即compareTo 和 getDelay最重要的就是getDelay方法，这个方法用来判断是否到期…… </span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">implements</span> <span class="title">Delayed</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;  </span><br><span class="line">    <span class="keyword">private</span> String body; <span class="comment">// 消息内容  </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> excuteTime;<span class="comment">// 延迟时长，这个是必须的属性因为要按照这个判断延时时长。  </span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> id;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBody</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> body;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExcuteTime</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> excuteTime;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Message</span><span class="params">(<span class="keyword">int</span> id, String body, <span class="keyword">long</span> delayTime)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.id = id;  </span><br><span class="line">        <span class="keyword">this</span>.body = body;  </span><br><span class="line">        <span class="keyword">this</span>.excuteTime = TimeUnit.NANOSECONDS.convert(delayTime, TimeUnit.MILLISECONDS) + System.nanoTime();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 自定义实现比较方法返回 1 0 -1三个参数  </span></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed delayed)</span> </span>&#123;  </span><br><span class="line">        Message msg = (Message) delayed;  </span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(<span class="keyword">this</span>.id) &gt; Integer.valueOf(msg.id) ? <span class="number">1</span>  </span><br><span class="line">                : (Integer.valueOf(<span class="keyword">this</span>.id) &lt; Integer.valueOf(msg.id) ? -<span class="number">1</span> : <span class="number">0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 延迟任务是否到时就是按照这个方法判断如果返回的是负数则说明到期否则还没到期  </span></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> unit.convert(<span class="keyword">this</span>.excuteTime - System.nanoTime(), TimeUnit.NANOSECONDS);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hsshy.beam.queue.delay;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.DelayQueue;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;  </span><br><span class="line">    <span class="comment">// 延时队列 ,消费者从其中获取消息进行消费  </span></span><br><span class="line">    <span class="keyword">private</span> DelayQueue&lt;Message&gt; queue;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(DelayQueue&lt;Message&gt; queue)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.queue = queue;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                Message take = queue.take();  </span><br><span class="line">                System.out.println(<span class="string">&quot;消费消息id：&quot;</span> + take.getId() + <span class="string">&quot; 消息体：&quot;</span> + take.getBody());  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;  </span><br><span class="line">                e.printStackTrace();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hsshy.beam.queue.delay;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.DelayQueue;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayQueueTest</span> </span>&#123;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;    </span><br><span class="line">            <span class="comment">// 创建延时队列    </span></span><br><span class="line">            DelayQueue&lt;Message&gt; queue = <span class="keyword">new</span> DelayQueue&lt;Message&gt;();    </span><br><span class="line">            <span class="comment">// 添加延时消息,m1 延时3s    </span></span><br><span class="line">            Message m1 = <span class="keyword">new</span> Message(<span class="number">1</span>, <span class="string">&quot;world&quot;</span>, <span class="number">3000</span>);    </span><br><span class="line">            <span class="comment">// 添加延时消息,m2 延时10s    </span></span><br><span class="line">            Message m2 = <span class="keyword">new</span> Message(<span class="number">2</span>, <span class="string">&quot;hello&quot;</span>, <span class="number">10000</span>);    </span><br><span class="line">            <span class="comment">//将延时消息放到延时队列中  </span></span><br><span class="line">            queue.offer(m2);    </span><br><span class="line">            queue.offer(m1);    </span><br><span class="line">            <span class="comment">// 启动消费线程 消费添加到延时队列中的消息，前提是任务到了延期时间   </span></span><br><span class="line">            ExecutorService exec = Executors.newFixedThreadPool(<span class="number">1</span>);  </span><br><span class="line">            exec.execute(<span class="keyword">new</span> Consumer(queue));  </span><br><span class="line">            exec.shutdown();  </span><br><span class="line">        &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>【参考文献】：</p>
<p><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.cnblogs.com/KingIceMou/p/8075343.html">https://www.cnblogs.com/KingIceMou/p/8075343.html</a><br><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=http://www.cnblogs.com/WangHaiMing/p/8798709.html">http://www.cnblogs.com/WangHaiMing/p/8798709.html</a><br><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://gitee.com/52itstyle/spring-boot-seckill">https://gitee.com/52itstyle/spring-boot-seckill</a></p>
<p><a target="_blank" rel="noopener" href="http://wsmajunfeng.iteye.com/blog/1629354">BlockingQueue（阻塞队列）详解</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ed2b56bcba3d">ArrayBlockingQueue源码解析</a></p>
<p><a target="_blank" rel="noopener" href="http://ifeve.com/java-blocking-queue/">Java中的阻塞队列</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/database/Redis/base/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/database/Redis/base/" class="post-title-link" itemprop="url">Redis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-05-25 11:28:00" itemprop="dateCreated datePublished" datetime="2016-05-25T11:28:00+08:00">2016-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:20" itemprop="dateModified" datetime="2021-04-10T17:39:20+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h1><p>一致哈希</p>
<p>构建一个存储数据集群的关键是有一个有效的数据存储和复制机制。我希望<font color="#FF0000">通过一个行之有效的方法来说明建造一个数据集群，在这个过程中你可以随意添加或移除一个Redis节点，同时保证你的数据仍然存在，而不会消失。这个方法称为一致哈希</font></p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><ul>
<li>String：缓存、限流、计数器、分布式锁、分布式Session</li>
<li>Hash：存储用户信息、用户主页访问量、组合查询</li>
<li>List：微博关注人时间轴列表、简单队列</li>
<li>Set：赞、踩、标签、好友关系</li>
<li>Zset：排行榜</li>
</ul>
<p>IO多路复用</p>
<p>I/O多路复用技术，是为了解决进程或线程阻塞到某个I/O系统调用而出现的技术，可以监视多个描述符，一旦某个描述符就绪（一般是读就绪或者写就绪，就是这个文件描述符进行读写操作之前），能够通知程序进行相应的读写操作。</p>
<p>在Redis中一个字符串最大的容量为512MB</p>
<p>对于Hash结构存储，由于Hash结构会在单个Hash元素在不足一定数量时进行压缩存储，所以可以大量节约内存。这一点在String结构里是不存在的。</p>
<p><strong>数据一致性</strong></p>
<p>真正意义上来讲数据库的数据和缓存的数据是不可能一致的，数据分为最终一致和强一致两类。如果业务中对数据的要求必须强一致那么就不能使用缓存。缓存能做的只能保证数据的最终一致性。</p>
<p>我们能做的只能是尽可能地保证数据的一致性。不管是先删库再删缓存还是先删缓存再删库，都可能出现数据不一致的情况，因为读和写操作是并发的，</p>
<p><strong>Redis的过期和内存淘汰</strong></p>
<p>Redis存储数据时我们可以设置他的过期时间。</p>
<p>Redis过期删除采用的是定期删除，默认是每100ms检测一次，遇到过期的Key则进行删除，这里的检测并不是顺序检测，而是随机检测。</p>
<p>那这样会不会有漏网之鱼？显然Redis也考虑到了这一点，当我们去读/写一个已经过期的Key时，会触发Redis的惰性删除策略，直接回干掉过期的Key。</p>
<p>内存淘汰是指用户存储的一部分Key是可以被Redis自动的删除，从而会出现从缓存中查不到数据的情况。加入我们的服务器内存为2G、但是随着业务的发展缓存的数据已经超过2G了。</p>
<p>但是这并不影响我们程序的运行，因为操作系统的可见内存并不受物理内存的限制。物理内存不够用没关系，计算机会从硬盘中划出一片空间来作为虚拟内存。这就是Redis设计两种应用场景的初衷：缓存、持久存储。</p>
<h2 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h2><p><strong>解决方案：</strong></p>
<p>1、后台设置定时任务，主动地去更新缓存数据。这种方案容易理解，但是当Key比较分散的时候，操作起来还是比较复杂的。</p>
<p>2、分级缓存。比如设置两层缓存保护层，1级缓存失效时间短，2级缓存失效时间长。有请求过来优先从1级缓存中去查找，如果在1级缓存中没有找到相应数据，则对该线程进行加锁，这个线程再从数据库中取到数据，更新至1级和2级缓存。其他线程则直接从2级线程中获取。</p>
<p>3、提供一个拦截机制，内部维护一系列合法的Key值。当请求的Key不合法时，直接返回。</p>
<h2 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h2><p><strong>如何避免雪崩：</strong></p>
<p>1、给缓存加上一定区间内的随机生效时间，不同的Key设置不同的失效时间，避免同一时间集体失效。</p>
<p>2、和缓存击穿解决方案类似，做二级缓存，原始缓存失效时从拷贝缓存中读取数据。</p>
<p>3、利用加锁或者队列方式避免过多请求同时对服务器进行读写操作。</p>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><p>Redis的性能极高，读的速度是110000次/s，写的速度是81000次/s，支持事务，支持备份，丰富的数据类型。</p>
<p>任何事情都是两面性，Redis也是有缺点的：</p>
<p>1、由于是内存数据库，所以单台机器存储的数据量是有限的，需要开发者提前预估，需要及时删除不需要的数据。</p>
<p>2、当修改Redis的数据之后需要将持久化到硬盘的数据重新加入到内容中，时间比较久，这个时候Redis是无法正常运行的。</p>
<h2 id="运维"><a href="#运维" class="headerlink" title="运维"></a>运维</h2><h3 id="生产环境禁用命令"><a href="#生产环境禁用命令" class="headerlink" title="生产环境禁用命令"></a>生产环境禁用命令</h3><h4 id="keys"><a href="#keys" class="headerlink" title="keys"></a>keys</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 禁止使用Keys正则匹配</span></span><br><span class="line">keys * wxdb（此处省略）cf8*</span><br></pre></td></tr></table></figure>
<p>1、redis是单线程的，其所有操作都是原子的，不会因并发产生数据异常；</p>
<p>2、使用高耗时的Redis命令是很危险的，会占用唯一的一个线程的大量处理时间，导致所有的请求都被拖慢。（例如时间复杂度为O(N)的KEYS命令，严格禁止在生产环境中使用）；</p>
<ul>
<li>运维人员进行keys *操作，该操作比较耗时，又因为redis是单线程的，所以redis被锁住；</li>
<li>此时QPS比较高，又来了几万个对redis的读写请求，因为redis被锁住，所以全部Hang在那；</li>
<li>因为太多线程Hang在那，CPU严重飙升，造成redis所在的服务器宕机；</li>
<li>所有的线程在redis那取不到数据，一瞬间全去数据库取数据，数据库就宕机了；</li>
</ul>
<h4 id="flushdb-flushall-config"><a href="#flushdb-flushall-config" class="headerlink" title="flushdb flushall config"></a>flushdb flushall config</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flushdb 清空当前数据库的所有的key</span><br><span class="line">flushall 清空整个redis服务器的所有的key</span><br><span class="line">config 客户端连接后可配置服务器</span><br></pre></td></tr></table></figure>
<p>禁用命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rename-command FLUSHALL &quot;&quot;</span><br><span class="line">rename-command FLUSHDB &quot;&quot;</span><br><span class="line">rename-command CONFIG &quot;&quot;</span><br><span class="line">rename-command KEYS &quot;&quot;</span><br></pre></td></tr></table></figure>
<p>对于FLUSHALL命令，需要设置配置文件中appendonly no，否则服务器是无法启动。</p>
<p>时间复杂度高于O(N)的命令: hgetall、lrange、smembers、zrange、sinter等，它们并非不能使用，但这些命令的时间复杂度都为O(N)，使用这些命令需要明确N的值，否则也会出现缓存宕机。</p>
<p>Redis2.8版本以后有了一个新命令scan，可以用来分批次扫描redis记录，这样肯定会导致整个查询消耗的总时间变大，但不会影响redis服务卡顿，影响服务使用。</p>
<p><strong>分层架构设计，有一条准则</strong>：站点层、服务层要做到无数据无状态，这样才能任意的加节点水平扩展，数据和状态尽量存储到后端的数据存储服务，例如数据库服务或者缓存服务。</p>
<h2 id="Redis-or-Memcached"><a href="#Redis-or-Memcached" class="headerlink" title="Redis or Memcached"></a>Redis or Memcached</h2><p>value是哈希，列表，集合，有序集合这类复杂的数据结构时，会选择redis，因为mc无法满足这些需求，最典型的场景，用户订单列表，用户消息，帖子评论列表等。</p>
<p>Redis支持持久化</p>
<p>千万不要把redis当作数据库用：</p>
<p>（1）redis的定期快照不能保证数据不丢失</p>
<p>（2）redis的AOF会降低效率，并且不能支持太大的数据量</p>
<p><strong>缓存场景，开启固化功能，有什么利弊？</strong></p>
<p>如果只是缓存场景，数据存放在数据库，缓存在redis，此时如果开启固化功能： </p>
<p><strong>优点</strong>是，redis挂了再重启，内存里能够快速恢复热数据，不会瞬时将压力压到数据库上，没有一个cache预热的过程。</p>
<p><strong>缺点</strong>是，在redis挂了的过程中，如果数据库中有数据的修改，可能导致redis重启后，数据库与redis的数据不一致。</p>
<p>redis天然支持集群功能，可以实现主动复制，读写分离。</p>
<p>redis官方也提供了sentinel集群管理工具，能够实现主从服务监控，故障自动转移，这一切，对于客户端都是透明的，无需程序改动，也无需人工介入。</p>
<p>memcache的value存储，最大为1M，如果存储的value很大，只能使用redis</p>
<p><strong>什么时候倾向于memcache？</strong></p>
<p>纯KV，数据量非常大，并发量非常大的业务，使用memcache或许更适合。</p>
<p><strong>内存分配</strong></p>
<p>memcache使用预分配内存池的方式管理内存，能够省去内存分配时间。Redis则是临时申请空间，可能导致碎片。mc会更快一些。</p>
<p><strong>虚拟内存使用</strong></p>
<p>memcache把所有的数据存储在物理内存里。redis有自己的VM机制，理论上能够存储比物理内存更多的数据，当数据超量时，会引发swap，把冷数据刷到磁盘上。数据量大时，mc会更快一些。</p>
<p><strong>网络模型</strong></p>
<p>memcache使用非阻塞IO复用模型，redis也是使用非阻塞IO复用模型。但由于redis还提供一些非KV存储之外的排序，聚合功能，在执行这些功能时，复杂的CPU计算，会阻塞整个IO调度。</p>
<p>由于redis提供的功能较多，mc会更快一些。 </p>
<p><strong>线程模型</strong></p>
<p>memcache使用多线程，主线程监听，worker子线程接受请求，执行读写，这个过程中，可能存在锁冲突。redis使用单线程，虽无锁冲突，但难以利用多核的特性提升整体吞吐量。</p>
<p>从这一点上，mc会快一些。</p>
<p><em>画外音：理论上，mc只支持kv，而redis支持了这么多功能，mc性能应该高非常多非常多，但实际并非如此，真的可能和代码质量有关。</em></p>
<p><strong>水平扩展的支持</strong></p>
<p>不管是mc和redis，服务端集群没有天然支持水平扩展，需要在客户端进行分片，这其实对调用方并不友好。如果能服务端集群能够支持水平扩展，会更完美一些。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/Java/io/BIO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="aaronzhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Guadazi">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java/io/BIO/" class="post-title-link" itemprop="url">Java IO</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-05-12 17:28:00" itemprop="dateCreated datePublished" datetime="2016-05-12T17:28:00+08:00">2016-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-10 17:39:19" itemprop="dateModified" datetime="2021-04-10T17:39:19+08:00">2021-04-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="/Java/advanced-engineer-outline/">&lt;&lt; Java高级软件工程师知识结构</a></p>
<ol>
<li>掌握InputStream、OutputStream、Reader、Writer的继承体系。</li>
<li>掌握字节流(FileInputStream、DataInputStream、BufferedInputStream、FileOutputSteam、DataOutputStream、BufferedOutputStream)和 字符流(BufferedReader、InputStreamReader、FileReader、BufferedWriter、OutputStreamWriter、PrintWriter、FileWriter)，并熟练运用。</li>
<li>掌握NIO实现原理及使用方法。</li>
</ol>
<p>Java IO包括:</p>
<ul>
<li><a href="/Java/io/IO-Model/">IO Model</a></li>
<li><a href="/Java/io/BIO/">Java BIO</a></li>
<li><a href="/Java/io/NIO/">Java NIO</a></li>
<li><a href="/Java/io/AIO/">Java AIO</a></li>
<li><a href="/Java/io/java-zip/">Java压缩</a></li>
<li><a href="/Java/io/object-serialization/">Java序列化</a></li>
<li><a href="/Java/io/java-XML-JSON/">Java XML与JSON</a></li>
</ul>
<p>本文介绍的是Java IO的基础部分, 也叫作<code>BIO</code>.</p>
<h1 id="Java-IO-继承关系"><a href="#Java-IO-继承关系" class="headerlink" title="Java IO 继承关系"></a>Java IO 继承关系</h1><p>java.io包中包含了一系列的<code>Java IO</code>相关的类和接口：</p>
<p><img src="/images/java/io/java-io-package.png"></p>
<ul>
<li>File 文件类</li>
<li>FileDescriptor 文件描述类</li>
<li>InputStream 字节流输入抽象类</li>
<li>OutputStream 字节流输出抽象类</li>
<li>Reader 字符流输入抽象类</li>
<li>Writer 字符流输出抽象类</li>
<li>RandomAccessFile随机访问文件类 不是InputStream或者OutputStream继承层次的一部分，除了实现了DataInput和DataOutput接口（DataInputStream和DataOutputStream也实现这两个接口）外, 他和这两个继承层次没任何关系。甚至不使用InputStream和OutputStream类中的任何功能。完全是独立的类，RandomAccessFile拥有和别的IO类型本质完全不同的行为，可以在一个文件中向前和向后移动，因此重新编写了所有的方法。任何情况下都是相互独立的，直接从Object类派生而来。</li>
<li><ul>
<li>Console类,该类提供了用于读取密码的方法，可以禁止控制台回显并返回char数组，这两个特性对保证安全有作用，平时用的不多，了解就行。</li>
</ul>
</li>
<li><ul>
<li>StreamTokenizer 类，这个类非常有用，它可以把输入流解析为标记（token）, StreamTokenizer 并非派生自InputStream或者OutputStream，而是归类于io库中，因为StreamTokenizer只处理InputStream对象。</li>
</ul>
</li>
</ul>
<p>流，是编程语言的IO类库常用的概念， 所谓流是指任何有能力产出数据的数据源和任何有能力接收数据的接收端对象。”流”屏蔽了实际的IO设备中处理数据的细节。<br>Java中的流，根据处理数据类型的不同分为：字符流和字节流; 根据数据流向不同分为：输入流和输出流。可以通过类名的结尾来判断。</p>
<h2 id="字节流"><a href="#字节流" class="headerlink" title="字节流"></a>字节流</h2><p><a href="/Java/io/java-zip/">java中的压缩</a>都是面向字节的 (<code>java.util.zip</code>)。</p>
<h2 id="InputStream"><a href="#InputStream" class="headerlink" title="InputStream"></a>InputStream</h2><p>字节输入流都是继承于InputStream并且以InputStream结尾，InputStream表示从不同的数据源产生输入的类，这些数据源包括字节数组、String对象(StringBufferInputStream已经不再使用，需要转换为字节数组来实现)、文件、“管道”、其他种类的流组成的序列及其他数据源。每种数据源都有相应的 InputStream 子类，FilterInputStream也属于一种 InputStream， 为装饰器类提供基类，其中，“装饰器”类可以把属性或有用的接口与输入流连接在一起。<a href="/designPattern-Strategy/">装饰器模式</a></p>
<p><img src="/images/java/io/java-io-InputStream.png"></p>
<ol>
<li>PipedInputStream 作为多线程中的数据源，将其与FilterInputStream对象相连以提供有用接口</li>
<li><code>FilterInputStream</code> 类定义了一些方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mark</span><span class="params">(<span class="keyword">int</span> readlimit)</span></span></span><br><span class="line"><span class="function">	在输入流中的当前位置上作标记。 </span></span><br><span class="line"><span class="function"> reset 方法的后续调用将此流重新定位在最后标记的位置上，</span></span><br><span class="line"><span class="function"> 以便后续读取操作重新读取相同的字节。</span></span><br><span class="line"><span class="function">	readlimit 参数告知此输入流在标记位置无效之前允许读取的字节数。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span>  <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">	将此流重新定位到对此输入流最后调用 mark 方法时的位置。</span></span><br><span class="line"><span class="function">	此方法只执行 in.<span class="title">reset</span><span class="params">()</span>。</span></span><br><span class="line"><span class="function">	在需要提前读取一小部分数据以查看流中有什么的情况下，可以使用流的标记。</span></span><br><span class="line"><span class="function">	通过调用通用解析器常常最容易做到这一点。如果流属于通过解析处理的类型，那么解析起来就很容易。</span></span><br><span class="line"><span class="function">	如果流不属于那种类型，那么解析器应该在解析失败时抛出一个异常。</span></span><br><span class="line"><span class="function">	如果这发生在 readlimit 个字节内，那么它允许外部代码重置流，并尝试另一种解析器。</span></span><br></pre></td></tr></table></figure></li>
<li>除了DataInputStream以外的FilterInputStream类在内部修改了InputStream的行为方式，是否缓冲，是否记录读过的行，以及是否把单一字符推回输入流等。</li>
</ol>
<h2 id="OutputStream"><a href="#OutputStream" class="headerlink" title="OutputStream"></a>OutputStream</h2><p>接收端对象包括字节数组(但不是String)、文件或者管道。<br>字节输出流都是继承于OutputStream并以OutputStream结尾</p>
<p><img src="/images/java/io/java-io-OutputStream.png"></p>
<p>字节输入流和输出流的对应关系</p>
<p><img src="/images/java/io/InputStream-OutputStream-match.png"></p>
<h2 id="字符流"><a href="#字符流" class="headerlink" title="字符流"></a>字符流</h2><p>字节流仅支持8位字节流，不能很好的处理16位的Unicode字符，<code>Reader</code>和<code>Writer</code>提供了兼容Unicode与面向字符的I/O功能，可以方便的实现国际化。</p>
<h2 id="Reader-字符输入流"><a href="#Reader-字符输入流" class="headerlink" title="Reader 字符输入流"></a>Reader 字符输入流</h2><p>读取字符序列的类都是继承于Reader并且以Reader结尾</p>
<p><img src="/images/java/io/java-io-Reader.png"></p>
<h2 id="Writer-字符输出流"><a href="#Writer-字符输出流" class="headerlink" title="Writer 字符输出流"></a>Writer 字符输出流</h2><p>写入字符流的类都是继承于Writer并且以Writer结尾</p>
<p><img src="/images/java/io/java-io-Writer.png"></p>
<ol>
<li>FilterWriter形同虚设： BufferedWriter并不是FilterWriter的子类，尽管FilterWriter是抽象类。没有任何子类。</li>
<li>CharArrayWriter、StringWriter 是两种基本的介质流，它们分别向Char 数组、String 中写入数据。PipedWriter 是向与其它线程共用的管道中写入数据</li>
<li>PrintWriter 和 PrintStream 极其类似，功能和使用也非常相似。</li>
<li>OutputStreamWriter 是OutputStream 到Writer 转换的桥梁</li>
</ol>
<p>字符输入流与字符输出流的对应关系</p>
<p><img src="/images/java/io/Reader-Writer-match.png"></p>
<h2 id="字节流与字符流的对应关系"><a href="#字节流与字符流的对应关系" class="headerlink" title="字节流与字符流的对应关系"></a>字节流与字符流的对应关系</h2><p><img src="/images/java/io/%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.png"></p>
<p><img src="/images/java/io/%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.png"></p>
<h2 id="字节流与字符流的区别"><a href="#字节流与字符流的区别" class="headerlink" title="字节流与字符流的区别"></a>字节流与字符流的区别</h2><p>把一片二进制数据数据逐一输出到某个设备中，或者从某个设备中逐一读取一片二进制数据，不管输入输出设备是什么，我们要用统一的方式来完成这些操作，用一种抽象的方式进行描述，这个抽象描述方式起名为IO流，对应的抽象类为OutputStream和InputStream ，不同的实现类就代表不同的输入和输出设备，它们都是针对字节进行操作的。</p>
<p>在应用中，经常要完全是字符的一段文本输出去或读进来，用字节流可以吗？计算机中的一切最终都是二进制的字节形式存在。对于“中国”这些字符，首先要得到其对应的字节，然后将字节写入到输出流。读取时，首先读到的是字节，可是我们要把它显示为字符，我们需要将字节转换成字符。由于这样的需求很广泛，人家专门提供了字符流的包装类。</p>
<p>底层设备永远只接受字节数据，有时候要写字符串到底层设备，需要将字符串转成字节再进行写入。字符流是字节流的包装，字符流则是直接接受字符串，它内部将串转成字节，再写入底层设备，这为我们向IO设别写入或读取字符串提供了一点点方便。字符向字节转换时，要注意编码的问题，因为字符串转成字节数组，其实是转成该字符的某种编码的字节形式，读取也是反之的道理。</p>
<h1 id="字节流-1"><a href="#字节流-1" class="headerlink" title="字节流"></a>字节流</h1><h2 id="FileInputStream-文件输入流"><a href="#FileInputStream-文件输入流" class="headerlink" title="FileInputStream 文件输入流"></a>FileInputStream 文件输入流</h2><p>构造器只能接受File对象 File路径字符串或者 FileDescriptor对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">available</span><span class="params">()</span></span></span><br><span class="line"><span class="function">     返回下一次对此输入流调用的方法可以不受阻塞地从此输入流读取（或跳过）的估计剩余字节数。</span></span><br><span class="line"><span class="function">FileDescriptor 	<span class="title">getFD</span><span class="params">()</span></span></span><br><span class="line"><span class="function">     返回表示到文件系统中实际文件的连接的 FileDescriptor 对象，</span></span><br><span class="line"><span class="function">     该文件系统正被此 FileInputStream 使用。</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> 	<span class="title">skip</span><span class="params">(<span class="keyword">long</span> n)</span></span></span><br><span class="line"><span class="function">     从输入流中跳过并丢弃 n 个字节的数据。</span></span><br></pre></td></tr></table></figure>
<h2 id="FileOutputSteam-文件输出流"><a href="#FileOutputSteam-文件输出流" class="headerlink" title="FileOutputSteam 文件输出流"></a>FileOutputSteam 文件输出流</h2><p>文件输出流是用于将数据写入 File 或 FileDescriptor 的输出流。与字符流中的<code>FileWriter</code>对应.</p>
<h2 id="BufferedInputStream-缓冲输入流"><a href="#BufferedInputStream-缓冲输入流" class="headerlink" title="BufferedInputStream 缓冲输入流"></a>BufferedInputStream 缓冲输入流</h2><p>支持一次性读入多个字节</p>
<p>BufferedInputStream 为另一个输入流添加一些功能，即缓冲输入以及支持 mark 和 reset 方法的能力。<br>在创建 BufferedInputStream 时，会创建一个内部缓冲区数组。<br>在读取或跳过流中的字节时，可根据需要从包含的输入流再次填充该内部缓冲区，一次填充多个字节。</p>
<p>实现了FilterInputStream的<code>mark(int readLine)</code>方法</p>
<p>mark 操作记录输入流中的某个点，reset 操作使得在从包含的输入流中获取新字节之前，再次读取自最后一次 mark 操作后读取的所有字节。</p>
<p>构造器只能接受 InputStream</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">available</span><span class="params">()</span></span></span><br><span class="line"><span class="function">          返回可以从此输入流读取（或跳过）、且不受此输入流接下来的方法调用阻塞的估计字节数。</span></span><br></pre></td></tr></table></figure>

<h2 id="BufferedOutputStream-缓冲输出流"><a href="#BufferedOutputStream-缓冲输出流" class="headerlink" title="BufferedOutputStream 缓冲输出流"></a>BufferedOutputStream 缓冲输出流</h2><p>该类实现缓冲的字节输出流。通过设置这种输出流，应用程序就可以将各个字节写入底层输出流中，而不必针对每次字节写入调用底层系统。</p>
<p>BufferedOutputStream重写了OutputStream中的write方法,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] b,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">int</span> off,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> IOException</span></span><br></pre></td></tr></table></figure>
<p>OutputStream写入多个字节时会逐个字节的调用单字节写入方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> IOException</span></span><br></pre></td></tr></table></figure>
<p>而 BufferedOutputStream 中的可以一次性将这些字节写入输出流, 因此效率比较高.</p>
<h2 id="DataInputStream-数据输入流"><a href="#DataInputStream-数据输入流" class="headerlink" title="DataInputStream 数据输入流"></a>DataInputStream 数据输入流</h2><p>DataInputStream几乎可以任何形式输出，而<code>readLine()</code>是唯一成不了首选的原因。</p>
<p>数据输出流允许应用程序以适当方式将基本 Java 数据类型写入输出流中。然后，应用程序可以使用数据输入流将数据读入。</p>
<p>使用DataInputStream写字符串并且能够通过DataInputStream恢复的唯一的方法是使用UTF-8编码</p>
<h2 id="DataOutputStream-数据输出流"><a href="#DataOutputStream-数据输出流" class="headerlink" title="DataOutputStream 数据输出流"></a>DataOutputStream 数据输出流</h2><p>不同的数据类型(基本数据类型和String对象)的读取方法都以<code>read</code>开头，如<code>readByte()</code>、<code>readFloat()</code>等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DataOutputStream outputStream = <span class="keyword">new</span> DataOutputStream(<span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;abc.txt&quot;</span>)));</span><br><span class="line">outputStream.writeDouble(<span class="number">3.14159265358979</span>);</span><br><span class="line">outputStream.writeUTF(<span class="string">&quot;仅仅是测试&quot;</span>);</span><br><span class="line">outputStream.writeDouble(<span class="number">3.58979</span>);</span><br><span class="line">outputStream.writeUTF(<span class="string">&quot;不仅仅是测试&quot;</span>);</span><br><span class="line">outputStream.close();</span><br><span class="line"></span><br><span class="line">DataInputStream inputStream = <span class="keyword">new</span> DataInputStream(<span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;abc.txt&quot;</span>)));</span><br><span class="line">System.out.println(inputStream.readDouble());</span><br><span class="line">System.out.println(inputStream.readUTF());</span><br><span class="line">System.out.println(inputStream.readDouble());</span><br><span class="line">System.out.println(inputStream.readUTF());</span><br><span class="line">inputStream.close();</span><br></pre></td></tr></table></figure>


<h1 id="字符流-1"><a href="#字符流-1" class="headerlink" title="字符流"></a>字符流</h1><h2 id="FileReader-文件输入字符流"><a href="#FileReader-文件输入字符流" class="headerlink" title="FileReader 文件输入字符流"></a>FileReader 文件输入字符流</h2><p>用来读取字符文件的便捷类。此类的构造方法假定默认字符编码和默认字节缓冲区大小都是适当的。<br>要自己指定这些值，可以先在 FileInputStream 上构造一个 InputStreamReader。<br>FileReader 用于读取字符流。要读取原始字节流，请考虑使用 FileInputStream。</p>
<h2 id="FileWriter-文件输出字符流"><a href="#FileWriter-文件输出字符流" class="headerlink" title="FileWriter 文件输出字符流"></a>FileWriter 文件输出字符流</h2><p>用来写入字符文件的便捷类。此类的构造方法假定默认字符编码和默认字节缓冲区大小都是可接受的。<br>要自己指定这些值，可以先在 FileOutputStream 上构造一个 OutputStreamWriter。</p>
<p>文件是否可用或是否可以被创建取决于底层平台。特别是某些平台一次只允许一个 FileWriter（或其他文件写入对象）打开文件进行写入。<br>在这种情况下，如果所涉及的文件已经打开，则此类中的构造方法将失败。</p>
<p>FileWriter 用于写入字符流。要写入原始字节流，请考虑使用 FileOutputStream。</p>
<h2 id="BufferedReader-缓冲字符输入流"><a href="#BufferedReader-缓冲字符输入流" class="headerlink" title="BufferedReader 缓冲字符输入流"></a>BufferedReader 缓冲字符输入流</h2><p>从<code>字符输入流</code>中读取文本，缓冲各个字符，从而实现字符、数组和行的高效读取。<br>可以指定缓冲区的大小，或者可使用默认的大小。大多数情况下，默认值就足够大了。<br>通常，Reader 所作的每个读取请求都会导致对底层字符或字节流进行相应的读取请求。<br>因此，建议用 BufferedReader 包装所有其 read() 操作可能开销很高的 Reader（如 FileReader 和 InputStreamReader）。例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader in</span><br><span class="line">   = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">&quot;foo.in&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>将缓冲指定文件的输入。如果没有缓冲，则每次调用 read() 或 readLine() 都会导致从文件中读取字节，并将其转换为字符后返回，而这是极其低效的。</p>
<p>通过用合适的 BufferedReader 替代每个 DataInputStream，可以对将 DataInputStream 用于文字输入的程序进行本地化。</p>
<p>主要的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">String 	<span class="title">readLine</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	  读取一个文本行。</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">ready</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	  判断此流是否已准备好被读取。</span></span><br></pre></td></tr></table></figure>
<h2 id="BufferedWriter-缓冲字符输出流"><a href="#BufferedWriter-缓冲字符输出流" class="headerlink" title="BufferedWriter 缓冲字符输出流"></a>BufferedWriter 缓冲字符输出流</h2><p>将文本写入字符输出流，缓冲各个字符，从而提供单个字符、数组和字符串的高效写入。<br>可以指定缓冲区的大小，或者接受默认的大小。在大多数情况下，默认值就足够大了。<br>该类提供了 newLine() 方法，它使用平台自己的行分隔符概念，此概念由系统属性 line.separator 定义。<br>并非所有平台都使用新行符 (‘\n’) 来终止各行。因此调用此方法来终止每个输出行要优于直接写入新行符。</p>
<p>通常 Writer 将其输出立即发送到底层字符或字节流。<br>除非要求提示输出，否则建议用 BufferedWriter 包装所有其 write() 操作可能开销很高的 Writer（如 FileWriters 和 OutputStreamWriters）。<br>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter out = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">&quot;foo.out&quot;</span>)));</span><br></pre></td></tr></table></figure>
<p>将缓冲 PrintWriter 对文件的输出。如果没有缓冲，则每次调用 print() 方法会导致将字符转换为字节，然后立即写入到文件，而这是极其低效的。</p>
<h2 id="PrintWriter-打印输出字符流"><a href="#PrintWriter-打印输出字符流" class="headerlink" title="PrintWriter 打印输出字符流"></a>PrintWriter 打印输出字符流</h2><p>向文本输出流打印对象的格式化表示形式，支持写入各种格式的字符流。但不能写入字节流。</p>
<p>如果启用了自动刷新(<code>autoFlush</code>)，则只有在调用 println、printf 或 format 的其中一个方法时才可能完成此操作，而不是每当正好输出换行符时才完成。这些方法使用平台自有的行分隔符概念，而不是换行符。</p>
<p>为了更容易的过渡到使用<code>PrintWriter</code>，他提供了一个既能接受<code>Writer</code>对象又能接收<code>OutputStream</code>对象的构造器。<br>甚至提供了可以直接接收文件的构造器。</p>
<p>例如，基本文件输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter printWriter = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">&quot;abc.text&quot;</span>)));</span><br><span class="line">PrintWriter printWriter = <span class="keyword">new</span> PrintWriter(<span class="string">&quot;abc.text&quot;</span>); <span class="comment">//快捷方式</span></span><br></pre></td></tr></table></figure>
<p>构造器有:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter(File file)</span><br><span class="line">  使用指定文件创建不具有自动行刷新的新 PrintWriter。</span><br><span class="line">PrintWriter(File file, String csn)</span><br><span class="line">  创建具有指定文件和字符集且不带自动刷行新的新 PrintWriter。</span><br><span class="line">PrintWriter(OutputStream out)</span><br><span class="line">  根据现有的 OutputStream 创建不带自动行刷新的新 PrintWriter。</span><br><span class="line">PrintWriter(OutputStream out, <span class="keyword">boolean</span> autoFlush)</span><br><span class="line">  通过现有的 OutputStream 创建新的 PrintWriter。</span><br><span class="line">PrintWriter(String fileName)</span><br><span class="line">  创建具有指定文件名称且不带自动行刷新的新 PrintWriter。</span><br><span class="line">PrintWriter(String fileName, String csn)</span><br><span class="line">  创建具有指定文件名称和字符集且不带自动行刷新的新 PrintWriter。</span><br><span class="line">PrintWriter(Writer out)</span><br><span class="line">  创建不带自动行刷新的新 PrintWriter。</span><br><span class="line">PrintWriter(Writer out, <span class="keyword">boolean</span> autoFlush)</span><br><span class="line">  创建新 PrintWriter。</span><br></pre></td></tr></table></figure>
<p>构造PrintWriter的方式主要有： <code>File</code>或者文件名、<code>OutputStream</code>以及<code>Writer</code>.</p>
<p>主要的方法：</p>
<p>append方法将指定字符、字符序列和指定字符序列的子序列添加到此 writer。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">PrintWriter 	<span class="title">append</span><span class="params">(<span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function">PrintWriter 	<span class="title">append</span><span class="params">(CharSequence csq)</span></span></span><br><span class="line"><span class="function">PrintWriter 	<span class="title">append</span><span class="params">(CharSequence csq, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">println</span><span class="params">()</span> 通过写入行分隔符字符串终止当前行。</span></span><br></pre></td></tr></table></figure>
<p>PrintStream 存在两个重要的方法：<code>print</code>和<code>println</code>。对它们了重载，以便可打印出各种不同的类型。<br><code>print</code>可以打印的类型有 <code>boolean</code> <code>char</code> <code>char[]</code> <code>double</code> <code>float</code> <code>int</code> <code>long</code> <code>Object</code>和<code>String</code>.<br><code>println</code>的参数有<code>boolean</code> <code>char</code> <code>char[]</code> <code>double</code> <code>float</code> <code>int</code> <code>long</code> <code>Object</code>和<code>String</code>.</p>
<p><code>printf</code>、<code>format</code>和<code>write</code>可以打印更多的格式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">PrintWriter 	<span class="title">printf</span><span class="params">(Locale l, String format, Object... args)</span></span></span><br><span class="line"><span class="function">PrintWriter 	<span class="title">printf</span><span class="params">(String format, Object... args)</span></span></span><br><span class="line"><span class="function">PrintWriter 	<span class="title">format</span><span class="params">(Locale l, String format, Object... args)</span></span></span><br><span class="line"><span class="function">        使用指定格式字符串和参数将一个格式化字符串写入此 writer 中。</span></span><br><span class="line"><span class="function">PrintWriter 	<span class="title">format</span><span class="params">(String format, Object... args)</span></span></span><br><span class="line"><span class="function">        使用指定格式字符串和参数将一个格式化字符串写入此 writer 中。</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">write</span><span class="params">(<span class="keyword">char</span>[] buf)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">write</span><span class="params">(<span class="keyword">char</span>[] buf, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span> 写入字符数组，字符数组的某一部分。</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">write</span><span class="params">(<span class="keyword">int</span> c)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">write</span><span class="params">(String s)</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">write</span><span class="params">(String s, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function">        写入单个字符、字符串及字符串的一部分。</span></span><br></pre></td></tr></table></figure>
<p>其他方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> 	<span class="title">checkError</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        如果流没有关闭，则刷新流且检查其错误状态。</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span>  <span class="keyword">void</span> 	<span class="title">setError</span><span class="params">()</span></span></span><br><span class="line"><span class="function">                指示已发生错误。</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span>  <span class="keyword">void</span> 	<span class="title">clearError</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        清除此流的错误状态。</span></span><br></pre></td></tr></table></figure>



<h2 id="InputStreamReader-输入流转换器"><a href="#InputStreamReader-输入流转换器" class="headerlink" title="InputStreamReader 输入流转换器"></a>InputStreamReader 输入流转换器</h2><p>有时需要将字节流转换为字符流，为了实现这个目的，要用到<code>适配器(adapter)</code>类： <code>InputStreamReader</code>将<code>InputStream</code>转换为<code>Reader</code>； <code>OutputStreamWriter</code>将<code>OutputStream</code>转换为<code>Writer</code></p>
<h2 id="OutputStreamWriter-输出流转换器"><a href="#OutputStreamWriter-输出流转换器" class="headerlink" title="OutputStreamWriter 输出流转换器"></a>OutputStreamWriter 输出流转换器</h2><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="管道流"><a href="#管道流" class="headerlink" title="管道流"></a>管道流</h3><ol>
<li>PipedInputStream </li>
<li>PipedOutputStream </li>
<li>PipedReader </li>
<li>PipedWriter</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证管道流</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息发送类</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Send</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> PipedOutputStream out=<span class="keyword">null</span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       out = <span class="keyword">new</span> PipedOutputStream();</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> PipedOutputStream <span class="title">getOut</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.out;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">       String message = <span class="string">&quot;hello , Rollen&quot;</span>;</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           out.write(message.getBytes());</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;<span class="keyword">try</span>&#123;</span><br><span class="line">           out.close();</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接受消息类</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Recive</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> PipedInputStream input=<span class="keyword">null</span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Recive</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.input=<span class="keyword">new</span> PipedInputStream();</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> PipedInputStream <span class="title">getInput</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.input;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1000</span>];</span><br><span class="line">       <span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           len=<span class="keyword">this</span>.input.read(b);</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;<span class="keyword">try</span>&#123;</span><br><span class="line">           input.close();</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;接受的内容为 &quot;</span>+(<span class="keyword">new</span> String(b,<span class="number">0</span>,len)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试类</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hello</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       Send send=<span class="keyword">new</span> Send();</span><br><span class="line">       Recive recive=<span class="keyword">new</span> Recive();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"><span class="comment">//管道连接</span></span><br><span class="line">           send.getOut().connect(recive.getInput());</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">new</span> Thread(send).start();</span><br><span class="line">       <span class="keyword">new</span> Thread(recive).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SequenceInputStream"><a href="#SequenceInputStream" class="headerlink" title="SequenceInputStream"></a>SequenceInputStream</h3><p>SequenceInputStream可以认为是一个工具类，将两个或者多个输入流当成一个输入流依次读取。完全可以从IO 包中去除，还完全不影响IO 包的结构，却让其更“纯洁”――纯洁的Decorator 模式。<br>【案例】将两个文本文件合并为另外一个文本文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 将两个文本文件合并为另外一个文本文件</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"></span><br><span class="line">File file1 = newFile(<span class="string">&quot;d:&quot;</span> + File.separator + <span class="string">&quot;hello1.txt&quot;</span>);</span><br><span class="line">File file2 = newFile(<span class="string">&quot;d:&quot;</span> + File.separator + <span class="string">&quot;hello2.txt&quot;</span>);</span><br><span class="line">File file3 = newFile(<span class="string">&quot;d:&quot;</span> + File.separator + <span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">InputStream input1 =<span class="keyword">new</span> FileInputStream(file1);</span><br><span class="line">InputStream input2 =<span class="keyword">new</span> FileInputStream(file2);</span><br><span class="line">OutputStream output =<span class="keyword">new</span> FileOutputStream(file3);</span><br><span class="line"><span class="comment">// 合并流</span></span><br><span class="line">SequenceInputStream sis = <span class="keyword">new</span> SequenceInputStream(input1, input2);</span><br><span class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((temp =sis.read()) != -<span class="number">1</span>)&#123;</span><br><span class="line">   output.write(temp);</span><br><span class="line">&#125;</span><br><span class="line">input1.close();</span><br><span class="line">input2.close();</span><br><span class="line">output.close();</span><br><span class="line">sis.close();</span><br></pre></td></tr></table></figure>
<h1 id="RandomAccessFile"><a href="#RandomAccessFile" class="headerlink" title="RandomAccessFile"></a>RandomAccessFile</h1><p>支持搜寻方法，并且只适用于文件。</p>
<p>getFilePointer() 用于查找当前所处的文件位置，seek() 用于在文件内移至新的位置, length()用于判断文件的最大尺寸. 构造器支持在第二个参数中指示<code>随机读(r)</code>还是<code>读写(rw)</code>.但是不支持只写.<br>在JDK1.4后, RandomAccessFile的大多数功能由NIO存储映射文件所取代.</p>
<h2 id="断点下载"><a href="#断点下载" class="headerlink" title="断点下载"></a>断点下载</h2><blockquote>
<p>注意: </p>
<ol>
<li>使用 <code>FileWriter</code>、<code>BufferedOutputStream</code> 或者 <code>BufferedWriter</code> 写文件时，一定要清理缓冲区并且关闭输出流，否则会造成写入的内容丢失</li>
<li>使用字符流装饰字节流时，一定要都关闭掉</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>如何判断读到文件结尾? </li>
</ol>
</blockquote>
<ul>
<li>字符流: 每一个<code>Reader</code>都包含一个<code>ready()</code>方法，该方法用于判断IO是否准备完毕，但是不能是否读到文件的结尾。判断是否读到文件结尾要通过判断读入的内容是否为空判断。</li>
</ul>
<h1 id="File类"><a href="#File类" class="headerlink" title="File类"></a>File类</h1><h2 id="getPath-getAbsolutePath和getCanonicalPath"><a href="#getPath-getAbsolutePath和getCanonicalPath" class="headerlink" title="getPath getAbsolutePath和getCanonicalPath"></a>getPath getAbsolutePath和getCanonicalPath</h2><ul>
<li><code>public String getPath()</code> 获取为文件赋值时的路径名</li>
<li><code>public String getAbsolutePath()</code> 获取绝对路径名（包含<code>..</code>和<code>.</code>等字符）。</li>
<li><code>public String getCanonicalPath()throws IOException</code> 获取规范路径名(经过计算后的精简路径名)</li>
</ul>
<h3 id="getCanonicalPath"><a href="#getCanonicalPath" class="headerlink" title="getCanonicalPath()"></a>getCanonicalPath()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;D:\\Text.txt&quot;</span>);</span><br><span class="line">System.out.println(file.getCanonicalPath());</span><br></pre></td></tr></table></figure>
<p>Windows系统下<br>(1),确定D盘下没有Text.txt这个文件，直接执行这段代码，得到的结果是:<br><code>D:\Text.txt</code><br>注意这里试大写的Text.txt<br>(2)在D盘下建立一个文件，名叫text.txt，再次执行代码，得到结果<br><code>D:\text.txt</code></p>
<p>尝试在linux下执行上边的步骤，两次打印的结果是相同的，因为linux是大小写敏感的系统。</p>
<h2 id="遍历目录下的文件"><a href="#遍历目录下的文件" class="headerlink" title="遍历目录下的文件"></a>遍历目录下的文件</h2><ul>
<li>String[]     list()<pre><code>返回一个字符串数组，这些字符串指定此抽象路径名表示的目录中的文件和目录。</code></pre>
</li>
<li>String[] list(FilenameFilter filter)<pre><code>返回一个字符串数组，这些字符串指定此抽象路径名表示的目录中满足指定过滤器的文件和目录。</code></pre>
</li>
<li>File[] listFiles()<pre><code>返回一个抽象路径名数组，这些路径名表示此抽象路径名表示的目录中的文件。</code></pre>
</li>
<li>File[] listFiles(FileFilter filter)<pre><code>返回抽象路径名数组，这些路径名表示此抽象路径名表示的目录中满足指定过滤器的文件和目录。</code></pre>
</li>
<li>File[] listFiles(FilenameFilter filter)<pre><code>返回抽象路径名数组，这些路径名表示此抽象路径名表示的目录中满足指定过滤器的文件和目录。</code></pre>
</li>
</ul>
<p>上面的遍历方法中存在两个通过FilenameFilter和FileFilter过滤文件的方法。<br>这是<a href="/java-XML-JSON/">策略模式</a>的典型应用。<br>以<code>String[] list(FilenameFilter filter)</code>为例<br>list提供了基本的功能，而且按照FilenameFilter的形式提供策略，以便完善list在提供服务时所需的算法。因为list接受FilenameFilter对象作为参数， 任何实现了FilenameFilter接口的对象都可以传递给list方法，用以选择list方法的行为方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FilenameFilter</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File dir, String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">File srcDir=<span class="keyword">new</span> File(<span class="string">&quot;~/testDir&quot;</span>);</span><br><span class="line">File[] files = srcDir.listFiles(</span><br><span class="line"> <span class="keyword">new</span> FilenameFilter()&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File dir, String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name.endsWith(<span class="string">&quot;.java&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="设置指定权限"><a href="#设置指定权限" class="headerlink" title="设置指定权限"></a>设置指定权限</h2><h2 id="迭代创建目录"><a href="#迭代创建目录" class="headerlink" title="迭代创建目录"></a>迭代创建目录</h2><p><code>public boolean mkdirs()</code> 创建此抽象路径名指定的目录，包括所有必需但不存在的父目录。注意，此操作失败时也可能已经成功地创建了一部分必需的父目录。</p>
<h2 id="文件系统根"><a href="#文件系统根" class="headerlink" title="文件系统根"></a>文件系统根</h2><p><code>public static File[] listRoots()</code></p>
<h1 id="样例模板"><a href="#样例模板" class="headerlink" title="样例模板"></a>样例模板</h1><h2 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h2><p>无论使用任何方式打开文件或者流,必须准确的关闭, 标准的形式是在try-catch语句块的finally中关闭.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">String fileName = <span class="string">&quot;abc.txt&quot;</span>;</span><br><span class="line">BufferedReader bufferedReader = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Reader reader = <span class="keyword">new</span> FileReader(fileName);</span><br><span class="line">    bufferedReader = <span class="keyword">new</span> BufferedReader(reader);</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    String s;</span><br><span class="line">    <span class="keyword">while</span> ((s = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        sb.append(s + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (bufferedReader != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bufferedReader.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h2><p>直接通过FileInputStream, 由于没有使用缓冲<code>BufferedInputStream</code>包装, 每次读取一组字节其实是在一个字节一个字节的从系统中读取.</p>
<h3 id="一次性读入字节数组"><a href="#一次性读入字节数组" class="headerlink" title="一次性读入字节数组"></a>一次性读入字节数组</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">File f=<span class="keyword">new</span> File(fileName);</span><br><span class="line">InputStream in=<span class="keyword">new</span> FileInputStream(f);</span><br><span class="line"><span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">int</span> len = in.read(b);</span><br><span class="line">in.close();</span><br><span class="line">String content = <span class="keyword">new</span> String(b,<span class="number">0</span>,len);</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">File f=<span class="keyword">new</span> File(fileName);</span><br><span class="line">InputStream in=<span class="keyword">new</span> FileInputStream(f);</span><br><span class="line"><span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[f.length()];</span><br><span class="line">in.read(b);</span><br><span class="line">in.close();</span><br><span class="line">String content = <span class="keyword">new</span> String(b);</span><br></pre></td></tr></table></figure>
<h3 id="逐个字节读"><a href="#逐个字节读" class="headerlink" title="逐个字节读"></a>逐个字节读</h3><p>FileInputStream的底层原理决定了和上面的读法是一样的<br>读取字节流时, 读到文件的末尾的时候会返回-1, 以此作为判断读取结束的依据.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">File f=<span class="keyword">new</span> File(fileName);</span><br><span class="line">InputStream in=<span class="keyword">new</span> FileInputStream(f);</span><br><span class="line"><span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">int</span> count =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> temp=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((temp=in.read())!=(-<span class="number">1</span>))&#123;</span><br><span class="line">   b[count++]=(<span class="keyword">byte</span>)temp;</span><br><span class="line">&#125;</span><br><span class="line">in.close();</span><br><span class="line">System.out.println(<span class="keyword">new</span> String(b));</span><br></pre></td></tr></table></figure>
<h3 id="加缓冲"><a href="#加缓冲" class="headerlink" title="加缓冲"></a>加缓冲</h3><p>使用<code>BufferedInputStream</code>包装输入流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">File f=<span class="keyword">new</span> File(fileName);</span><br><span class="line">InputStream in=<span class="keyword">new</span> FileInputStream(f);</span><br><span class="line">BufferedInputStream bf = <span class="keyword">new</span> BufferedInputStream(in);</span><br><span class="line"><span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">int</span> len = bf.read(b);</span><br><span class="line">in.close();</span><br><span class="line">String content = <span class="keyword">new</span> String(b,<span class="number">0</span>,len);</span><br></pre></td></tr></table></figure>
<h3 id="字符流读取"><a href="#字符流读取" class="headerlink" title="字符流读取"></a>字符流读取</h3><p>不加缓冲</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接通过字符流读文件 file可为File对象或者文件名String</span></span><br><span class="line">FileReader fileReader = <span class="keyword">new</span> FileReader(file);</span><br><span class="line"><span class="keyword">char</span>[] content = <span class="keyword">new</span> <span class="keyword">char</span>[file.length()]; <span class="comment">// 调用该方法file必须为File对象</span></span><br><span class="line">fileReader.read(content);</span><br><span class="line">System.out.println(<span class="keyword">new</span> String(content));</span><br></pre></td></tr></table></figure>
<p>加缓冲</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建FileInputStream</span></span><br><span class="line">FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line"><span class="comment">// 将字节流转换为字符流</span></span><br><span class="line">InputStreamReader inputStreamReader = <span class="keyword">new</span> InputStreamReader(fileInputStream);</span><br><span class="line"><span class="comment">// 给字符流加缓冲</span></span><br><span class="line">BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(inputStreamReader);</span><br><span class="line">String s = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">while</span> ((s = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">	System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接通过字符流读文件 file可为File对象或者文件名String</span></span><br><span class="line">FileReader fileReader = <span class="keyword">new</span> FileReader(file);</span><br><span class="line"><span class="comment">// 给字符流加缓冲</span></span><br><span class="line">BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(fileReader);</span><br><span class="line">String s;</span><br><span class="line"><span class="keyword">while</span> ((s = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">	System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h2><h3 id="字节流写文件"><a href="#字节流写文件" class="headerlink" title="字节流写文件"></a>字节流写文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OutputStream out =<span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">String str=<span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line"><span class="keyword">byte</span>[] b=str.getBytes();</span><br><span class="line">out.write(b);</span><br><span class="line">out.close();</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">OutputStream out =<span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">String str=<span class="string">&quot;Hello World！！&quot;</span>;</span><br><span class="line"><span class="keyword">byte</span>[] b=str.getBytes();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; b.length; i++) &#123;</span><br><span class="line">   out.write(b[i]);</span><br><span class="line">&#125;</span><br><span class="line">out.close();</span><br></pre></td></tr></table></figure>
<h3 id="加缓冲-1"><a href="#加缓冲-1" class="headerlink" title="加缓冲"></a>加缓冲</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OutputStream outputStream = <span class="keyword">new</span> FileOutputSteam(file);</span><br><span class="line">BufferedOutputStream bf = <span class="keyword">new</span> BufferedOutputStream(outputStream);</span><br><span class="line">bf.write(str.getBytes());</span><br></pre></td></tr></table></figure>
<h3 id="利用字节流写文件"><a href="#利用字节流写文件" class="headerlink" title="利用字节流写文件"></a>利用字节流写文件</h3><p>不加缓冲, 底层实现是逐个字符添加到系统文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileWriter fileWriter = <span class="keyword">new</span> FileWriter(file);</span><br><span class="line">bufferedWriter.write(<span class="string">&quot;Hellp world!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>加缓冲</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file为File对象 文件名字符串 FileDescriptor对象</span></span><br><span class="line">FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line"><span class="comment">// 字节流转换为字节流</span></span><br><span class="line">OutputStreamWriter outputStreamWriter = <span class="keyword">new</span> OutputStreamWriter(fileOutputStream);</span><br><span class="line"><span class="comment">// 加缓冲</span></span><br><span class="line">BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(outputStreamWriter);</span><br><span class="line">bufferedWriter.write(<span class="string">&quot;hello world!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FileWriter fileWriter = <span class="keyword">new</span> FileWriter(file);</span><br><span class="line">BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(fileWriter);</span><br><span class="line">bufferedWriter.write(<span class="string">&quot;Hello world!&quot;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="格式化字符输出"><a href="#格式化字符输出" class="headerlink" title="格式化字符输出"></a>格式化字符输出</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter printWriter = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">&quot;abc.text&quot;</span>)));</span><br><span class="line">PrintWriter printWriter = <span class="keyword">new</span> PrintWriter(<span class="string">&quot;abc.text&quot;</span>); <span class="comment">//快捷方式, 本身就已经添加了缓冲</span></span><br></pre></td></tr></table></figure>
<h2 id="内存中的字符串读取"><a href="#内存中的字符串读取" class="headerlink" title="内存中的字符串读取"></a>内存中的字符串读取</h2><h3 id="从内存逐个字节读入字符串"><a href="#从内存逐个字节读入字符串" class="headerlink" title="从内存逐个字节读入字符串"></a>从内存逐个字节读入字符串</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">&quot;这是需要读入的字符串&quot;</span>;</span><br><span class="line">StringReader stringReader = <span class="keyword">new</span> StringReader(s);</span><br><span class="line"><span class="keyword">int</span> c = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> ((c = stringReader.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        System.out.println((<span class="keyword">char</span>) c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    stringReader.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">这</span><br><span class="line">是</span><br><span class="line">需</span><br><span class="line">要</span><br><span class="line">读</span><br><span class="line">入</span><br><span class="line">的</span><br><span class="line">字</span><br><span class="line">符</span><br><span class="line">串</span><br></pre></td></tr></table></figure>
<h3 id="格式化内存输入"><a href="#格式化内存输入" class="headerlink" title="格式化内存输入"></a>格式化内存输入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">&quot;这是需要输出的字符串!&quot;</span>;</span><br><span class="line">ByteArrayInputStream inputStream = <span class="keyword">new</span> ByteArrayInputStream(s.getBytes());</span><br><span class="line">DataInputStream in = <span class="keyword">new</span> DataInputStream(inputStream);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="keyword">while</span> (in.available() != <span class="number">0</span>) &#123;</span><br><span class="line">       System.out.println((<span class="keyword">char</span>) in.readByte());</span><br><span class="line">   &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">   System.err.println(<span class="string">&quot;End of Stream&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       in.close();</span><br><span class="line">   &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DataInputStream.available()方法检测还有多少可供读取的字符</p>
<h2 id="文件拷贝"><a href="#文件拷贝" class="headerlink" title="文件拷贝"></a>文件拷贝</h2><p>这是采用Java IO实现的版本， 采用<a href="/Java/io/NIO/">Java NIO</a>可以大大提高效率。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">File file1=<span class="keyword">new</span> File(args[<span class="number">0</span>]);</span><br><span class="line">File file2=<span class="keyword">new</span> File(args[<span class="number">1</span>]);</span><br><span class="line">InputStream input=<span class="keyword">new</span> FileInputStream(file1);</span><br><span class="line">OutputStream output=<span class="keyword">new</span> FileOutputStream(file2);</span><br><span class="line"><span class="keyword">if</span>((input!=<span class="keyword">null</span>)&amp;&amp;(output!=<span class="keyword">null</span>))&#123;</span><br><span class="line">   <span class="keyword">int</span> temp=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">while</span>((temp=input.read())!=(-<span class="number">1</span>))&#123;</span><br><span class="line">		output.write(temp);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">input.close();</span><br><span class="line">output.close();</span><br></pre></td></tr></table></figure>
<h2 id="RandomAccessFile-1"><a href="#RandomAccessFile-1" class="headerlink" title="RandomAccessFile"></a>RandomAccessFile</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">String fileName=<span class="string">&quot;D:&quot;</span>+File.separator+<span class="string">&quot;hello.txt&quot;</span>;</span><br><span class="line">File f=<span class="keyword">new</span> File(fileName);</span><br><span class="line">RandomAccessFile demo=<span class="keyword">new</span> RandomAccessFile(f,<span class="string">&quot;rw&quot;</span>);</span><br><span class="line">demo.writeBytes(<span class="string">&quot;asdsad&quot;</span>);</span><br><span class="line">demo.writeInt(<span class="number">12</span>);</span><br><span class="line">demo.writeBoolean(<span class="keyword">true</span>);</span><br><span class="line">demo.writeChar(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">demo.writeFloat(<span class="number">1.21f</span>);</span><br><span class="line">demo.writeDouble(<span class="number">12.123</span>);</span><br><span class="line">demo.close();</span><br></pre></td></tr></table></figure>
<h2 id="与字节数组结合"><a href="#与字节数组结合" class="headerlink" title="与字节数组结合"></a>与字节数组结合</h2><p>//TODO 与字节数组</p>
<h1 id="标准IO"><a href="#标准IO" class="headerlink" title="标准IO"></a>标准IO</h1><p>三个标准IO分别是 <code>System.out</code> <code>System.err</code>  <code>System.in</code>, <code>System.out</code>和<code>System.err</code>已经包装成<code>PrintStream</code>对象, 而<code>System.io</code>是没有被包装的未经过加工的<code>InputStream</code>, 因此在读取<code>System.io</code>之前必须对其进行包装.</p>
<p>例子: 一行一行读取系统输入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">InputStreamReader in = <span class="keyword">new</span> InputStreamReader(System.in);</span><br><span class="line">BufferedReader stdin = <span class="keyword">new</span> BufferedReader(in);</span><br><span class="line">String s;</span><br><span class="line"><span class="keyword">while</span>((s = stdin.readLine())!=<span class="keyword">null</span> &amp;&amp; s.length!=<span class="number">0</span>)&#123;</span><br><span class="line">  System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字符输出到标准输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter out = <span class="keyword">new</span> PrintWriter(System.out,<span class="keyword">true</span>);</span><br><span class="line">out.println(<span class="string">&quot;hello , world!&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="标准IO重定向"><a href="#标准IO重定向" class="headerlink" title="标准IO重定向"></a>标准IO重定向</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.setIn(in);</span><br><span class="line">System.setOut(out);</span><br><span class="line">System.setErr(out);</span><br></pre></td></tr></table></figure>
<p>//TODO 如何重定向到<code>java.swing.JTextArea</code></p>
<h1 id="Java-IO-异常与错误"><a href="#Java-IO-异常与错误" class="headerlink" title="Java IO 异常与错误"></a>Java IO 异常与错误</h1><h1 id="进程控制"><a href="#进程控制" class="headerlink" title="进程控制"></a>进程控制</h1><p>所谓的进程控制, 是当Java 调用系统指令启动系统进程时, 利用Java IO输出运行过程中的输出和错位信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">String command = <span class="string">&quot;CMD /C ping www.baidu.com&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Process process = <span class="keyword">new</span> ProcessBuilder(command.split(<span class="string">&quot; &quot;</span>)).start();</span><br><span class="line">  InputStream inputStream = process.getInputStream();</span><br><span class="line">  InputStreamReader inputStreamReader = <span class="keyword">new</span> InputStreamReader(inputStream);</span><br><span class="line">  BufferedReader results = <span class="keyword">new</span> BufferedReader(inputStreamReader);</span><br><span class="line">  String s;</span><br><span class="line">  <span class="keyword">while</span> ((s = results.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">      System.out.println(s);</span><br><span class="line">  &#125;</span><br><span class="line">  BufferedReader errors = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getErrorStream()));</span><br><span class="line">  <span class="keyword">while</span> ((s = errors.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">      System.out.println(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<p>[参考文献]:</p>
<ol>
<li>Think in Java</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">aaronzhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">241</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">122</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aaronzhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
